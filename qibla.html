<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f4c3a">
    <meta name="description" content="Find accurate Qibla direction to Mecca with modern compass technology and Islamic design.">
    <title>Qibla Direction Finder - Islamic Prayer Compass</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts - Enhanced Islamic Typography -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Enhanced Islamic Theme Variables */
        :root {
            --islamic-green: #0f4c3a;
            --islamic-green-light: #1a6b54;
            --islamic-green-accent: #2d8a6e;
            --islamic-gold: #daa520;
            --islamic-gold-light: #f4d03f;
            --islamic-gold-accent: #c19208;
            --text-dark: #1a202c;
            --text-light: #f7fafc;
            --text-muted: #4a5568;
            --background-primary: #ffffff;
            --background-secondary: #f8fafc;
            --shadow-subtle: rgba(0, 0, 0, 0.04);
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.12);
            --shadow-strong: rgba(0, 0, 0, 0.16);
            --border-light: rgba(15, 76, 58, 0.1);
            --border-medium: rgba(15, 76, 58, 0.2);
            --gradient-primary: linear-gradient(135deg, var(--islamic-green), var(--islamic-green-light));
            --gradient-gold: linear-gradient(135deg, var(--islamic-gold), var(--islamic-gold-light));
            --gradient-background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --border-radius: 16px;
            --border-radius-lg: 24px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
        }

        .arabic-font {
            font-family: 'Amiri', serif;
            font-weight: 700;
        }

        html {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 16px;
            background: var(--gradient-background);
            color: var(--text-dark);
            height: 100%;
            scroll-behavior: smooth;
        }

        [class^="column-"] {
            display: inline-block;
        }

        .column-33 {
            width: 33.33333%;
        }

        .column-25 {
            width: 25%;
        }

        .column-20 {
            width: 20%;
        }

        .column-50 {
            width: 50%;
        }

        .label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--islamic-green);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 0.25rem;
        }

        body {
            padding: 0;
            margin: 0;
            height: 100%;
            background: transparent;
            font-feature-settings: "kern" 1, "liga" 1;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Enhanced Header */
        header {
            padding: 1.5rem 1rem;
            background: var(--gradient-primary);
            color: white;
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            transition: var(--transition);
            z-index: 1000;
            box-shadow: 0 4px 32px var(--shadow-medium);
            backdrop-filter: blur(10px);
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M30 30c0-16.569 13.431-30 30-30v60c-16.569 0-30-13.431-30-30z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.5;
        }

        header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            z-index: 2;
        }

        header h1 i {
            font-size: 1.5rem;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        header p {
            font-size: 0.95rem;
            margin: 0.75rem 0 0 0;
            opacity: 0.95;
            line-height: 1.5;
            position: relative;
            z-index: 2;
            font-weight: 400;
        }

        /* Enhanced Container */
        .container {
            padding: 7rem 1.5rem 5rem 1.5rem;
            overflow: hidden;
            height: 100%;
            transition: var(--transition);
            max-width: 640px;
            margin: 0 auto;
        }

        /* Enhanced Compass */
        .compass {
            position: relative;
            width: 100%;
            height: 340px;
            max-width: 340px;
            margin: 2.5rem auto;
            text-align: center;
        }

        .compass__rose {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 20px rgba(15, 76, 58, 0.1));
        }

        .compass__rose__dial {
            height: 100%;
            width: 100%;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 
                0 20px 40px var(--shadow-light),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                inset 0 -1px 0 rgba(0, 0, 0, 0.05);
            border: 3px solid var(--border-light);
            position: relative;
        }

        .compass__rose__dial::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            bottom: 8px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), transparent 50%);
            pointer-events: none;
        }

        .compass__pointer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            height: 100%;
            width: 100%;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
        }

        /* Enhanced Status Panel */
        .status {
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background-primary);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            padding: 1.5rem 1.5rem;
            box-shadow: 
                0 -8px 32px var(--shadow-light),
                0 -1px 0 var(--border-light);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-light);
            margin-top: 2rem;
        }

        .position {
            padding-bottom: 1rem;
            text-transform: uppercase;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 1.5rem;
        }

        .position div:not(.label) {
            margin-top: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--islamic-green);
            padding: 0.5rem;
            background: rgba(15, 76, 58, 0.05);
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        /* Enhanced Popup */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.75);
            z-index: 2000;
            backdrop-filter: blur(4px);
        }

        .popup.popup--show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .popup__content {
            max-width: 520px;
            width: 90%;
            margin: 0 auto;
            background: var(--background-primary);
            color: var(--text-dark);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.25);
            animation: slideUp 0.3s ease-out;
            border: 1px solid var(--border-light);
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(32px) scale(0.95);
            }
            to { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .popup__contents {
            padding: 2.5rem;
            line-height: 1.7;
        }

        .popup__contents h3 {
            color: var(--islamic-green);
            margin-bottom: 1.5rem;
            font-weight: 700;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .popup__contents p {
            margin-bottom: 1.25rem;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .popup__contents ul {
            padding-left: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .popup__contents li {
            margin-bottom: 0.5rem;
            color: var(--text-muted);
        }

        .popup__contents a {
            color: var(--islamic-gold);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .popup__contents a:hover {
            color: var(--islamic-gold-accent);
            text-decoration: underline;
        }

        .popup__inner--hide {
            display: none;
        }

        .popup__close {
            display: block;
            padding: 1.25rem 2rem;
            text-align: center;
            width: 100%;
            border: none;
            background: var(--gradient-primary);
            color: white;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .popup__close:hover {
            background: var(--gradient-gold);
        }

        #position-lab {
            font-size: 1.1rem;
            color: var(--islamic-gold);
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(218, 165, 32, 0.1), rgba(244, 208, 63, 0.1));
            border-radius: var(--border-radius);
            border: 1px solid rgba(218, 165, 32, 0.2);
        }

        /* Enhanced Night Mode */
        html.nightmode {
            background: linear-gradient(135deg, #0f172a 0%, #020617 100%);
            color: var(--text-light);
        }

        html.nightmode .container {
            transform: translateY(-2rem);
        }

        html.nightmode header {
            transform: translateY(-4rem);
            background: linear-gradient(135deg, #0f172a, #1e293b);
        }

        html.nightmode .status,
        html.nightmode .compass__rose__dial {
            background: rgba(15, 23, 42, 0.95);
            border-color: rgba(148, 163, 184, 0.2);
            backdrop-filter: blur(16px);
        }

        html.nightmode .label {
            color: var(--islamic-gold-light);
        }

        html.nightmode .position div:not(.label) {
            color: var(--text-light);
            background: rgba(148, 163, 184, 0.1);
            border-color: rgba(148, 163, 184, 0.2);
        }

        html.nightmode .popup__content {
            background: rgba(15, 23, 42, 0.95);
            color: var(--text-light);
            border-color: rgba(148, 163, 184, 0.2);
        }

        html.nightmode .popup__contents h3 {
            color: var(--islamic-gold-light);
        }

        html.nightmode .popup__contents p {
            color: rgb(203, 213, 225);
        }

        html.nightmode .popup__contents li {
            color: rgb(148, 163, 184);
        }

        /* Enhanced Responsive Design */
        @media (max-width: 768px) {
            .compass {
                height: 300px;
                max-width: 300px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            header p {
                font-size: 0.85rem;
            }

            .container {
                padding: 6rem 1rem 5rem 1rem;
            }

            [class^="column-"] {
                margin-bottom: 0.75rem;
            }

            .column-33,
            .column-25,
            .column-20 {
                width: 50%;
            }
        }

        @media (max-width: 576px) {
            .compass {
                height: 260px;
                max-width: 260px;
            }

            [class^="column-"] {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .container {
                padding: 5.5rem 1rem 4rem 1rem;
            }

            header {
                padding: 1.25rem 1rem;
            }

            .status {
                padding: 1.5rem 1rem;
            }
        }

        /* Enhanced Footer */
        footer {
            background: var(--gradient-primary) !important;
            margin-top: 4rem;
            position: relative;
            overflow: hidden;
        }

        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Cpath d='M30 30c0-16.569 13.431-30 30-30v60c-16.569 0-30-13.431-30-30z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            margin: 0 0.75rem;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .footer-links a:hover {
            color: white;
            text-decoration: underline;
            text-decoration-color: var(--islamic-gold-light);
        }

        /* Debug styles (hidden by default) */
        #debug-orientation,
        #debug-orientation-default {
            display: none;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--islamic-green);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--islamic-green-light);
        }

        /* Enhanced Compass SVG Styling */
        .compass__rose__dial circle {
            stroke: var(--islamic-green);
            stroke-width: 2;
            opacity: 0.3;
        }

        .compass__rose__dial text {
            fill: var(--islamic-green);
            font-weight: 600;
            font-size: 8px;
        }

        .compass__rose__dial polyline {
            fill: var(--islamic-green);
            opacity: 0.7;
        }

        /* Enhanced Kabah icon */
        #kabah {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            transition: all 0.3s ease;
        }

        /* Pulse animation for active state */
        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.05);
                opacity: 0.8;
            }
        }

        .compass.qibla-found #kabah {
            animation: pulse 2s infinite;
        }

        /* Enhanced compass needle */
        .compass__pointer polyline:first-child {
            fill: #dc2626;
            filter: drop-shadow(0 2px 4px rgba(220, 38, 38, 0.3));
        }

        .compass__pointer polyline:last-child {
            fill: white;
            stroke: #dc2626;
            stroke-width: 1;
        }

        .compass__pointer circle {
            fill: #1f2937;
            stroke: #dc2626;
            stroke-width: 2;
        }
    </style>
</head>
<body>
    <header>
        <h1>
            <i class="fas fa-kaaba"></i>
            Qibla Direction Finder
        </h1>
        <p id="intro">Find accurate direction to Mecca using your device's compass. This Islamic compass app helps you determine the Qibla direction for prayer from your current location with precision and devotion.</p>
    </header>
    
    <div class="container">
        <div class="compass">
            <div id="rose" class="compass__rose">
                <svg class="compass__rose__dial" viewBox="0 0 130 130" version="1.1" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="65" cy="65" r="50" stroke="silver" stroke-width="5" fill="none" />
                    <polyline points="62,13  68,13  65,23" fill="silver"/>
                    <polyline points="117,63  117,67  110,65" fill="silver"/>
                    <polyline points="63,117  67,117  65,110" fill="silver"/>
                    <polyline points="13,63  13,67  20,65" fill="silver"/>
                    <text x="65" y="4.2" font-size="9" text-anchor="middle" fill="Black">N</text>
                    <text x="127" y="67" font-size="9" text-anchor="middle" fill="Black">E</text>
                    <text x="65" y="129" font-size="9" text-anchor="middle" fill="Black">S</text>
                    <text x="2.8" y="67" font-size="9" text-anchor="middle" fill="Black">W</text>
                    <image id="kabah" x="55" y="15" width="30" height="30" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCIgdmlld0JveD0iMCAwIDMwIDMwIj48cGF0aCBkPSJNMTUsMyBMMjcsMTUgTDE1LDI3IEwzLDE1IFoiIGZpbGw9IiNiNjAwMDAiLz48L3N2Zz4=" />
                </svg>
            </div>
            <svg class="compass__pointer" viewBox="0 0 130 130" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <polyline points="56,65  74,65  65,19" fill="#b60000"/>
                <polyline points="56,65  74,65  65,111" fill="white"/>
                <circle cx="65" cy="65" r="5" stroke="#b60000" stroke-width="0" fill="black" />
            </svg>
        </div>
    </div>

    <div class='status'>
        <div id='debug-orientation-default'></div>
        <div id='debug-orientation'></div>

        <div class='position row'>
            <div id='position-lab'></div>
        </div>
        <div class='position row'>
            <div class='column-20'>
                <div class='label'>Compass Direction</div>
                <div id='position-hng'>n/a</div>
            </div>
            <div class='column-20'>
                <div class='label'>Qibla Direction</div>
                <div id='position-qib'>n/a</div>
            </div>
            <div class='column-25'>
                <div class='label'>Latitude</div>
                <div id='position-lat'>&#8943;</div>
            </div>
            <div class='column-33'>
                <div class='label'>Longitude</div>
                <div id='position-lng'>&#8943;</div>
            </div>
        </div>
    </div>

    <div id="popup" class="popup">
        <div id="popup-content" class="popup__content">
            <div id="popup-contents" class="popup__contents">
                <div id="popup-inner-info" class="popup__inner popup__inner--hide">
                    <h3><i class="fas fa-kaaba me-2"></i>Qibla Direction Compass</h3>
                    <p>
                        This <strong>Qibla Direction Compass</strong> shows the current qibla direction using your device's compass. The app utilizes your geographical location and device sensors to find the accurate direction to the Kaaba in Mecca.
                    </p>
                    <p>
                        <strong>For best results:</strong>
                    </p>
                    <ul>
                        <li>Stay away from magnets, metals, and electronic devices</li>
                        <li>Calibrate your compass by moving the device in a figure-8 pattern</li>
                        <li>Hold your device flat and parallel to the ground</li>
                        <li>Ensure location services are enabled</li>
                    </ul>
                    <p class="arabic-font" style="text-align: center; font-size: 1.3rem; color: var(--islamic-green); margin: 1.5rem 0;">
                        "فَوَلِّ وَجْهَكَ شَطْرَ الْمَسْجِدِ الْحَرَامِ"
                    </p>
                    <p style="text-align: center; font-style: italic; color: var(--text-muted);">
                        "Turn your face toward the Sacred Mosque" - Quran 2:144
                    </p>
                </div>
                <div id="popup-inner-noorientation" class="popup__inner popup__inner--hide">
                    <h3><i class="fas fa-exclamation-triangle me-2"></i>Device Not Supported</h3>
                    <p>Unfortunately, your device does not support compass functionality or we cannot detect location services.</p>
                    <p>
                        <strong>Alternative methods:</strong>
                    </p>
                    <ul>
                        <li>Use a smartphone or tablet with magnetometer sensors</li>
                        <li>Enable location services in your browser</li>
                        <li>Try refreshing the page and granting permissions</li>
                    </ul>
                </div>
            </div>
            <button id="popup-close" class="popup__close">
                <i class="fas fa-times me-2"></i>Close
            </button>
        </div>
    </div>

    <footer class="bg-islamic-green text-white py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 arabic-font">"وَأَقِيمُوا الصَّلَاةَ وَآتُوا الزَّكَاةَ وَارْكَعُوا مَعَ
                        الرَّاكِعِينَ"</p>
                    <small class="text-light">"And establish prayer and give zakah and bow with those who bow." - Quran
                        2:43</small>
                </div>
                <div class="col-md-6 text-md-end footer-links">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms of Service</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#disclaimerModal">Disclaimer</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#cookiesModal">Cookie Policy</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Contact Us</a>
                    <small>&copy; 2025 Islamic Prayer Times App</small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Legal Modals -->
    <!-- Privacy Policy Modal -->
    <div class="modal fade legal-modal" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>This privacy policy explains how we collect, use, and protect your information when using our prayer
                        times and mosque locations:</p>
                    <ul>
                        <li><strong>Location Data:</strong> We collect your device's geographical coordinates to
                            calculate accurate prayer times and find nearby mosques. This data is processed locally on
                            your device and is not stored on our servers.</li>
                        <li><strong>Prayer Time Calculations:</strong> We use your location to determine sunrise, sunset,
                            and other prayer time calculations based on recognized Islamic calculation methods.</li>
                        <li><strong>Mosque Information:</strong> We access public databases to show nearby Islamic
                            centers and mosques based on your location.</li>
                        <li><strong>No Personal Data Storage:</strong> We do not collect, store, or share any personal
                            information, names, contacts, or browsing habits.</li>
                        <li><strong>Cookies:</strong> We use minimal technical cookies only for app functionality, not for
                            tracking or advertising.</li>
                    </ul>
                    <p>Your privacy is important to us, and this app is designed to serve the Muslim community with
                        respect and confidentiality.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div class="modal fade legal-modal" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">Terms of Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Terms of Use for Islamic Prayer Times App</h6>
                    <p><strong>1. Acceptance of Terms</strong><br>
                        By using this Islamic Prayer Times application, you agree to these terms of service and our
                        privacy policy.</p>
                    <p><strong>2. Purpose and Use</strong><br>
                        This application is designed to help Muslims around the world determine accurate prayer times,
                        Qibla direction, and locate nearby mosques. It is intended for religious and educational purposes
                        only.</p>
                    <p><strong>3. Accuracy Disclaimer</strong><br>
                        While we strive for accuracy in prayer time calculations and Qibla direction, users should verify
                        information with local Islamic authorities when precision is critical. Calculation methods may
                        vary based on geographic location and local Islamic practices.</p>
                    <p><strong>4. Location Services</strong><br>
                        The app requests access to your device's location to provide accurate, localized prayer times and
                        Qibla direction. You may deny location access, but this will limit the app's functionality.</p>
                    <p><strong>5. Religious Guidance</strong><br>
                        This app provides technical tools for Islamic practice but should not replace guidance from
                        qualified Islamic scholars or local religious authorities.</p>
                    <p><strong>6. Limitation of Liability</strong><br>
                        We are not liable for any religious, spiritual, or other consequences resulting from the use of
                        this application. Users are responsible for verifying information and making informed decisions
                        about their religious practices.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Disclaimer Modal -->
    <div class="modal fade legal-modal" id="disclaimerModal" tabindex="-1" aria-labelledby="disclaimerModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="disclaimerModalLabel">Disclaimer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Important Disclaimers</h6>
                    <p><strong>Religious Accuracy:</strong> This application uses widely accepted calculation methods for
                        prayer times and Qibla direction. However, local variations in calculation methods, atmospheric
                        conditions, and regional religious authorities may recommend different times. Always consult with
                        your local mosque or Islamic authority for the most appropriate prayer times in your area.</p>
                    <p><strong>Technical Limitations:</strong> Prayer time calculations depend on your device's location
                        accuracy, timezone settings, and internal clock. GPS and compass functionality may be affected by
                        environmental factors, device hardware, and software limitations.</p>
                    <p><strong>Religious Guidance:</strong> This app is a tool to assist in Islamic practices but does
                        not replace the need for proper Islamic education, community involvement, or guidance from
                        qualified Islamic scholars.</p>
                    <p><strong>Calculation Methods:</strong> Different Islamic authorities and regions use various
                        calculation methods for prayer times. This app provides options for different methods, but users
                        should verify which method is recommended in their location.</p>
                    <p><strong>Device Dependency:</strong> Compass and location features depend on your device's sensors
                        and may not be available on all devices. For critical religious observances, consider using
                        multiple sources and traditional methods for verification.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookie Policy Modal -->
    <div class="modal fade legal-modal" id="cookiesModal" tabindex="-1" aria-labelledby="cookiesModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cookiesModalLabel">Cookie Policy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Cookie Usage in Islamic Prayer Times App</h6>
                    <p>This application uses minimal cookies and local storage for the following purposes:</p>
                    <ul>
                        <li><strong>Essential Functionality:</strong> We store your calculation method preferences, chosen
                            madhab for prayer time calculations, and display settings (such as 12/24 hour format) to
                            provide a consistent user experience.</li>
                        <li><strong>Location Preferences:</strong> If you manually set a location or choose to remember
                            your location preference, this information is stored locally on your device.</li>
                        <li><strong>App Settings:</strong> Theme preferences (light/dark mode), notification settings,
                            and language preferences are stored to maintain your customized experience.</li>
                        <li><strong>No Tracking Cookies:</strong> We do not use cookies for advertising, analytics, or
                            user tracking purposes.</li>
                        <li><strong>Third-Party Services:</strong> If the app uses external services for maps or location
                            data, those services may have their own cookie policies.</li>
                    </ul>
                    <p>You can clear these preferences at any time through your browser settings, though this will reset
                        the app to default settings.</p>
                    <p><strong>Managing Cookies:</strong> You can disable cookies in your browser settings, but this may
                        limit some app functionality and require you to reconfigure your preferences each time you use
                        the app.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal fade legal-modal" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel">Contact Us</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Get in Touch</h6>
                    <p>We welcome your feedback, questions, and suggestions to improve this Islamic Prayer Times
                        application for the Muslim community.</p>

                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-envelope text-primary me-2"></i>General Inquiries</h6>
                            <p>For general questions about the app, feature requests, or feedback:</p>
                            <p><strong>Email:</strong> <a href="mailto:info@islamicprayertimes.app"
                                    class="text-decoration-none">info@islamicprayertimes.app</a></p>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-bug text-warning me-2"></i>Technical Support</h6>
                    <p>For technical issues, bugs, or app problems:</p>
                    <p><strong>Email:</strong> <a href="mailto:support@islamicprayertimes.app"
                            class="text-decoration-none">support@islamicprayertimes.app</a></p>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-md-6">
                    <h6><i class="fas fa-mosque text-success me-2"></i>Religious Questions</h6>
                    <p>For questions about Islamic practices, calculation methods, or religious guidance, we
                        recommend consulting with your local mosque or qualified Islamic scholars.</p>
                </div>
                <div class="col-md-6">
                    <h6><i class="fas fa-users text-info me-2"></i>Community</h6>
                    <p>Join our community discussions and get help from other users:</p>
                    <p><strong>Community Forum:</strong> <a href="#" class="text-decoration-none">Coming
                            Soon</a></p>
                </div>
            </div>

            <div class="alert alert-info mt-3">
                <p class="mb-0"><strong>Response Time:</strong> We typically respond to inquiries within 24-48
                    hours. For urgent technical issues that prevent the app from functioning, we aim to respond
                    within 12 hours.</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
</div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    (function () {
        'use strict';

        var debug = false;
        var warningHeadingShown = false;
        var isOrientationLockable = false;
        var isOrientationLocked = false;
        var isNightMode = false;
        var pointDegree = 0;
        var introtext = "";
        var city = "";
        var state = "";
        var country = "";
        var roundedCurlat = "";
        var roundedCurlon = "";

        var positionCurrent = {};

        var defaultOrientation = "";

        var rose = document.getElementById("rose");
        var kabah = document.getElementById("kabah");
        var intro = document.getElementById("intro");
        var positionLab = document.getElementById("position-lab");
        var positionHng = document.getElementById("position-hng");
        var positionQib = document.getElementById("position-qib");
        var positionLat = document.getElementById("position-lat");
        var positionLng = document.getElementById("position-lng");

        var debugOrientation = document.getElementById("debug-orientation");
        var debugOrientationDefault = document.getElementById("debug-orientation-default");

        introtext = intro.innerHTML;

        function getBrowserOrientation() {
            var orientation;
            if (screen.orientation && screen.orientation.angle !== null) {
                switch (screen.orientation.angle) {
                    case 0:
                        orientation = "portrait-primary";
                        break;
                    case 90:
                        orientation = "landscape-primary";
                        break;
                    case 180:
                        orientation = "portrait-secondary";
                        break;
                    case 270:
                        orientation = "landscape-secondary";
                        break;
                }
            } else if (window.orientation !== undefined) {
                switch (window.orientation) {
                    case 0:
                        orientation = "portrait-primary";
                        break;
                    case 90:
                        orientation = "landscape-primary";
                        break;
                    case 180:
                        orientation = "portrait-secondary";
                        break;
                    case -90:
                        orientation = "landscape-secondary";
                        break;
                }
            }
            return orientation;
        }

        function onHeadingChange(event) {
            var heading = -1*event.webkitCompassHeading || event.alpha;
            var alpha;
            var orientation = getBrowserOrientation();

            if (typeof heading !== "undefined" && heading !== null) {
                if (debug) {
                    debugOrientation.textContent = orientation;
                }

                var adjustment = 0;
                if (defaultOrientation === "landscape") {
                    adjustment -= 90;
                }

                if (typeof orientation !== "undefined") {
                    var currentOrientation = orientation.split("-");

                    if (defaultOrientation !== currentOrientation[0]) {
                        if (defaultOrientation === "landscape") {
                            adjustment -= 270;
                        } else {
                            adjustment -= 90;
                        }
                    }

                    if (currentOrientation[1] === "secondary") {
                        adjustment -= 180;
                    }
                }

                positionCurrent.hng = heading - window.orientation;

                var phase = positionCurrent.hng < 0 ? 360 + positionCurrent.hng : positionCurrent.hng;
                positionHng.textContent = (360 - phase | 0) + "°";
                
                var qiboffset = Math.abs((360 - phase) - pointDegree);
                if(qiboffset < 15) {
                    alpha = (15 - qiboffset) / 15;
                    positionHng.style.background = "rgba(200,0,0,"+alpha+")";
                    kabah.style.background = "rgba(170,0,0,"+alpha+")";
                    intro.innerHTML = "&#128331; Qibla Direction Found &#128332;";
                    intro.style.color = "rgba(255,255,255,"+alpha+")";
                    intro.style.fontSize = "1.5em";
                    intro.style.textAlign = "center";
                    document.querySelector('.compass').classList.add('qibla-found');
                } else {
                    intro.style.color = "white";
                    intro.style.fontSize = "0.95rem";
                    intro.style.textAlign = "left";
                    intro.innerHTML = introtext;
                    positionHng.style.background = "none";
                    document.querySelector('.compass').classList.remove('qibla-found');
                }

                if (typeof rose.style.transform !== "undefined") {
                    rose.style.transform = "rotateZ(" + positionCurrent.hng + "deg)";
                } else if (typeof rose.style.webkitTransform !== "undefined") {
                    rose.style.webkitTransform = "rotateZ(" + positionCurrent.hng + "deg)";
                }
            } else {
                positionHng.textContent = "n/a";
                showHeadingWarning();
            }
        }

        function showHeadingWarning() {
            if (!warningHeadingShown) {
                popupOpen("noorientation");
                warningHeadingShown = true;
            }
        }

        function locationNameUpdate(position) {
            roundedCurlat = Math.round(positionCurrent.lat * 1000) / 1000;
            roundedCurlon = Math.round(positionCurrent.lng * 1000) / 1000;

            var roundedLat = Math.round(position.coords.latitude * 1000) / 1000;
            var roundedLon = Math.round(position.coords.longitude * 1000) / 1000;
            if (roundedCurlat == roundedLat && roundedCurlon == roundedLon) {
            } else {
                var lat = position.coords.latitude;
                var lon = position.coords.longitude;
                var format = "json";

                var url = `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=${format}&zoom=15&layer=address&accept-language=id`;

                var xhr = new XMLHttpRequest();

                xhr.open('GET', url, true);

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        var data = JSON.parse(xhr.responseText);

                        city = data.name;
                        state = data.address.state;
                        country = data.address.country;

                        positionLab.innerText = city + ", " + state;
                    }
                };

                xhr.send();
            }
        }

        function locationUpdate(position) {
            locationNameUpdate(position);
            locationHandler(position);
            positionQib.textContent = pointDegree +"°";

            positionCurrent.lat = position.coords.latitude;
            positionCurrent.lng = position.coords.longitude;

            positionLat.textContent = decimalToSexagesimal(positionCurrent.lat, "lat");
            positionLng.textContent = decimalToSexagesimal(positionCurrent.lng, "lng");
        }

        function locationUpdateFail(error) {
            positionLat.textContent = "n/a";
            positionLng.textContent = "n/a";
            console.log("location fail: ", error);
        }

        function popupOpen(name) {
            var i;
            for (i=0; i<popupInners.length; i++) {
                popupInners[i].classList.add("popup__inner--hide");
            }
            document.getElementById("popup-inner-" + name).classList.remove("popup__inner--hide");

            popup.classList.add("popup--show");
        }

        function popupClose() {
            popup.classList.remove("popup--show");
        }

        function popupContentsClick(event) {
            event.stopPropagation();
        }

        function decimalToSexagesimal(decimal, type) {
            var degrees = decimal | 0;
            var fraction = Math.abs(decimal - degrees);
            var minutes = (fraction * 60) | 0;
            var seconds = (fraction * 3600 - minutes * 60) | 0;

            var direction = "";
            var positive = degrees > 0;
            degrees = Math.abs(degrees);
            switch (type) {
                case "lat":
                    direction = positive ? "N" : "S";
                    break;
                case "lng":
                    direction = positive ? "E" : "W";
                    break;
            }

            return degrees + "°" + minutes + "'" + seconds + "\" " + direction;
        }

        function requestDeviceOrientation(callback) {
            if (window.DeviceOrientationEvent == null) {
                callback(new Error("DeviceOrientation is not supported."));
            } else if (DeviceOrientationEvent.requestPermission) {
                DeviceOrientationEvent.requestPermission().then(function(state) {
                    if (state == "granted") {
                        callback(null);
                    } else callback(new Error("Permission denied by user"));
                }, function(err) {
                    callback(err);
                });
            } else {
                callback(null);
            }
        }

        function firstClick() {
            requestDeviceOrientation(function(err) {
                if (err == null) {
                    window.removeEventListener("click", firstClick);
                    window.removeEventListener("touchend", firstClick);
                    window.addEventListener("devicemotion", function(e) {
                    });
                } else {
                }
            });
        }

        function locationHandler(position) {
            const { latitude, longitude } = position.coords;
            pointDegree = calcDegreeToPoint(latitude, longitude);
            if (pointDegree < 0) {
                pointDegree = pointDegree + 360;
            }
            calcKabah(pointDegree);
        }

        function calcDegreeToPoint(latitude, longitude) {
            const point = {
                lat: 21.422487,
                lng: 39.826206,
            };

            const phiK = (point.lat * Math.PI) / 180.0;
            const lambdaK = (point.lng * Math.PI) / 180.0;
            const phi = (latitude * Math.PI) / 180.0;
            const lambda = (longitude * Math.PI) / 180.0;
            const psi =
                (180.0 / Math.PI) *
                Math.atan2(
                    Math.sin(lambdaK - lambda),
                    Math.cos(phi) * Math.tan(phiK) -
                        Math.sin(phi) * Math.cos(lambdaK - lambda)
                );
            return Math.round(psi);
        }

        function calcKabah(pointDegree) {
            let kabah = document.getElementById("kabah");
            let circle = document.getElementsByTagName("circle")[0];
            let svgr = parseInt(circle.getAttribute("r"));
            let cx = parseInt(circle.getAttribute("cx"));
            let cy = parseInt(circle.getAttribute("cy"));
            let kw = parseInt(kabah.getAttribute("width"));
            let kh = parseInt(kabah.getAttribute("height"));
            let kx = Math.sin(pointDegree * Math.PI / 180) * svgr + cx - (kw / 2);
            let ky = - Math.cos(pointDegree * Math.PI / 180) * svgr + cy - (kh / 2);
            kabah.setAttribute("x", kx);
            kabah.setAttribute("y", ky);
            kabah.setAttribute("transform", "rotate(" + pointDegree +", "+ (kx + (kw/2)) +", " + (ky + (kh/2)) +")");
        }

        function D2R(degrees) {
            var pi = Math.PI;
            return degrees * (pi/180);
        }

        window.addEventListener("click", firstClick);
        window.addEventListener("touchend", firstClick);

        if (screen.width > screen.height) {
            defaultOrientation = "landscape";
        } else {
            defaultOrientation = "portrait";
        }
        if (debug) {
            debugOrientationDefault.textContent = defaultOrientation;
        }

        if ('ondeviceorientationabsolute' in window) {
            window.addEventListener("deviceorientationabsolute", onHeadingChange, true);
        } else {
            window.addEventListener("deviceorientation", onHeadingChange, true);
        }

        navigator.geolocation.watchPosition(locationUpdate, locationUpdateFail, {
            enableHighAccuracy: false,
            maximumAge: 30000,
            timeout: 27000
        });

    }());
</script>
</body>
</html>
