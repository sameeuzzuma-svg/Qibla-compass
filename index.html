<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Prayer Times - Find Namaz Timings & Nearby Mosques</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts - Islamic Style -->
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* Islamic Prayer Times App - Custom Styles */

        :root {
            --islamic-green: #2d5a3d;
            --islamic-green-light: #4a8061;
            --islamic-gold: #d4af37;
            --islamic-gold-light: #f4d03f;
            --text-dark: #2c3e50;
            --text-light: #ecf0f1;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --gradient-green: linear-gradient(135deg, var(--islamic-green), var(--islamic-green-light));
            --gradient-gold: linear-gradient(135deg, var(--islamic-gold), var(--islamic-gold-light));
        }

        /* Base Styles */
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding-top: 120px;
        }

        .arabic-font {
            font-family: 'Amiri', serif;
            font-weight: 700;
        }

        /* Navigation */
        .bg-islamic-green {
            background: var(--gradient-green) !important;
            box-shadow: 0 2px 20px var(--shadow-medium);
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .navbar-nav .nav-link {
            font-weight: 500;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
            border-radius: 25px;
            padding: 0.5rem 1rem !important;
        }

        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Digital Clock */
        .digital-clock {
            background: var(--gradient-gold);
            padding: 1rem 0;
            box-shadow: 0 2px 10px var(--shadow-light);
            position: fixed;
            top: 76px;
            left: 0;
            right: 0;
            z-index: 1020;
        }

        .clock-display {
            background: rgba(255, 255, 255, 0.9);
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            font-family: 'Roboto', monospace;
            font-weight: 700;
            color: var(--islamic-green);
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        #current-time {
            font-size: 1.2rem;
        }

        #current-date {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Main Content */
        .main-content {
            margin-top: 44px;
        }

        .section {
            display: none;
            padding: 3rem 0;
            min-height: 70vh;
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            margin-bottom: 3rem;
        }

        .section-header h2 {
            color: var(--islamic-green);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        /* Islamic Welcome */
        .islamic-welcome {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-light);
            margin-bottom: 2rem;
        }

        .islamic-welcome h1 {
            color: var(--islamic-green);
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .islamic-welcome h2 {
            color: var(--islamic-green);
            font-weight: 700;
        }

        /* Location Card */
        .location-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .location-card:hover {
            transform: translateY(-5px);
        }

        .location-card .card-header {
            background: var(--gradient-green);
            color: white;
            font-weight: 600;
            padding: 1rem 1.5rem;
            border: none;
        }

        .location-card .card-body {
            padding: 1.5rem;
        }

        /* Prayer Time Cards */
        .prayer-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .prayer-card:hover {
            transform: translateY(-5px);
            border-color: var(--islamic-gold);
            box-shadow: 0 15px 35px var(--shadow-medium);
        }

        .prayer-card .prayer-icon {
            font-size: 2.5rem;
            color: var(--islamic-green);
            margin-bottom: 1rem;
        }

        .prayer-card .prayer-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .prayer-card .prayer-time {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--islamic-gold);
            font-family: 'Roboto', monospace;
        }

        .prayer-card.current-prayer {
            background: var(--gradient-green);
            color: white;
        }

        .prayer-card.current-prayer .prayer-icon,
        .prayer-card.current-prayer .prayer-name {
            color: white;
        }

        .prayer-card.current-prayer .prayer-time {
            color: var(--islamic-gold-light);
        }

        /* Time Format Toggle */
        .time-format-toggle {
            margin-top: 1rem;
        }

        .time-format-toggle .form-check-input {
            background-color: var(--islamic-green);
            border-color: var(--islamic-green);
        }

        .time-format-toggle .form-check-input:checked {
            background-color: var(--islamic-gold);
            border-color: var(--islamic-gold);
        }

        .time-format-toggle .form-check-label {
            color: var(--islamic-green);
            font-weight: 500;
            cursor: pointer;
        }

        /* Map Container */
        .map-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-light);
            height: 500px;
            position: relative;
        }

        #mosque-map {
            height: 100%;
            width: 100%;
        }

        /* Mosque List Items */
        .mosque-item {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .mosque-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }

        .mosque-name {
            font-weight: 600;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .mosque-address {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .mosque-distance {
            color: var(--islamic-gold);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: var(--gradient-green);
            color: white;
            border: none;
            font-weight: 600;
        }

        /* Alerts */
        .alert {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        /* Loading Spinners */
        .spinner-border {
            color: var(--islamic-green) !important;
        }

        /* Buttons */
        .btn-primary {
            background: var(--gradient-green);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--gradient-gold);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }

        /* Footer */
        footer {
            background: var(--gradient-green) !important;
            margin-top: 3rem;
        }

        /* Footer Links */
        .footer-links {
            margin-top: 1rem;
        }
        
        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            margin-right: 1rem;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: white;
            text-decoration: underline;
        }

        /* Animation Classes */
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Custom Leaflet Popup Styles */
        .leaflet-popup-content-wrapper {
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--shadow-medium);
        }

        .leaflet-popup-content {
            margin: 1rem;
            font-family: 'Roboto', sans-serif;
        }

        .mosque-popup-title {
            font-weight: 700;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .mosque-popup-address {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .mosque-popup-distance {
            color: var(--islamic-gold);
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Utility Classes */
        .text-islamic-green {
            color: var(--islamic-green) !important;
        }

        .text-islamic-gold {
            color: var(--islamic-gold) !important;
        }

        .bg-islamic-green {
            background: var(--gradient-green) !important;
        }

        .bg-islamic-gold {
            background: var(--gradient-gold) !important;
        }

        /* Tool Cards */
        .tool-card {
            background: white;
            border-radius: 20px;
            padding: 2rem 1.5rem;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow-light);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .tool-card:hover {
            transform: translateY(-10px);
            border-color: var(--islamic-gold);
            box-shadow: 0 20px 40px var(--shadow-medium);
        }

        .tool-icon {
            font-size: 3rem;
            color: var(--islamic-green);
            margin-bottom: 1.5rem;
        }

        .tool-title {
            color: var(--islamic-green);
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .tool-description {
            color: #6c757d;
            margin-bottom: 2rem;
            flex-grow: 1;
        }

        .tool-button {
            color: var(--islamic-gold);
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .tool-card:hover .tool-button {
            transform: translateX(5px);
        }

        /* Quick Stats */
        .quick-stats {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .stat-item {
            padding: 1rem;
        }

        .stat-icon {
            font-size: 2rem;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--islamic-gold);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #6c757d;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        /* Mosque Actions */
        .mosque-actions {
            padding-top: 0.5rem;
            border-top: 1px solid #eee;
        }

        .mosque-actions .btn {
            font-size: 0.85rem;
        }

        /* Manual Location Input */
        .manual-location-form {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 25px var(--shadow-light);
            margin-top: 2rem;
        }

        /* Notification Settings */
        .notification-settings {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 25px var(--shadow-light);
            margin-top: 2rem;
        }

        /* Mosque Filter */
        .mosque-filter {
            background: white;
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 8px 25px var(--shadow-light);
            margin-bottom: 1.5rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 140px;
            }
            
            .main-content {
                margin-top: 54px;
            }
            
            .islamic-welcome {
                padding: 2rem;
            }
            
            .islamic-welcome h1 {
                font-size: 1.5rem;
            }
            
            .prayer-card {
                margin-bottom: 1rem;
            }
            
            .clock-display {
                padding: 0.5rem 1rem;
            }
            
            #current-time {
                font-size: 1rem;
            }
            
            #current-date {
                display: block;
                margin-top: 0.25rem;
            }
            
            .navbar-brand {
                font-size: 1.2rem;
            }
            
            .section {
                padding: 2rem 0;
            }
            
            .map-container {
                height: 400px;
            }
        }

        @media (max-width: 480px) {
            .islamic-welcome h1 {
                font-size: 1.2rem;
            }
            
            .islamic-welcome h2 {
                font-size: 1.3rem;
            }
            
            .prayer-card .prayer-icon {
                font-size: 2rem;
            }
            
            .prayer-card .prayer-name {
                font-size: 1rem;
            }
            
            .prayer-card .prayer-time {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-islamic-green fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#home">
                <i class="fas fa-mosque me-2"></i>
                <span class="arabic-font">إسلامي</span> Prayer Times
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#landing" data-section="landing">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#prayer-times" data-section="prayer-times">Prayer Times</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#mosque-finder" data-section="mosque-finder">Mosque Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#location-info" data-section="location-info">Location Info</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#settings" data-section="settings">Settings</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about" data-section="about">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Digital Clock -->
    <div class="digital-clock">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-auto">
                    <div class="clock-display">
                        <i class="fas fa-clock me-2"></i>
                        <span id="current-time">--:--:--</span>
                        <span id="current-date" class="ms-3">-- -- ----</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Landing Page Section -->
        <section id="landing" class="section active">
            <div class="container">
                <div class="row justify-content-center text-center mb-5">
                    <div class="col-lg-10">
                        <div class="islamic-welcome">
                            <h1 class="arabic-font mb-3">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيم</h1>
                            <h2 class="mb-4">Islamic Prayer Times & Mosque Finder</h2>
                            <p class="lead">Your complete Islamic companion for prayer times, mosque locations, and location-based services. Stay connected with your faith wherever you are.</p>
                        </div>
                    </div>
                </div>

                <!-- Tools Grid -->
                <div class="row g-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="prayer-times">
                            <div class="tool-icon">
                                <i class="fas fa-pray"></i>
                            </div>
                            <h4 class="tool-title">Prayer Times</h4>
                            <p class="tool-description">Get accurate Namaz timings for your location with 12/24-hour format options</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="mosque-finder">
                            <div class="tool-icon">
                                <i class="fas fa-mosque"></i>
                            </div>
                            <h4 class="tool-title">Mosque Finder</h4>
                            <p class="tool-description">Find nearby mosques with interactive map and Google Maps directions</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="location-info">
                            <div class="tool-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <h4 class="tool-title">Location Info</h4>
                            <p class="tool-description">View your current location details with high-precision coordinates</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="settings">
                            <div class="tool-icon">
                                <i class="fas fa-cog"></i>
                            </div>
                            <h4 class="tool-title">Settings</h4>
                            <p class="tool-description">Customize your experience with notification and location settings</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="row justify-content-center mt-5">
                    <div class="col-lg-8">
                        <div class="quick-stats">
                            <div class="row text-center">
                                <div class="col-6 col-md-3">
                                    <div class="stat-item">
                                        <i class="fas fa-clock stat-icon"></i>
                                        <div class="stat-number">5</div>
                                        <div class="stat-label">Daily Prayers</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="stat-item">
                                        <i class="fas fa-globe stat-icon"></i>
                                        <div class="stat-number">200+</div>
                                        <div class="stat-label">Countries</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="stat-item">
                                        <i class="fas fa-map stat-icon"></i>
                                        <div class="stat-number">Live</div>
                                        <div class="stat-label">Location</div>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="stat-item">
                                        <i class="fas fa-mobile-alt stat-icon"></i>
                                        <div class="stat-number">100%</div>
                                        <div class="stat-label">Responsive</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Location Info Section -->
        <section id="location-info" class="section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="section-header text-center mb-5">
                            <h2><i class="fas fa-map-marker-alt me-3"></i>Location Information</h2>
                            <p class="lead">View your current location details with high-precision coordinates</p>
                        </div>
                        
                        <!-- Location Status -->
                        <div class="row justify-content-center mb-5">
                            <div class="col-lg-8">
                                <div class="location-card">
                                    <div class="card-header">
                                        <i class="fas fa-map-marker-alt me-2"></i>
                                        Your Current Location
                                    </div>
                                    <div class="card-body">
                                        <div id="location-loading-section" class="text-center">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading location...</span>
                                            </div>
                                            <p class="mt-2">Detecting your location...</p>
                                        </div>
                                        <div id="location-info-section" class="d-none">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <strong>City:</strong>
                                                    <span id="user-city-section">--</span>
                                                </div>
                                                <div class="col-md-6">
                                                    <strong>Country:</strong>
                                                    <span id="user-country-section">--</span>
                                                </div>
                                                <div class="col-md-6 mt-2">
                                                    <strong>Latitude:</strong>
                                                    <span id="user-lat-section">--</span>
                                                </div>
                                                <div class="col-md-6 mt-2">
                                                    <strong>Longitude:</strong>
                                                    <span id="user-lng-section">--</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="location-error-section" class="d-none alert alert-warning">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            Unable to detect location. Please enable location services and refresh the page.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Today's Prayer Times Preview -->
                        <div class="row justify-content-center">
                            <div class="col-lg-10">
                                <h3 class="text-center mb-4">Today's Prayer Times Preview</h3>
                                <div id="home-prayer-times" class="row g-3">
                                    <!-- Prayer cards will be inserted here -->
                                </div>
                                <div class="text-center mt-4">
                                    <a href="#prayer-times" class="btn btn-primary" data-section="prayer-times">
                                        View Full Prayer Times <i class="fas fa-arrow-right ms-2"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Prayer Times Section -->
        <section id="prayer-times" class="section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="section-header text-center mb-5">
                            <h2><i class="fas fa-pray me-3"></i>Prayer Times</h2>
                            <p class="lead">Accurate prayer timings for your location</p>
                            <div class="time-format-toggle mt-3">
                                <div class="form-check form-switch d-inline-block">
                                    <input class="form-check-input" type="checkbox" id="timeFormatSwitch">
                                    <label class="form-check-label" for="timeFormatSwitch">
                                        <span id="timeFormatLabel">24-hour format</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="prayer-times-content">
                            <div id="prayer-loading" class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading prayer times...</span>
                                </div>
                                <p class="mt-2">Fetching prayer times...</p>
                            </div>
                            
                            <div id="prayer-times-grid" class="row g-4 d-none">
                                <!-- Prayer time cards will be inserted here -->
                            </div>
                            
                            <div id="prayer-error" class="d-none alert alert-danger">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                Unable to fetch prayer times. Please check your internet connection and try again.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mosque Finder Section -->
        <section id="mosque-finder" class="section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-12">
                        <div class="section-header text-center mb-5">
                            <h2><i class="fas fa-mosque me-3"></i>Nearby Mosques</h2>
                            <p class="lead">Find mosques in your area</p>
                        </div>
                        
                        <!-- Mosque Filter -->
                        <div class="mosque-filter mb-4">
                            <div class="row align-items-center">
                                <div class="col-md-6 mb-3 mb-md-0">
                                    <label for="search-radius" class="form-label">Search Radius: <span id="radius-value">5</span> km</label>
                                    <input type="range" class="form-range" id="search-radius" min="1" max="20" value="5">
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <button id="refresh-mosques" class="btn btn-primary">
                                        <i class="fas fa-sync-alt me-2"></i>Refresh
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="map-container">
                            <div id="mosque-loading" class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading map...</span>
                                </div>
                                <p class="mt-2">Loading mosque locations...</p>
                            </div>
                            
                            <div id="mosque-map" class="d-none"></div>
                            
                            <div id="mosque-error" class="d-none alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Unable to load mosque locations. Please check your location settings and internet connection.
                            </div>
                        </div>
                        
                        <div id="mosque-list" class="mt-4">
                            <h4>Found Mosques:</h4>
                            <div id="mosque-items" class="row g-3">
                                <!-- Mosque items will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="section-header text-center mb-5">
                            <h2><i class="fas fa-cog me-3"></i>Settings</h2>
                            <p class="lead">Customize your prayer experience</p>
                        </div>
                        
                        <!-- Notification Settings -->
                        <div class="notification-settings">
                            <h4 class="mb-4"><i class="fas fa-bell me-2"></i>Prayer Time Notifications</h4>
                            
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="notifications-enabled">
                                <label class="form-check-label" for="notifications-enabled">
                                    Enable Prayer Time Notifications
                                </label>
                            </div>
                            
                            <div id="notification-settings" class="d-none">
                                <div class="mb-3">
                                    <label class="form-label">Notification Time Before Prayer</label>
                                    <select class="form-select" id="notification-time">
                                        <option value="5">5 minutes</option>
                                        <option value="10" selected>10 minutes</option>
                                        <option value="15">15 minutes</option>
                                        <option value="20">20 minutes</option>
                                        <option value="30">30 minutes</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Select Prayers to Notify</label>
                                    <div class="form-check">
                                        <input class="form-check-input prayer-notification" type="checkbox" value="Fajr" id="notify-fajr" checked>
                                        <label class="form-check-label" for="notify-fajr">Fajr</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input prayer-notification" type="checkbox" value="Dhuhr" id="notify-dhuhr" checked>
                                        <label class="form-check-label" for="notify-dhuhr">Dhuhr</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input prayer-notification" type="checkbox" value="Asr" id="notify-asr" checked>
                                        <label class="form-check-label" for="notify-asr">Asr</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input prayer-notification" type="checkbox" value="Maghrib" id="notify-maghrib" checked>
                                        <label class="form-check-label" for="notify-maghrib">Maghrib</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input prayer-notification" type="checkbox" value="Isha" id="notify-isha" checked>
                                        <label class="form-check-label" for="notify-isha">Isha</label>
                                    </div>
                                </div>
                                
                                <button id="save-notification-settings" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i>Save Settings
                                </button>
                            </div>
                        </div>
                        
                        <!-- Manual Location Input -->
                        <div class="manual-location-form">
                            <h4 class="mb-4"><i class="fas fa-map-pin me-2"></i>Manual Location Input</h4>
                            <p class="text-muted">Use this if automatic location detection isn't working</p>
                            
                            <form id="manual-location-form">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="manual-latitude" class="form-label">Latitude</label>
                                        <input type="number" step="any" class="form-control" id="manual-latitude" placeholder="e.g., 40.7128" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="manual-longitude" class="form-label">Longitude</label>
                                        <input type="number" step="any" class="form-control" id="manual-longitude" placeholder="e.g., -74.0060" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check me-2"></i>Use This Location
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="section-header text-center mb-5">
                            <h2><i class="fas fa-info-circle me-3"></i>About</h2>
                        </div>
                        
                        <div class="about-content">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Islamic Prayer Times App</h4>
                                    <p class="card-text">
                                        This application helps Muslims around the world stay connected with their prayer times and find nearby mosques. 
                                        We use your device's location to provide accurate prayer timings based on your geographical coordinates.
                                    </p>
                                    
                                    <h5 class="mt-4">Features:</h5>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success me-2"></i>Automatic location detection</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Accurate prayer times using Aladhan API</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Nearby mosque finder with interactive map</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Responsive design for all devices</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Real-time digital clock</li>
                                        <li><i class="fas fa-check text-success me-2"></i>12/24-hour time format toggle</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Prayer time notifications</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Manual location input option</li>
                                    </ul>
                                    
                                    <h5 class="mt-4">Data Sources:</h5>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-external-link-alt text-primary me-2"></i>Prayer times: Aladhan.com API</li>
                                        <li><i class="fas fa-external-link-alt text-primary me-2"></i>Location data: OpenStreetMap</li>
                                        <li><i class="fas fa-external-link-alt text-primary me-2"></i>Mosque locations: OpenStreetMap Overpass API</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-islamic-green text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <p class="mb-0 arabic-font">"وَأَقِيمُوا الصَّلَاةَ وَآتُوا الزَّكَاةَ وَارْكَعُوا مَعَ الرَّاكِعِينَ"</p>
                    <small class="text-light">"And establish prayer and give zakah and bow with those who bow." - Quran 2:43</small>
                    <div class="footer-links mt-2">
                        <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms of Service</a>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#disclaimerModal">Disclaimer</a>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Contact Us</a>
                    </div>
                </div>
                <div class="col-md-4 text-md-end">
                    <small>&copy; 2025 Islamic Prayer Times App</small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Legal Modals -->
    <!-- Privacy Policy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Information We Collect</h6>
                    <p>Our application collects your location data to provide accurate prayer times and mosque locations. This data is processed locally on your device and is not stored on our servers.</p>
                    
                    <h6>2. How We Use Your Information</h6>
                    <p>We use your location information solely to calculate prayer times and find nearby mosques. We do not share, sell, or transmit this information to third parties.</p>
                    
                    <h6>3. Data Storage</h6>
                    <p>Your preferences and settings are stored locally on your device using browser storage mechanisms. You can clear this data at any time by clearing your browser cache.</p>
                    
                    <h6>4. Third-Party Services</h6>
                    <p>We use third-party APIs (Aladhan, OpenStreetMap) to fetch prayer times and location data. These services may have their own privacy policies.</p>
                    
                    <h6>5. Your Consent</h6>
                    <p>By using our application, you consent to our privacy policy.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel">Terms of Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Acceptance of Terms</h6>
                    <p>By accessing and using this application, you accept and agree to be bound by the terms and provision of this agreement.</p>
                    
                    <h6>2. Use License</h6>
                    <p>Permission is granted to temporarily use this application for personal, non-commercial purposes only.</p>
                    
                    <h6>3. Disclaimer</h6>
                    <p>The prayer times and mosque locations provided by this application are for informational purposes only. While we strive to provide accurate information, we cannot guarantee the complete accuracy of the data.</p>
                    
                    <h6>4. Limitations</h6>
                    <p>In no event shall Islamic Prayer Times App or its suppliers be liable for any damages arising out of the use or inability to use the application.</p>
                    
                    <h6>5. Revisions and Errata</h6>
                    <p>The materials appearing on the application could include technical, typographical, or photographic errors.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Disclaimer Modal -->
    <div class="modal fade" id="disclaimerModal" tabindex="-1" aria-labelledby="disclaimerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="disclaimerModalLabel">Disclaimer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Accuracy of Information</h6>
                    <p>The prayer times provided by this application are calculated based on established algorithms and your geographical location. While we strive to provide accurate prayer times, we cannot guarantee their absolute accuracy. Users are advised to confirm prayer times with their local mosque, especially during Ramadan and other significant Islamic events.</p>
                    
                    <h6>Mosque Locations</h6>
                    <p>The mosque locations are sourced from OpenStreetMap data. We cannot guarantee that all mosques in your area will be listed, or that all listed locations are currently operational mosques.</p>
                    
                    <h6>Religious Observance</h6>
                    <p>This application is intended as a helpful tool for Muslims but should not replace religious knowledge or the guidance of local Islamic authorities. Users are responsible for ensuring their prayer times align with their specific madhhab (school of thought) and local customs.</p>
                    
                    <h6>Technical Limitations</h6>
                    <p>The application's functionality depends on your device's capabilities and internet connectivity. We are not responsible for any missed prayers due to technical issues with the application.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel">Contact Us</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>If you have any questions about these terms, please contact us:</p>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope me-2"></i> Email: support@islamicprayertimes.app</li>
                        <li><i class="fas fa-bug me-2"></i> Report Issues: github.com/username/issues</li>
                    </ul>
                    <p>We appreciate your feedback and suggestions for improving our application.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Leaflet JS for Maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Islamic Prayer Times App - JavaScript

        class IslamicApp {
            constructor() {
                this.userLocation = null;
                this.map = null;
                this.mosqueMarkers = [];
                this.prayerTimes = null;
                this.is24HourFormat = true;
                this.notificationSettings = {
                    enabled: false,
                    timeBefore: 10,
                    prayers: ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha']
                };
                this.searchRadius = 5; // Default search radius in km
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.startClock();
                this.loadSettings();
                this.detectLocation();
                
                // Handle initial section based on URL hash
                this.handleInitialSection();
            }

            handleInitialSection() {
                // Check if there's a hash in the URL
                const hash = window.location.hash.substring(1);
                const validSections = ['landing', 'prayer-times', 'mosque-finder', 'location-info', 'settings', 'about'];
                
                if (hash && validSections.includes(hash)) {
                    this.showSection(hash);
                } else {
                    // Default to landing page
                    this.showSection('landing');
                }
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('[data-section]').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const sectionId = e.target.getAttribute('data-section') || e.target.closest('[data-section]').getAttribute('data-section');
                        this.showSection(sectionId);
                        
                        // Update active nav only for nav links
                        if (e.target.classList.contains('nav-link')) {
                            this.updateActiveNav(e.target);
                        } else {
                            // Update nav for tool cards
                            const navLink = document.querySelector(`[data-section="${sectionId}"].nav-link`);
                            if (navLink) {
                                this.updateActiveNav(navLink);
                            }
                        }
                    });
                });

                // Time format toggle
                const timeFormatSwitch = document.getElementById('timeFormatSwitch');
                if (timeFormatSwitch) {
                    // Load saved preference
                    const savedFormat = localStorage.getItem('timeFormat');
                    this.is24HourFormat = savedFormat ? savedFormat === '24' : true;
                    timeFormatSwitch.checked = this.is24HourFormat;
                    this.updateTimeFormatLabel();

                    timeFormatSwitch.addEventListener('change', (e) => {
                        this.is24HourFormat = e.target.checked;
                        localStorage.setItem('timeFormat', this.is24HourFormat ? '24' : '12');
                        this.updateTimeFormatLabel();
                        if (this.prayerTimes) {
                            this.displayPrayerTimes();
                        }
                    });
                }

                // Notification settings
                const notificationsEnabled = document.getElementById('notifications-enabled');
                if (notificationsEnabled) {
                    notificationsEnabled.checked = this.notificationSettings.enabled;
                    this.toggleNotificationSettings();
                    
                    notificationsEnabled.addEventListener('change', (e) => {
                        this.notificationSettings.enabled = e.target.checked;
                        this.toggleNotificationSettings();
                    });
                }

                // Save notification settings
                const saveNotificationSettings = document.getElementById('save-notification-settings');
                if (saveNotificationSettings) {
                    saveNotificationSettings.addEventListener('click', () => {
                        this.saveNotificationSettings();
                    });
                }

                // Manual location form
                const manualLocationForm = document.getElementById('manual-location-form');
                if (manualLocationForm) {
                    manualLocationForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.setManualLocation();
                    });
                }

                // Search radius slider
                const searchRadius = document.getElementById('search-radius');
                if (searchRadius) {
                    searchRadius.addEventListener('input', (e) => {
                        this.searchRadius = parseInt(e.target.value);
                        document.getElementById('radius-value').textContent = this.searchRadius;
                    });
                }

                // Refresh mosques button
                const refreshMosques = document.getElementById('refresh-mosques');
                if (refreshMosques) {
                    refreshMosques.addEventListener('click', () => {
                        this.loadMosques();
                    });
                }
            }

            showSection(sectionId) {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                // Show target section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                    
                    // Load section-specific content
                    if (sectionId === 'prayer-times' && this.userLocation && !this.prayerTimes) {
                        this.loadPrayerTimes();
                    } else if (sectionId === 'mosque-finder' && this.userLocation) {
                        this.loadMosques();
                    } else if (sectionId === 'location-info') {
                        this.loadLocationPrayerTimes();
                    }
                }

                // Update URL hash
                window.location.hash = sectionId;
                
                // Scroll to top
                window.scrollTo(0, 0);
            }

            updateActiveNav(activeLink) {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                activeLink.classList.add('active');
            }

            updateTimeFormatLabel() {
                const label = document.getElementById('timeFormatLabel');
                if (label) {
                    label.textContent = this.is24HourFormat ? '24-hour format' : '12-hour format';
                }
            }

            toggleNotificationSettings() {
                const notificationSettings = document.getElementById('notification-settings');
                if (notificationSettings) {
                    if (this.notificationSettings.enabled) {
                        notificationSettings.classList.remove('d-none');
                    } else {
                        notificationSettings.classList.add('d-none');
                    }
                }
            }

            saveNotificationSettings() {
                // Get notification time
                const notificationTime = document.getElementById('notification-time');
                if (notificationTime) {
                    this.notificationSettings.timeBefore = parseInt(notificationTime.value);
                }

                // Get selected prayers
                this.notificationSettings.prayers = [];
                document.querySelectorAll('.prayer-notification:checked').forEach(checkbox => {
                    this.notificationSettings.prayers.push(checkbox.value);
                });

                // Save to localStorage
                localStorage.setItem('notificationSettings', JSON.stringify(this.notificationSettings));

                // Show success message
                alert('Notification settings saved successfully!');
            }

            loadSettings() {
                // Load notification settings
                const savedNotificationSettings = localStorage.getItem('notificationSettings');
                if (savedNotificationSettings) {
                    this.notificationSettings = JSON.parse(savedNotificationSettings);
                }

                // Update UI with saved settings
                if (this.notificationSettings.enabled) {
                    const notificationsEnabled = document.getElementById('notifications-enabled');
                    if (notificationsEnabled) {
                        notificationsEnabled.checked = true;
                    }
                    
                    const notificationTime = document.getElementById('notification-time');
                    if (notificationTime) {
                        notificationTime.value = this.notificationSettings.timeBefore;
                    }
                    
                    // Check prayer checkboxes
                    this.notificationSettings.prayers.forEach(prayer => {
                        const checkbox = document.getElementById(`notify-${prayer.toLowerCase()}`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    });
                    
                    this.toggleNotificationSettings();
                }
            }

            setManualLocation() {
                const lat = parseFloat(document.getElementById('manual-latitude').value);
                const lng = parseFloat(document.getElementById('manual-longitude').value);
                
                if (isNaN(lat) || isNaN(lng)) {
                    alert('Please enter valid latitude and longitude values.');
                    return;
                }
                
                if (lat < -90 || lat > 90 || lng < -180 || lng > 180) {
                    alert('Please enter valid latitude (-90 to 90) and longitude (-180 to 180) values.');
                    return;
                }
                
                this.userLocation = { lat, lng };
                this.getReverseGeocoding();
                alert('Location updated successfully!');
            }

            startClock() {
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);
            }

            updateClock() {
                const now = new Date();
                const timeElement = document.getElementById('current-time');
                const dateElement = document.getElementById('current-date');
                
                if (timeElement) {
                    timeElement.textContent = now.toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: true
                    });
                }
                
                if (dateElement) {
                    dateElement.textContent = now.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                }
            }

            detectLocation() {
                if (!navigator.geolocation) {
                    this.showLocationError('Geolocation is not supported by this browser.');
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        this.userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        this.getReverseGeocoding();
                    },
                    (error) => {
                        let errorMessage = 'Unable to get your location.';
                        
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Location access denied. Please enable location services.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Location information is unavailable.';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Location request timed out.';
                                break;
                        }
                        
                        this.showLocationError(errorMessage);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            }

            async getReverseGeocoding() {
                try {
                    const response = await fetch(
                        `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${this.userLocation.lat}&longitude=${this.userLocation.lng}&localityLanguage=en`
                    );
                    const data = await response.json();
                    
                    this.userLocation.city = data.city || data.locality || 'Unknown';
                    this.userLocation.country = data.countryName || 'Unknown';
                    
                    this.displayLocationInfo();
                } catch (error) {
                    console.error('Error getting location details:', error);
                    this.userLocation.city = 'Unknown';
                    this.userLocation.country = 'Unknown';
                    this.displayLocationInfo();
                }
            }

            displayLocationInfo() {
                const loadingSection = document.getElementById('location-loading-section');
                const infoSection = document.getElementById('location-info-section');
                
                if (loadingSection) loadingSection.classList.add('d-none');
                if (infoSection) infoSection.classList.remove('d-none');
                
                // Update location info
                this.updateElementText('user-city-section', this.userLocation.city);
                this.updateElementText('user-country-section', this.userLocation.country);
                this.updateElementText('user-lat-section', this.userLocation.lat.toFixed(6));
                this.updateElementText('user-lng-section', this.userLocation.lng.toFixed(6));
            }

            showLocationError(message) {
                const loadingSection = document.getElementById('location-loading-section');
                const errorSection = document.getElementById('location-error-section');
                
                if (loadingSection) loadingSection.classList.add('d-none');
                if (errorSection) {
                    errorSection.classList.remove('d-none');
                    errorSection.querySelector('i').nextSibling.textContent = message;
                }
            }

            async loadPrayerTimes() {
                if (!this.userLocation) return;

                try {
                    const today = new Date();
                    const day = today.getDate();
                    const month = today.getMonth() + 1;
                    const year = today.getFullYear();

                    const response = await fetch(
                        `https://api.aladhan.com/v1/timings/${day}-${month}-${year}?latitude=${this.userLocation.lat}&longitude=${this.userLocation.lng}&method=2`
                    );
                    
                    if (!response.ok) {
                        throw new Error('Failed to fetch prayer times');
                    }
                    
                    const data = await response.json();
                    this.prayerTimes = data.data.timings;
                    
                    this.displayPrayerTimes();
                } catch (error) {
                    console.error('Error loading prayer times:', error);
                    this.showPrayerError();
                }
            }

            displayPrayerTimes() {
                const loadingElement = document.getElementById('prayer-loading');
                const gridElement = document.getElementById('prayer-times-grid');
                
                if (loadingElement) loadingElement.classList.add('d-none');
                if (gridElement) gridElement.classList.remove('d-none');

                const prayers = [
                    { name: 'Fajr', time: this.prayerTimes.Fajr, icon: 'fas fa-sun' },
                    { name: 'Dhuhr', time: this.prayerTimes.Dhuhr, icon: 'fas fa-sun' },
                    { name: 'Asr', time: this.prayerTimes.Asr, icon: 'fas fa-sun' },
                    { name: 'Maghrib', time: this.prayerTimes.Maghrib, icon: 'fas fa-moon' },
                    { name: 'Isha', time: this.prayerTimes.Isha, icon: 'fas fa-star' }
                ];

                gridElement.innerHTML = prayers.map(prayer => `
                    <div class="col-md-6 col-lg-2">
                        <div class="prayer-card ${this.getCurrentPrayer() === prayer.name ? 'current-prayer' : ''}">
                            <div class="prayer-icon">
                                <i class="${prayer.icon}"></i>
                            </div>
                            <div class="prayer-name">${prayer.name}</div>
                            <div class="prayer-time">${this.formatTime(prayer.time)}</div>
                        </div>
                    </div>
                `).join('');
            }

            loadLocationPrayerTimes() {
                if (!this.userLocation) return;
                
                this.loadPrayerTimes().then(() => {
                    if (this.prayerTimes) {
                        this.displayHomePrayerTimes();
                    }
                });
            }

            displayHomePrayerTimes() {
                const homeContainer = document.getElementById('home-prayer-times');
                if (!homeContainer || !this.prayerTimes) return;

                const prayers = [
                    { name: 'Fajr', time: this.prayerTimes.Fajr, icon: 'fas fa-sun' },
                    { name: 'Dhuhr', time: this.prayerTimes.Dhuhr, icon: 'fas fa-sun' },
                    { name: 'Asr', time: this.prayerTimes.Asr, icon: 'fas fa-sun' },
                    { name: 'Maghrib', time: this.prayerTimes.Maghrib, icon: 'fas fa-moon' },
                    { name: 'Isha', time: this.prayerTimes.Isha, icon: 'fas fa-star' }
                ];

                homeContainer.innerHTML = prayers.map(prayer => `
                    <div class="col-md-6 col-lg-2">
                        <div class="prayer-card ${this.getCurrentPrayer() === prayer.name ? 'current-prayer' : ''}">
                            <div class="prayer-icon">
                                <i class="${prayer.icon}"></i>
                            </div>
                            <div class="prayer-name">${prayer.name}</div>
                            <div class="prayer-time">${this.formatTime(prayer.time)}</div>
                        </div>
                    </div>
                `).join('');
            }

            showPrayerError() {
                const loadingElement = document.getElementById('prayer-loading');
                const errorElement = document.getElementById('prayer-error');
                
                if (loadingElement) loadingElement.classList.add('d-none');
                if (errorElement) errorElement.classList.remove('d-none');
            }

            getCurrentPrayer() {
                if (!this.prayerTimes) return null;

                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();

                const prayers = [
                    { name: 'Fajr', time: this.prayerTimes.Fajr },
                    { name: 'Dhuhr', time: this.prayerTimes.Dhuhr },
                    { name: 'Asr', time: this.prayerTimes.Asr },
                    { name: 'Maghrib', time: this.prayerTimes.Maghrib },
                    { name: 'Isha', time: this.prayerTimes.Isha }
                ];

                for (let i = 0; i < prayers.length; i++) {
                    const prayer = prayers[i];
                    const [hours, minutes] = prayer.time.split(':').map(Number);
                    const prayerTime = hours * 60 + minutes;
                    
                    const nextPrayer = prayers[i + 1];
                    if (nextPrayer) {
                        const [nextHours, nextMinutes] = nextPrayer.time.split(':').map(Number);
                        const nextPrayerTime = nextHours * 60 + nextMinutes;
                        
                        if (currentTime >= prayerTime && currentTime < nextPrayerTime) {
                            return prayer.name;
                        }
                    } else {
                        // Last prayer of the day
                        if (currentTime >= prayerTime) {
                            return prayer.name;
                        }
                    }
                }
                
                return null;
            }

            formatTime(time24) {
                if (this.is24HourFormat) {
                    return time24;
                }
                
                const [hours, minutes] = time24.split(':').map(Number);
                const date = new Date();
                date.setHours(hours, minutes, 0, 0);
                
                return date.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
            }

            async loadMosques() {
                if (!this.userLocation) return;

                const loadingElement = document.getElementById('mosque-loading');
                const mapElement = document.getElementById('mosque-map');
                
                try {
                    // Show loading
                    if (loadingElement) loadingElement.classList.remove('d-none');
                    if (mapElement) mapElement.classList.add('d-none');

                    // Initialize map first
                    this.initializeMap();

                    // Using Overpass API to find mosques
                    const radius = this.searchRadius * 1000; // Convert km to meters
                    const query = `
                        [out:json][timeout:25];
                        (
                            node["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${this.userLocation.lat},${this.userLocation.lng});
                            way["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${this.userLocation.lat},${this.userLocation.lng});
                            relation["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${this.userLocation.lat},${this.userLocation.lng});
                        );
                        out center;
                    `;

                    const response = await fetch('https://overpass-api.de/api/interpreter', {
                        method: 'POST',
                        body: query,
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch mosque data');
                    }

                    const data = await response.json();
                    
                    const mosques = data.elements
                        .filter(element => element.tags?.name)
                        .map(element => {
                            const lat = element.lat || element.center?.lat;
                            const lng = element.lon || element.center?.lon;
                            
                            if (!lat || !lng) return null;
                            
                            const distance = this.calculateDistance(
                                this.userLocation.lat, 
                                this.userLocation.lng, 
                                lat, 
                                lng
                            );
                            
                            return {
                                id: element.id,
                                name: element.tags.name,
                                address: element.tags['addr:full'] || 
                                        `${element.tags['addr:housenumber'] || ''} ${element.tags['addr:street'] || ''}, ${element.tags['addr:city'] || ''}`.trim() ||
                                        'Address not available',
                                lat: lat,
                                lng: lng,
                                distance: distance
                            };
                        })
                        .filter(Boolean)
                        .sort((a, b) => a.distance - b.distance)
                        .slice(0, 10);

                    this.displayMosques(mosques);
                    
                    // Hide loading and show map
                    if (loadingElement) loadingElement.classList.add('d-none');
                    if (mapElement) mapElement.classList.remove('d-none');
                    
                } catch (error) {
                    console.error('Error loading mosques:', error);
                    this.showMosqueError();
                }
            }

            initializeMap() {
                const mapElement = document.getElementById('mosque-map');
                if (!mapElement || !window.L) return;

                // Remove existing map if any
                if (this.map) {
                    this.map.remove();
                }

                // Initialize new map
                this.map = L.map('mosque-map').setView([this.userLocation.lat, this.userLocation.lng], 13);

                // Add tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(this.map);

                // Add user location marker
                L.marker([this.userLocation.lat, this.userLocation.lng])
                    .addTo(this.map)
                    .bindPopup('<div class="text-center"><strong>Your Location</strong></div>');
            }

            displayMosques(mosques) {
                // Clear existing markers
                this.mosqueMarkers.forEach(marker => this.map.removeLayer(marker));
                this.mosqueMarkers = [];

                // Add mosque markers to map
                mosques.forEach(mosque => {
                    const marker = L.marker([mosque.lat, mosque.lng]).addTo(this.map);
                    marker.bindPopup(`
                        <div class="p-2">
                            <div class="mosque-popup-title">${mosque.name}</div>
                            <div class="mosque-popup-address">${mosque.address}</div>
                            <div class="mosque-popup-distance">${mosque.distance.toFixed(1)} miles away</div>
                        </div>
                    `);
                    this.mosqueMarkers.push(marker);
                });

                // Display mosque list
                const mosqueContainer = document.getElementById('mosque-items');
                if (mosqueContainer) {
                    mosqueContainer.innerHTML = mosques.map(mosque => `
                        <div class="col-lg-4 col-md-6">
                            <div class="mosque-item" onclick="window.islamicApp.openDirections(${mosque.lat}, ${mosque.lng})">
                                <div class="mosque-name">${mosque.name}</div>
                                <div class="mosque-address">${mosque.address}</div>
                                <div class="mosque-distance">${mosque.distance.toFixed(1)} miles away</div>
                                <div class="mosque-actions mt-2">
                                    <button class="btn btn-sm btn-primary">
                                        <i class="fas fa-directions me-1"></i>Directions
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            }

            showMosqueError() {
                const loadingElement = document.getElementById('mosque-loading');
                const errorElement = document.getElementById('mosque-error');
                
                if (loadingElement) loadingElement.classList.add('d-none');
                if (errorElement) errorElement.classList.remove('d-none');
            }

            openDirections(lat, lng) {
                const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
                window.open(url, '_blank');
            }

            calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 3959; // Earth's radius in miles
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            }

            updateElementText(elementId, text) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = text;
                }
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.islamicApp = new IslamicApp();
        });
    </script>
</body>
</html>
