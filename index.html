<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Enhanced SEO Meta Tags -->
    <title>Islamic Prayer Times - Accurate Namaz Timings & Nearby Mosques Finder</title>
    <meta name="description"
        content="Find accurate Islamic prayer times, nearby mosques, Qibla direction, and dhikr counter. Get precise Namaz timings for Fajr, Dhuhr, Asr, Maghrib, and Isha prayers based on your location.">
    <meta name="keywords"
        content="Islamic prayer times, Namaz timings, mosque finder, Qibla direction, prayer times calculator, Salah times, Islamic calendar, dhikr counter, nearby mosques, Muslim prayer app">
    <meta name="author" content="Islamic Prayer Times">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="1 days">

    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="Islamic Prayer Times - Accurate Namaz Timings & Mosque Finder">
    <meta property="og:description"
        content="Get precise prayer times, find nearby mosques, and access Islamic tools including Qibla finder and dhikr counter.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourwebsite.com">
    <meta property="og:image" content="https://yourwebsite.com/prayer-times-preview.jpg">
    <meta property="og:site_name" content="Islamic Prayer Times">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Islamic Prayer Times - Accurate Namaz Timings & Mosque Finder">
    <meta name="twitter:description" content="Get precise prayer times, find nearby mosques, and access Islamic tools.">
    <meta name="twitter:image" content="https://yourwebsite.com/prayer-times-preview.jpg">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://yourwebsite.com">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://api.aladhan.com">
    <link rel="preconnect" href="https://api.bigdatacloud.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts - Islamic Style -->
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Islamic Prayer Times",
      "description": "Accurate Islamic prayer times, mosque finder, and Qibla direction calculator",
      "url": "https://yourwebsite.com",
      "applicationCategory": "Religion",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Accurate prayer times calculation",
        "Nearby mosque finder",
        "Qibla direction compass",
        "Islamic calendar",
        "Dhikr counter",
        "Prayer notifications"
      ]
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Islamic Prayer Times",
      "url": "https://yourwebsite.com",
      "description": "Providing accurate Islamic prayer times and mosque locations worldwide",
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "availableLanguage": "English"
      }
    }
    </script>

    <!-- Google Analytics (replace GA_MEASUREMENT_ID with your actual ID) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>

    <!-- Google Search Console verification (replace with your verification code) -->
    <meta name="google-site-verification" content="your-verification-code">

    <style>
        /* Islamic Prayer Times App - Custom Styles */
        :root {
            --islamic-green: #2d5a3d;
            --islamic-green-light: #4a8061;
            --islamic-gold: #d4af37;
            --islamic-gold-light: #f4d03f;
            --text-dark: #2c3e50;
            --text-light: #ecf0f1;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --gradient-green: linear-gradient(135deg, var(--islamic-green), var(--islamic-green-light));
            --gradient-gold: linear-gradient(135deg, var(--islamic-gold), var(--islamic-gold-light));
        }

        /* Base Styles */
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding-top: 120px;
        }

        .arabic-font {
            font-family: 'Amiri', serif;
            font-weight: 700;
        }

        /* Navigation */
        .bg-islamic-green {
            background: var(--gradient-green) !important;
            box-shadow: 0 2px 20px var(--shadow-medium);
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .navbar-nav .nav-link {
            font-weight: 500;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
            border-radius: 25px;
            padding: 0.5rem 1rem !important;
        }

        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Breadcrumb */
        .breadcrumb {
            background: transparent;
            padding: 0.5rem 0;
        }

        .breadcrumb-item a {
            color: var(--islamic-green);
            text-decoration: none;
        }

        /* Main Content */
        .main-content {
            margin-top: 44px;
        }

        .section {
            display: none;
            padding: 3rem 0;
            min-height: 70vh;
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            margin-bottom: 3rem;
        }

        .section-header h1,
        .section-header h2 {
            color: var(--islamic-green);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        /* Islamic Welcome */
        .islamic-welcome {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-light);
            margin-bottom: 2rem;
        }

        .islamic-welcome h1 {
            color: var(--islamic-green);
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .islamic-welcome h2 {
            color: var(--islamic-green);
            font-weight: 700;
        }

        .islamic-welcome h3 {
            color: var(--islamic-green);
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .islamic-welcome ul {
            margin-bottom: 1.5rem;
        }

        .islamic-welcome li {
            margin-bottom: 0.5rem;
        }

        /* Location Card */
        .location-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .location-card:hover {
            transform: translateY(-5px);
        }

        .location-card .card-header {
            background: var(--gradient-green);
            color: white;
            font-weight: 600;
            padding: 1rem 1.5rem;
            border: none;
        }

        .location-card .card-body {
            padding: 1.5rem;
        }

        /* Prayer Time Cards */
        .prayer-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .prayer-card:hover {
            transform: translateY(-5px);
            border-color: var(--islamic-gold);
            box-shadow: 0 15px 35px var(--shadow-medium);
        }

        .prayer-card .prayer-icon {
            font-size: 2.5rem;
            color: var(--islamic-green);
            margin-bottom: 1rem;
        }

        .prayer-card .prayer-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .prayer-card .prayer-time {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--islamic-gold);
            font-family: 'Roboto', monospace;
        }

        .prayer-card.current-prayer {
            background: var(--gradient-green);
            color: white;
        }

        .prayer-card.current-prayer .prayer-icon,
        .prayer-card.current-prayer .prayer-name {
            color: white;
        }

        .prayer-card.current-prayer .prayer-time {
            color: var(--islamic-gold-light);
        }

        /* Next Prayer Countdown */
        .next-prayer-countdown {
            background: var(--gradient-gold);
            padding: 1.5rem;
            border-radius: 20px;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .countdown-time {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Roboto', monospace;
            margin: 1rem 0;
        }

        /* Qibla Compass */
        .qibla-compass {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .compass-circle {
            width: 200px;
            height: 200px;
            border: 3px solid var(--islamic-green);
            border-radius: 50%;
            margin: 1rem auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .qibla-arrow {
            font-size: 3rem;
            color: var(--islamic-gold);
            transition: transform 0.3s ease;
        }

        /* Dhikr Counter */
        .dhikr-counter {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .dhikr-count {
            font-size: 4rem;
            font-weight: 700;
            color: var(--islamic-gold);
            margin: 1rem 0;
        }

        .dhikr-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: var(--gradient-green);
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto;
        }

        .dhikr-button:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px var(--shadow-medium);
        }

        /* Map Container */
        .map-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-light);
            height: 500px;
            position: relative;
        }

        #mosque-map {
            height: 100%;
            width: 100%;
        }

        /* Mosque List Items */
        .mosque-item {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .mosque-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }

        .mosque-name {
            font-weight: 600;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .mosque-address {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .mosque-distance {
            color: var(--islamic-gold);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .distance-badge {
            background: var(--islamic-gold);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Mosque Actions */
        .mosque-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .mosque-actions .btn-sm {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: var(--gradient-green);
            color: white;
            border: none;
            font-weight: 600;
        }

        /* Alerts */
        .alert {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        /* Loading Spinners */
        .spinner-border {
            color: var(--islamic-green) !important;
        }

        /* Buttons */
        .btn-primary {
            background: var(--gradient-green);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--gradient-gold);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }

        .btn-gold {
            background: var(--gradient-gold);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-gold:hover {
            background: var(--gradient-green);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
            color: white;
        }

        /* Tool Cards */
        .tool-card {
            background: white;
            border-radius: 20px;
            padding: 2rem 1.5rem;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow-light);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .tool-card:hover {
            transform: translateY(-10px);
            border-color: var(--islamic-gold);
            box-shadow: 0 20px 40px var(--shadow-medium);
        }

        .tool-icon {
            font-size: 3rem;
            color: var(--islamic-green);
            margin-bottom: 1.5rem;
        }

        .tool-title {
            color: var(--islamic-green);
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .tool-description {
            color: #6c757d;
            margin-bottom: 2rem;
            flex-grow: 1;
        }

        .tool-button {
            color: var(--islamic-gold);
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .tool-card:hover .tool-button {
            transform: translateX(5px);
        }

        /* Islamic Calendar */
        .islamic-date {
            background: var(--gradient-green);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 1rem;
        }

        /* Filter Controls */
        .filter-controls {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px var(--shadow-light);
        }

        /* FAQ Styles */
        .accordion-button {
            background-color: var(--islamic-green);
            color: white;
            font-weight: 600;
        }

        .accordion-button:not(.collapsed) {
            background-color: var(--islamic-gold);
            color: white;
        }

        .accordion-button:focus {
            box-shadow: 0 0 0 0.25rem rgba(45, 90, 61, 0.25);
        }

        /* Footer */
        footer {
            background: var(--gradient-green) !important;
            margin-top: 3rem;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
            margin: 0 10px;
            font-size: 0.9rem;
        }

        .footer-links a:hover {
            color: white;
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 140px;
            }

            .main-content {
                margin-top: 20px;
            }

            .islamic-welcome {
                padding: 2rem;
            }

            .islamic-welcome h1 {
                font-size: 1.5rem;
            }

            .prayer-card {
                margin-bottom: 1rem;
            }

            .section {
                padding: 2rem 0;
            }

            .map-container {
                height: 400px;
            }

            .footer-links {
                text-align: center;
                margin-top: 1rem;
            }

            .footer-links a {
                display: inline-block;
                margin: 5px;
            }

            .countdown-time {
                font-size: 2rem;
            }

            .compass-circle {
                width: 150px;
                height: 150px;
            }

            .qibla-arrow {
                font-size: 2rem;
            }

            .mosque-actions {
                flex-direction: column;
                gap: 0.25rem;
            }

            .mosque-actions .btn-sm {
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .islamic-welcome h1 {
                font-size: 1.2rem;
            }

            .islamic-welcome h2 {
                font-size: 1.3rem;
            }

            .prayer-card .prayer-icon {
                font-size: 2rem;
            }

            .prayer-card .prayer-name {
                font-size: 1rem;
            }

            .prayer-card .prayer-time {
                font-size: 1.2rem;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-islamic-green fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#landing">
                <i class="fas fa-mosque me-2"></i>
                Islamic Prayer Times
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#landing" data-section="landing">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#prayer-times" data-section="prayer-times">Prayer Times</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#mosque-finder" data-section="mosque-finder">Mosque Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#qibla" data-section="qibla">Qibla Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#dhikr" data-section="dhikr">Dhikr Counter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about" data-section="about">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb" class="d-none" id="breadcrumb-nav">
        <div class="container">
            <ol class="breadcrumb bg-transparent mb-0 py-2">
                <li class="breadcrumb-item"><a href="#landing">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page" id="current-page">Prayer Times</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Landing Page Section -->
        <section id="landing" class="section active">
            <div class="container">
                <div class="row justify-content-center text-center mb-5">
                    <div class="col-lg-10">
                        <div class="islamic-welcome">
                            <h1 class="arabic-font mb-3">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيم</h1>
                            <h2 class="mb-4">Islamic Prayer Times & Mosque Finder</h2>
                            <p class="lead">Your complete Islamic companion for prayer times, mosque locations, Qibla
                                direction, and spiritual tools. Stay connected with your faith wherever you are.</p>
                        </div>
                    </div>
                </div>

                <!-- Next Prayer Countdown -->
                <div id="next-prayer-section" class="next-prayer-countdown d-none">
                    <h4><i class="fas fa-clock me-2"></i>Next Prayer</h4>
                    <div id="next-prayer-name">Maghrib</div>
                    <div class="countdown-time" id="countdown-timer">02:34:15</div>
                    <p class="mb-0">Time remaining</p>
                </div>

                <!-- Islamic Date -->
                <div class="islamic-date d-none" id="islamic-date">
                    <h6 class="mb-1">Today's Islamic Date</h6>
                    <div id="hijri-date">Loading...</div>
                </div>

                <!-- Tools Grid -->
                <div class="row g-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="prayer-times">
                            <div class="tool-icon">
                                <i class="fas fa-pray"></i>
                            </div>
                            <h4 class="tool-title">Prayer Times</h4>
                            <p class="tool-description">Get accurate Namaz timings with countdown and notifications</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="mosque-finder">
                            <div class="tool-icon">
                                <i class="fas fa-mosque"></i>
                            </div>
                            <h4 class="tool-title">Mosque Finder</h4>
                            <p class="tool-description">Find nearby mosques sorted by distance with directions</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="qibla">
                            <div class="tool-icon">
                                <i class="fas fa-compass"></i>
                            </div>
                            <h4 class="tool-title">Qibla Finder</h4>
                            <p class="tool-description">Find accurate direction to Mecca with compass</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="dhikr">
                            <div class="tool-icon">
                                <i class="fas fa-hands"></i>
                            </div>
                            <h4 class="tool-title">Dhikr Counter</h4>
                            <p class="tool-description">Digital Tasbih counter for your daily dhikr</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Prayer Times Section -->
        <section id="prayer-times" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h1><i class="fas fa-pray me-3"></i>Prayer Times</h1>
                    <p class="lead">Accurate Namaz timings with advanced features</p>
                </div>

                <!-- Location Loading -->
                <div id="prayer-loading" class="text-center mb-4">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading prayer times...</span>
                    </div>
                    <p class="mt-2">Loading prayer times for your location...</p>
                </div>

                <!-- Location Error -->
                <div id="prayer-error" class="alert alert-warning text-center d-none" role="alert">
                    <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Unable to get your
                        location</h5>
                    <p class="mb-0">Please allow location access to view accurate prayer times for your area.</p>
                </div>

                <!-- Prayer Calculation Method -->
                <div id="calculation-method" class="card mb-4 d-none">
                    <div class="card-header">
                        <i class="fas fa-calculator me-2"></i>Calculation Method
                    </div>
                    <div class="card-body">
                        <select class="form-select" id="methodSelect">
                            <option value="2">Islamic Society of North America (ISNA)</option>
                            <option value="1">University of Islamic Sciences, Karachi</option>
                            <option value="3">Muslim World League</option>
                            <option value="4">Umm Al-Qura University, Makkah</option>
                            <option value="5">Egyptian General Authority of Survey</option>
                        </select>
                    </div>
                </div>

                <!-- Location Card -->
                <div id="prayer-location-card" class="location-card mb-4 d-none">
                    <div class="card-header">
                        <i class="fas fa-map-marker-alt me-2"></i>Current Location
                    </div>
                    <div class="card-body">
                        <p class="mb-0">
                            <strong id="prayer-city">Loading...</strong>,
                            <span id="prayer-country">Loading...</span>
                        </p>
                        <small class="text-muted">
                            Coordinates: <span id="prayer-coordinates">---, ---</span>
                        </small>
                    </div>
                </div>

                <!-- Time Format Toggle -->
                <div id="prayer-format-toggle" class="text-center mb-4 d-none">
                    <div class="form-check form-switch d-inline-block">
                        <input class="form-check-input" type="checkbox" id="timeFormatSwitch" checked>
                        <label class="form-check-label" for="timeFormatSwitch">
                            <span id="timeFormatLabel">24-hour format</span>
                        </label>
                    </div>
                </div>

                <!-- Prayer Times Grid -->
                <div id="prayer-times-grid" class="row g-4 d-none">
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="fajr-card">
                            <div class="prayer-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="prayer-name">Fajr</div>
                            <div class="prayer-time" id="fajr-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="dhuhr-card">
                            <div class="prayer-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="prayer-name">Dhuhr</div>
                            <div class="prayer-time" id="dhuhr-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="asr-card">
                            <div class="prayer-icon">
                                <i class="fas fa-cloud-sun"></i>
                            </div>
                            <div class="prayer-name">Asr</div>
                            <div class="prayer-time" id="asr-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="maghrib-card">
                            <div class="prayer-icon">
                                <i class="fas fa-moon"></i>
                            </div>
                            <div class="prayer-name">Maghrib</div>
                            <div class="prayer-time" id="maghrib-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="isha-card">
                            <div class="prayer-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="prayer-name">Isha</div>
                            <div class="prayer-time" id="isha-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="sunrise-card">
                            <div class="prayer-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="prayer-name">Sunrise</div>
                            <div class="prayer-time" id="sunrise-time">--:--</div>
                        </div>
                    </div>
                </div>

                <!-- Prayer Notifications -->
                <div id="prayer-notifications" class="card mt-4 d-none">
                    <div class="card-header">
                        <i class="fas fa-bell me-2"></i>Prayer Notifications
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="notificationSwitch">
                            <label class="form-check-label" for="notificationSwitch">
                                Enable prayer time notifications
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mosque Finder Section -->
        <section id="mosque-finder" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h1><i class="fas fa-mosque me-3"></i>Mosque Finder</h1>
                    <p class="lead">Find nearby mosques with directions and details</p>
                </div>

                <!-- Location Loading -->
                <div id="mosque-loading" class="text-center mb-4">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Searching for mosques...</span>
                    </div>
                    <p class="mt-2">Searching for mosques in your area...</p>
                </div>

                <!-- Location Error -->
                <div id="mosque-error" class="alert alert-warning text-center d-none" role="alert">
                    <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Location Required</h5>
                    <p class="mb-0">Please allow location access to find nearby mosques.</p>
                </div>

                <!-- Filter Controls -->
                <div id="filter-controls" class="filter-controls d-none">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="radiusSelect" class="form-label">Search Radius</label>
                            <select class="form-select" id="radiusSelect">
                                <option value="1000">1 km</option>
                                <option value="2000">2 km</option>
                                <option value="5000" selected>5 km</option>
                                <option value="10000">10 km</option>
                                <option value="20000">20 km</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="sortSelect" class="form-label">Sort By</label>
                            <select class="form-select" id="sortSelect">
                                <option value="distance" selected>Distance</option>
                                <option value="rating">Rating</option>
                                <option value="name">Name</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="filterSelect" class="form-label">Filter</label>
                            <select class="form-select" id="filterSelect">
                                <option value="all" selected>All Mosques</option>
                                <option value="open">Open Now</option>
                                <option value="rated">Highly Rated</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div id="mosque-results" class="row d-none">
                    <!-- Map Column -->
                    <div class="col-lg-6 mb-4">
                        <div class="map-container">
                            <div id="mosque-map"></div>
                        </div>
                    </div>

                    <!-- List Column -->
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-list me-2"></i>Nearby Mosques
                                    <span class="badge bg-secondary ms-2" id="mosque-count">0</span>
                                </h5>
                            </div>
                            <div class="card-body" style="max-height: 500px; overflow-y: auto;">
                                <div id="mosque-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Qibla Finder Section -->
        <section id="qibla" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h1><i class="fas fa-compass me-3"></i>Qibla Finder</h1>
                    <p class="lead">Find accurate direction to Mecca with compass</p>
                </div>

                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="qibla-compass">
                            <h4 class="mb-4">Direction to Mecca</h4>
                            <div class="compass-circle">
                                <i class="fas fa-location-arrow qibla-arrow" id="qibla-arrow"></i>
                            </div>
                            <div class="mt-4">
                                <p class="mb-1">Qibla Direction</p>
                                <h3 id="qibla-degree" class="text-primary">0°</h3>
                                <small class="text-muted">Point your device north and follow the arrow</small>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-primary" onclick="app.calculateQibla()">
                                    <i class="fas fa-sync-alt me-2"></i>Refresh Direction
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dhikr Counter Section -->
        <section id="dhikr" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h1><i class="fas fa-hands me-3"></i>Dhikr Counter</h1>
                    <p class="lead">Digital Tasbih counter for your daily dhikr</p>
                </div>

                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="dhikr-counter">
                            <h4 class="mb-4">Digital Tasbih</h4>
                            <div class="dhikr-count" id="dhikr-count">0</div>
                            <button class="dhikr-button" id="dhikr-button">
                                <i class="fas fa-hand-paper"></i>
                            </button>
                            <div class="mt-4">
                                <p class="mb-2">Goal: <span id="dhikr-goal">100</span></p>
                                <div class="progress mb-3" style="height: 10px;">
                                    <div class="progress-bar bg-success" id="dhikr-progress" style="width: 0%"></div>
                                </div>
                                <div class="btn-group" role="group">
                                    <button class="btn btn-outline-primary btn-sm" onclick="app.resetDhikr()">
                                        <i class="fas fa-undo me-1"></i>Reset
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm" onclick="app.setDhikrGoal()">
                                        <i class="fas fa-target me-1"></i>Set Goal
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h1>About Islamic Prayer Times</h1>
                    <p class="lead">Your trusted companion for Islamic worship and spiritual guidance</p>
                </div>

                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <article class="islamic-welcome">
                            <h2>Accurate Prayer Times for Muslims Worldwide</h2>
                            <p>Our Islamic Prayer Times application provides precise Namaz timings based on your
                                geographical location. Whether you're at home or traveling, never miss your daily
                                prayers with our accurate calculation methods approved by Islamic authorities.</p>

                            <h3>Features</h3>
                            <ul>
                                <li><strong>Precise Prayer Times:</strong> Calculate Fajr, Dhuhr, Asr, Maghrib, and Isha
                                    prayer times</li>
                                <li><strong>Mosque Finder:</strong> Locate nearby mosques with directions and contact
                                    information</li>
                                <li><strong>Qibla Direction:</strong> Find the accurate direction to Mecca from anywhere
                                    in the world</li>
                                <li><strong>Islamic Calendar:</strong> Stay updated with Hijri dates and Islamic events
                                </li>
                                <li><strong>Dhikr Counter:</strong> Digital Tasbih for your daily remembrance of Allah
                                </li>
                                <li><strong>Prayer Notifications:</strong> Get reminded before each prayer time</li>
                            </ul>

                            <h3>Calculation Methods</h3>
                            <p>We support multiple calculation methods including:</p>
                            <ul>
                                <li>Islamic Society of North America (ISNA)</li>
                                <li>University of Islamic Sciences, Karachi</li>
                                <li>Muslim World League</li>
                                <li>Umm Al-Qura University, Makkah</li>
                                <li>Egyptian General Authority of Survey</li>
                            </ul>

                            <h3>Privacy & Data</h3>
                            <p>We respect your privacy. Location data is only used locally on your device to calculate
                                prayer times and find nearby mosques. No personal information is stored or shared.</p>
                        </article>
                    </div>
                </div>

                <!-- FAQ Section -->
                <div class="row mt-5">
                    <div class="col-lg-10 mx-auto">
                        <h2 class="text-center mb-4">Frequently Asked Questions</h2>
                        <div class="accordion" id="faqAccordion">
                            <div class="accordion-item">
                                <h3 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#faq1">
                                        How accurate are the prayer times?
                                    </button>
                                </h3>
                                <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        Our prayer times are calculated using internationally recognized methods and are
                                        accurate to within minutes for your specific location. We use precise
                                        geographical coordinates and established Islamic calculation methods.
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#faq2">
                                        Can I change the calculation method?
                                    </button>
                                </h3>
                                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        Yes, you can choose from multiple calculation methods in the Prayer Times
                                        section. Different methods may vary slightly based on the angles used for Fajr
                                        and Isha prayers.
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h3 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#faq3">
                                        Do I need to allow location access?
                                    </button>
                                </h3>
                                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        Yes, location access is required to provide accurate prayer times for your area
                                        and to find nearby mosques. Your location data is processed locally and never
                                        stored or shared.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-islamic-green text-white py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 arabic-font">"وَأَقِيمُوا الصَّلَاةَ وَآتُوا الزَّكَاةَ وَارْكَعُوا مَعَ
                        الرَّاكِعِينَ"</p>
                    <small class="text-light">"And establish prayer and give zakah and bow with those who bow." - Quran
                        2:43</small>
                </div>
                <div class="col-md-6 text-md-end footer-links">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms of Service</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#disclaimerModal">Disclaimer</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#cookiesModal">Cookie Policy</a>
                    <small>&copy; 2025 Islamic Prayer Times App</small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Legal Modals -->
    <!-- Privacy Policy Modal -->
    <div class="modal fade legal-modal" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel"><i class="fas fa-shield-alt me-2"></i>Privacy Policy
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>1. Information We Collect</h5>
                    <p>Our Islamic Prayer Times app collects limited information to provide you with accurate prayer
                        times and mosque locations:</p>
                    <ul>
                        <li><strong>Location Data:</strong> We collect your device's geographical coordinates to
                            calculate accurate prayer times and find nearby mosques.</li>
                        <li><strong>Usage Data:</strong> We may collect information about how you interact with our app
                            to improve user experience.</li>
                        <li><strong>Device Information:</strong> We collect device type and browser information for
                            compatibility purposes.</li>
                    </ul>

                    <h5>2. How We Use Your Information</h5>
                    <p>We use the collected information solely for the purpose of providing and improving our services:
                    </p>
                    <ul>
                        <li>To calculate accurate prayer times based on your location</li>
                        <li>To locate mosques near your current position</li>
                        <li>To improve app functionality and user experience</li>
                        <li>To provide customer support</li>
                    </ul>

                    <h5>3. Data Storage and Security</h5>
                    <p>We prioritize the security of your information:</p>
                    <ul>
                        <li>Location data is processed in real-time and not stored on our servers</li>
                        <li>We implement appropriate security measures to protect your information</li>
                        <li>We do not sell or share your personal information with third parties</li>
                    </ul>

                    <h5>4. Your Rights</h5>
                    <p>You have the right to:</p>
                    <ul>
                        <li>Access the personal information we hold about you</li>
                        <li>Request correction of inaccurate information</li>
                        <li>Request deletion of your personal data</li>
                        <li>Opt-out of data collection (though this may limit app functionality)</li>
                    </ul>

                    <h5>5. Changes to This Policy</h5>
                    <p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting
                        the new Privacy Policy on this page and updating the "Last Updated" date.</p>

                    <p class="mt-4"><strong>Last Updated:</strong> January 1, 2025</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Terms of Service Modal -->
    <div class="modal fade legal-modal" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel"><i class="fas fa-file-contract me-2"></i>Terms of
                        Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>1. Acceptance of Terms</h5>
                    <p>By accessing and using the Islamic Prayer Times app, you accept and agree to be bound by the
                        terms and provision of this agreement.</p>

                    <h5>2. Use License</h5>
                    <p>Permission is granted to temporarily use the Islamic Prayer Times app for personal,
                        non-commercial transitory viewing only.</p>

                    <h5>3. Disclaimer</h5>
                    <p>The prayer times and mosque locations are provided for informational purposes only. While we
                        strive to provide accurate information, we cannot guarantee the absolute accuracy of prayer
                        times or mosque locations.</p>

                    <h5>4. Limitations</h5>
                    <p>In no event shall Islamic Prayer Times or its suppliers be liable for any damages arising out of
                        the use or inability to use the services provided by the app.</p>

                    <h5>5. Accuracy of Materials</h5>
                    <p>The materials appearing in the Islamic Prayer Times app could include technical, typographical,
                        or photographic errors. We do not warrant that any of the materials on its app are accurate,
                        complete or current.</p>

                    <h5>6. Modifications</h5>
                    <p>Islamic Prayer Times may revise these terms of service for its app at any time without notice. By
                        using this app you are agreeing to be bound by the then current version of these terms of
                        service.</p>

                    <h5>7. Governing Law</h5>
                    <p>These terms and conditions are governed by and construed in accordance with the laws and any
                        disputes relating to these terms and conditions will be subject to the exclusive jurisdiction of
                        the courts.</p>

                    <p class="mt-4"><strong>Last Updated:</strong> January 1, 2025</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Disclaimer Modal -->
    <div class="modal fade legal-modal" id="disclaimerModal" tabindex="-1" aria-labelledby="disclaimerModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="disclaimerModalLabel"><i
                            class="fas fa-exclamation-circle me-2"></i>Disclaimer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>1. Prayer Times Accuracy</h5>
                    <p>The prayer times provided by this app are calculated using established mathematical formulas and
                        are based on your geographical location. While we strive to provide accurate prayer times,
                        actual prayer times may vary slightly based on local customs, mosque announcements, and other
                        factors. Users are advised to confirm prayer times with their local mosque for religious
                        obligations.</p>

                    <h5>2. Mosque Locations</h5>
                    <p>The mosque locations are sourced from OpenStreetMap and may not be comprehensive or completely
                        accurate. The inclusion or exclusion of any mosque does not represent an endorsement or
                        criticism of that institution. We recommend verifying mosque information before visiting.</p>

                    <h5>3. Religious Considerations</h5>
                    <p>This app is intended as a helpful tool for Muslims but should not replace religious knowledge or
                        guidance from qualified scholars. Users are responsible for ensuring their prayers and religious
                        practices comply with their understanding of Islamic requirements.</p>

                    <h5>4. Technical Limitations</h5>
                    <p>The accuracy of location-based services depends on your device's capabilities and connectivity.
                        Results may vary based on GPS accuracy, network availability, and other technical factors beyond
                        our control.</p>

                    <h5>5. No Warranty</h5>
                    <p>The Islamic Prayer Times app is provided "as is" without any warranties, expressed or implied. We
                        make no guarantees regarding the availability, accuracy, or reliability of the services.</p>

                    <h5>6. Limitation of Liability</h5>
                    <p>In no event shall the creators of this app be liable for any missed prayers, religious
                        obligations, or any direct, indirect, incidental, special, or consequential damages arising from
                        the use of or inability to use the app.</p>

                    <p class="mt-4"><strong>Last Updated:</strong> January 1, 2025</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Cookie Policy Modal -->
    <div class="modal fade legal-modal" id="cookiesModal" tabindex="-1" aria-labelledby="cookiesModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cookiesModalLabel"><i class="fas fa-cookie-bite me-2"></i>Cookie Policy
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>1. What Are Cookies</h5>
                    <p>Cookies are small text files that are stored on your device when you visit websites or use web
                        applications. They are widely used to make websites work efficiently and provide information to
                        the owners of the site.</p>

                    <h5>2. How We Use Cookies</h5>
                    <p>Our Islamic Prayer Times app uses cookies for the following purposes:</p>
                    <ul>
                        <li><strong>Essential Cookies:</strong> These are necessary for the app to function properly.
                            They enable core functionality such as location services and prayer time calculations.</li>
                        <li><strong>Preference Cookies:</strong> These remember your choices such as time format
                            preferences (12-hour or 24-hour format).</li>
                        <li><strong>Analytical Cookies:</strong> These help us understand how users interact with our
                            app, allowing us to improve its functionality and user experience.</li>
                    </ul>

                    <h5>3. Third-Party Cookies</h5>
                    <p>We may use services from third parties that place cookies on your device:</p>
                    <ul>
                        <li><strong>Mapping Services:</strong> Our mosque finder feature uses OpenStreetMap which may
                            place cookies for functionality.</li>
                        <li><strong>Analytics Services:</strong> We use analytics services to understand how our app is
                            being used and to make improvements.</li>
                    </ul>

                    <h5>4. Managing Cookies</h5>
                    <p>You can control and manage cookies in various ways:</p>
                    <ul>
                        <li>Most browsers allow you to refuse cookies or delete them. You can usually find these
                            settings in your browser's "options" or "preferences" menu.</li>
                        <li>Please note that disabling cookies may affect the functionality of our app and many other
                            websites that you visit.</li>
                    </ul>

                    <h5>5. Consent</h5>
                    <p>By using our app, you consent to the use of cookies in accordance with this Cookie Policy. If you
                        do not agree to our use of cookies, you should adjust your browser settings appropriately or
                        discontinue use of our app.</p>

                    <h5>6. Changes to This Policy</h5>
                    <p>We may update our Cookie Policy from time to time. We will notify you of any changes by posting
                        the new Cookie Policy on this page.</p>

                    <p class="mt-4"><strong>Last Updated:</strong> January 1, 2025</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>

    <!-- Leaflet JS for Maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

    <script>
        // Enhanced Islamic Prayer Times App - JavaScript
        class IslamicApp {
            constructor() {
                // this.userLocation = null;

                this.userLocation = JSON.parse(localStorage.getItem('userLocation')) || null;//ADDED FOR REFRESH ISSUE

                // Your existing constructor code
                this.map = null;
                this.mosqueMarkers = [];
                this.mosqueData = [];
                this.prayerTimes = null;
                this.is24HourFormat = true;
                this.calculationMethod = 2;
                this.dhikrCount = parseInt(localStorage.getItem('dhikrCount')) || 0;
                this.dhikrGoal = parseInt(localStorage.getItem('dhikrGoal')) || 100;
                this.qiblaDirection = 0;
                this.nextPrayerTimer = null;
                this.locationDetectionFailed = false;

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.detectLocation();
                this.initDhikrCounter();
                this.requestNotificationPermission();
                this.loadIslamicDate();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('[data-section]').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const sectionId = e.target.getAttribute('data-section') || e.target.closest('[data-section]').getAttribute('data-section');
                        this.showSection(sectionId);

                        if (e.target.classList.contains('nav-link')) {
                            this.updateActiveNav(e.target);
                        } else {
                            const navLink = document.querySelector(`[data-section="${sectionId}"].nav-link`);
                            if (navLink) {
                                this.updateActiveNav(navLink);
                            }
                        }
                    });
                });

                // Time format toggle
                const timeFormatSwitch = document.getElementById('timeFormatSwitch');
                if (timeFormatSwitch) {
                    const savedFormat = localStorage.getItem('timeFormat');
                    this.is24HourFormat = savedFormat ? savedFormat === '24' : true;
                    timeFormatSwitch.checked = this.is24HourFormat;
                    this.updateTimeFormatLabel();
                    timeFormatSwitch.addEventListener('change', (e) => {
                        this.is24HourFormat = e.target.checked;
                        localStorage.setItem('timeFormat', this.is24HourFormat ? '24' : '12');
                        this.updateTimeFormatLabel();
                        if (this.prayerTimes) {
                            this.displayPrayerTimes();
                        }
                    });
                }

                // Calculation method selector
                const methodSelect = document.getElementById('methodSelect');
                if (methodSelect) {
                    methodSelect.value = this.calculationMethod;
                    methodSelect.addEventListener('change', (e) => {
                        this.calculationMethod = parseInt(e.target.value);
                        if (this.userLocation) {
                            this.loadPrayerTimes();
                        }
                    });
                }

                // Filter controls for mosques
                document.getElementById('radiusSelect')?.addEventListener('change', () => this.filterMosques());
                document.getElementById('sortSelect')?.addEventListener('change', () => this.sortAndDisplayMosques());
                document.getElementById('filterSelect')?.addEventListener('change', () => this.filterMosques());

                // Notification toggle
                const notificationSwitch = document.getElementById('notificationSwitch');
                if (notificationSwitch) {
                    notificationSwitch.checked = localStorage.getItem('notificationsEnabled') === 'true';
                    notificationSwitch.addEventListener('change', (e) => {
                        localStorage.setItem('notificationsEnabled', e.target.checked);
                    });
                }

                // Handle initial hash - FIXED VERSION
                this.handleInitialLoad();
            }

            // NEW METHOD: Handle initial page load properly
            handleInitialLoad() {
                let sectionId = 'landing'; // default

                if (window.location.hash) {
                    const hashSection = window.location.hash.substring(1);
                    // Check if the section exists
                    if (document.getElementById(hashSection)) {
                        sectionId = hashSection;
                    }
                }

                this.showSection(sectionId);

                // Update navbar to reflect current section
                const currentNavLink = document.querySelector(`[data-section="${sectionId}"].nav-link`);
                if (currentNavLink) {
                    this.updateActiveNav(currentNavLink);
                }
            }

            // UPDATED METHOD: Better section showing with loading state management
            showSection(sectionId) {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');

                    // Handle section-specific initialization with proper loading state management
                    if (sectionId === 'prayer-times') {
                        this.initializePrayerTimesSection();
                    } else if (sectionId === 'mosque-finder') {
                        this.initializeMosqueFinderSection();
                    } else if (sectionId === 'qibla' && this.userLocation) {
                        this.calculateQibla();
                    }
                }

                // Update URL hash
                if (window.location.hash !== '#' + sectionId) {
                    window.location.hash = sectionId;
                }
            }

            // NEW METHOD: Initialize Prayer Times section properly
            initializePrayerTimesSection() {
                if (this.userLocation) {
                    // We have location, load prayer times if not already loaded
                    if (!this.prayerTimes) {
                        this.loadPrayerTimes();
                    } else {
                        // Already have prayer times, just display them
                        this.displayPrayerTimes();
                    }
                } else {
                    // No location yet, show loading or wait for location detection to complete
                    const loadingElement = document.getElementById('prayer-loading');
                    const errorElement = document.getElementById('prayer-error');

                    if (loadingElement && errorElement) {
                        // Check if location detection failed previously
                        if (this.locationDetectionFailed) {
                            loadingElement.classList.add('d-none');
                            errorElement.classList.remove('d-none');
                        } else {
                            // Still waiting for location detection
                            loadingElement.classList.remove('d-none');
                            errorElement.classList.add('d-none');
                        }
                    }
                }
            }

            // NEW METHOD: Initialize Mosque Finder section properly  
            initializeMosqueFinderSection() {
                if (this.userLocation) {
                    // We have location, load mosques if not already loaded
                    if (this.mosqueData.length === 0) {
                        this.loadMosques();
                    } else {
                        // Already have mosque data, just display them
                        this.displayMosques();
                        if (this.map) {
                            setTimeout(() => this.map.invalidateSize(), 100);
                        }
                    }
                } else {
                    // No location yet, show appropriate state
                    const mosqueLoading = document.getElementById('mosque-loading');
                    const mosqueError = document.getElementById('mosque-error');

                    if (mosqueLoading && mosqueError) {
                        if (this.locationDetectionFailed) {
                            mosqueLoading.classList.add('d-none');
                            mosqueError.classList.remove('d-none');
                        } else {
                            mosqueLoading.classList.remove('d-none');
                            mosqueError.classList.add('d-none');
                        }
                    }
                }
            }

            // FIXED: Navigation highlighting
            updateActiveNav(activeLink) {
                // Remove active class from ALL nav links first
                document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                // Add active class only to the clicked link
                activeLink.classList.add('active');

                // Update breadcrumb
                this.updateBreadcrumb(activeLink.textContent);
            }

            // NEW: Update breadcrumb
            updateBreadcrumb(pageName) {
                const breadcrumbNav = document.getElementById('breadcrumb-nav');
                const currentPage = document.getElementById('current-page');

                if (breadcrumbNav && currentPage) {
                    if (pageName === 'Home') {
                        breadcrumbNav.classList.add('d-none');
                    } else {
                        breadcrumbNav.classList.remove('d-none');
                        currentPage.textContent = pageName;
                    }
                }
            }

            //new sami code
            //   setupEventListeners() {
            //     // Navigation
            //     document.querySelectorAll('[data-section]').forEach(link => {
            //         link.addEventListener('click', (e) => {
            //             e.preventDefault();
            //             const sectionId = e.target.getAttribute('data-section') ||
            //                 e.target.closest('[data-section]').getAttribute('data-section');
            //             this.showSection(sectionId);

            //             if (e.target.classList.contains('nav-link')) {
            //                 this.updateActiveNav(e.target);
            //             } else {
            //                 const navLink = document.querySelector(`[data-section="${sectionId}"].nav-link`);
            //                 if (navLink) {
            //                     this.updateActiveNav(navLink);
            //                 }
            //             }
            //         });
            //     });

            //     // Time format toggle
            //     const timeFormatSwitch = document.getElementById('timeFormatSwitch');
            //     if (timeFormatSwitch) {
            //         const savedFormat = localStorage.getItem('timeFormat');
            //         this.is24HourFormat = savedFormat ? savedFormat === '24' : true;
            //         timeFormatSwitch.checked = this.is24HourFormat;
            //         this.updateTimeFormatLabel();
            //         timeFormatSwitch.addEventListener('change', (e) => {
            //             this.is24HourFormat = e.target.checked;
            //             localStorage.setItem('timeFormat', this.is24HourFormat ? '24' : '12');
            //             this.updateTimeFormatLabel();
            //             if (this.prayerTimes) {
            //                 this.displayPrayerTimes();
            //             }
            //         });
            //     }

            //     // Calculation method selector
            //     const methodSelect = document.getElementById('methodSelect');
            //     if (methodSelect) {
            //         methodSelect.value = this.calculationMethod;
            //         methodSelect.addEventListener('change', (e) => {
            //             this.calculationMethod = parseInt(e.target.value);
            //             if (this.userLocation) {
            //                 this.loadPrayerTimes();
            //             }
            //         });
            //     }

            //     // Filter controls for mosques
            //     document.getElementById('radiusSelect')?.addEventListener('change', () => this.filterMosques());
            //     document.getElementById('sortSelect')?.addEventListener('change', () => this.sortAndDisplayMosques());
            //     document.getElementById('filterSelect')?.addEventListener('change', () => this.filterMosques());

            //     // Notification toggle
            //     const notificationSwitch = document.getElementById('notificationSwitch');
            //     if (notificationSwitch) {
            //         notificationSwitch.checked = localStorage.getItem('notificationsEnabled') === 'true';
            //         notificationSwitch.addEventListener('change', (e) => {
            //             localStorage.setItem('notificationsEnabled', e.target.checked);
            //         });
            //     }

            //     // Handle hash changes (when user navigates using browser back/forward)
            //     window.addEventListener('hashchange', () => {
            //         const sectionId = window.location.hash.substring(1);
            //         if (sectionId) {
            //             this.showSection(sectionId);
            //         }
            //     });

            //     // Handle initial page load - check hash first, then load appropriate section
            //     if (window.location.hash) {
            //         const sectionId = window.location.hash.substring(1);
            //         // Wait a bit for the DOM to be fully ready before showing the section
            //         setTimeout(() => {
            //             this.showSection(sectionId);
            //         }, 100);
            //     } else {
            //         this.showSection('landing');
            //     }
            // }

            // // Update your showSection method to handle the navigation highlighting properly:
            // showSection(sectionId) {
            //     // Hide all sections
            //     document.querySelectorAll('.section').forEach(section => {
            //         section.classList.remove('active');
            //     });

            //     // Show the target section
            //     const targetSection = document.getElementById(sectionId);
            //     if (targetSection) {
            //         targetSection.classList.add('active');

            //         // Update the URL hash without triggering the hashchange event
            //         const currentHash = window.location.hash.substring(1);
            //         if (currentHash !== sectionId) {
            //             window.location.hash = sectionId;
            //         }

            //         // Update navigation highlighting
            //         const navLink = document.querySelector(`[data-section="${sectionId}"].nav-link`);
            //         if (navLink) {
            //             this.updateActiveNav(navLink);
            //         }

            //         // Load section-specific content if needed
            //         if (sectionId === 'prayer-times' && this.userLocation && !this.prayerTimes) {
            //             this.loadPrayerTimes();
            //         } else if (sectionId === 'mosque-finder' && this.userLocation) {
            //             // Initialize map if not already done
            //             if (!this.map) {
            //                 this.initializeMap();
            //             }
            //             this.loadMosques();
            //         } else if (sectionId === 'qibla' && this.userLocation) {
            //             this.calculateQibla();
            //         }
            //     }
            // }

            // // Update your updateActiveNav method:
            // updateActiveNav(activeLink) {
            //     document.querySelectorAll('.nav-link').forEach(link => {
            //         link.classList.remove('active');
            //     });
            //     activeLink.classList.add('active');
            // }

            //new sami code

            // NEW: Get directions to a mosque
            getDirections(lat, lng, name) {
                if (!this.userLocation) {
                    alert('Unable to get directions. Location not available.');
                    return;
                }

                // Open Google Maps with directions
                const directionsUrl = `https://www.google.com/maps/dir/${this.userLocation.lat},${this.userLocation.lng}/${lat},${lng}`;
                window.open(directionsUrl, '_blank');
            }

            // NEW: Focus on a specific mosque on the map
            focusOnMap(lat, lng) {
                if (this.map) {
                    this.map.setView([lat, lng], 16);

                    // Find and highlight the marker
                    this.mosqueMarkers.forEach(marker => {
                        if (Math.abs(marker.getLatLng().lat - lat) < 0.0001 && Math.abs(marker.getLatLng().lng - lng) < 0.0001) {
                            marker.openPopup();
                        }
                    });
                }
            }

            updateTimeFormatLabel() {
                const label = document.getElementById('timeFormatLabel');
                if (label) {
                    label.textContent = this.is24HourFormat ? '24-hour format' : '12-hour format';
                }
            }

            // detectLocation() {
            //     if (!navigator.geolocation) {
            //         this.locationDetectionFailed = true;
            //         this.showLocationError('Geolocation is not supported by this browser.');
            //         return;
            //     }

            //     navigator.geolocation.getCurrentPosition(
            //         (position) => {
            //             this.userLocation = {
            //                 lat: position.coords.latitude,
            //                 lng: position.coords.longitude
            //             };
            //             this.locationDetectionFailed = false;
            //             this.getReverseGeocoding();
            //         },
            //         (error) => {
            //             this.locationDetectionFailed = true;
            //             let errorMessage = 'Unable to get your location.';

            //             switch (error.code) {
            //                 case error.PERMISSION_DENIED:
            //                     errorMessage = 'Location access denied. Please enable location services.';
            //                     break;
            //                 case error.POSITION_UNAVAILABLE:
            //                     errorMessage = 'Location information is unavailable.';
            //                     break;
            //                 case error.TIMEOUT:
            //                     errorMessage = 'Location request timed out.';
            //                     break;
            //             }

            //             this.showLocationError(errorMessage);
            //         },
            //         {
            //             enableHighAccuracy: true,
            //             timeout: 10000,
            //             maximumAge: 60000
            //         }
            //     );
            // }

            //BEBIN CHANGE FOR REFRESH ISSUE
            detectLocation() {
                if (!navigator.geolocation) {
                    this.locationDetectionFailed = true;
                    this.showLocationError('Geolocation is not supported by this browser.');
                    return;
                }

                // Check if we have a stored location that's still valid (less than 1 hour old)
                const storedLocation = JSON.parse(localStorage.getItem('userLocation'));
                const storedTimestamp = localStorage.getItem('locationTimestamp');
                const oneHour = 60 * 60 * 1000; // 1 hour in milliseconds

                if (storedLocation && storedTimestamp && (Date.now() - storedTimestamp < oneHour)) {
                    this.userLocation = storedLocation;
                    this.locationDetectionFailed = false;
                    this.getReverseGeocoding();
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        this.userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };

                        // Store location and timestamp
                        localStorage.setItem('userLocation', JSON.stringify(this.userLocation));
                        localStorage.setItem('locationTimestamp', Date.now());

                        this.locationDetectionFailed = false;
                        this.getReverseGeocoding();
                    },
                    (error) => {
                        this.locationDetectionFailed = true;
                        let errorMessage = 'Unable to get your location.';

                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Location access denied. Please enable location services.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Location information is unavailable.';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Location request timed out.';
                                break;
                        }

                        this.showLocationError(errorMessage);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            }
            //END CHANGE FOR REFRESH ISSUE

            // async getReverseGeocoding() {
            //     try {
            //         const response = await fetch(
            //             `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${this.userLocation.lat}&longitude=${this.userLocation.lng}&localityLanguage=en`
            //         );
            //         const data = await response.json();

            //         this.userLocation.city = data.city || data.locality || 'Unknown';
            //         this.userLocation.country = data.countryName || 'Unknown';

            //         this.displayLocationInfo();
            //         this.calculateQibla();
            //     } catch (error) {
            //         console.error('Error getting location details:', error);
            //         this.userLocation.city = 'Unknown';
            //         this.userLocation.country = 'Unknown';
            //         this.displayLocationInfo();
            //     }
            // }

            async getReverseGeocoding() {
                try {
                    const response = await fetch(
                        `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${this.userLocation.lat}&longitude=${this.userLocation.lng}&localityLanguage=en`
                    );
                    const data = await response.json();

                    this.userLocation.city = data.city || data.locality || 'Unknown';
                    this.userLocation.country = data.countryName || 'Unknown';

                    // ADD THIS LINE to update stored location with city/country info
                    localStorage.setItem('userLocation', JSON.stringify(this.userLocation));

                    this.displayLocationInfo();
                    this.calculateQibla();
                } catch (error) {
                    console.error('Error getting location details:', error);
                    this.userLocation.city = 'Unknown';
                    this.userLocation.country = 'Unknown';
                    this.displayLocationInfo();
                }
            }
            displayLocationInfo() {
                // Update location info elements
                this.updateElementText('prayer-city', this.userLocation.city);
                this.updateElementText('prayer-country', this.userLocation.country);
                this.updateElementText('prayer-coordinates',
                    `${this.userLocation.lat.toFixed(4)}, ${this.userLocation.lng.toFixed(4)}`);
            }

            updateElementText(elementId, text) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = text;
                }
            }

            showLocationError(message) {
                // Hide loading for prayer times
                document.getElementById('prayer-loading')?.classList.add('d-none');
                document.getElementById('prayer-error')?.classList.remove('d-none');

                // Hide loading for mosque finder
                document.getElementById('mosque-loading')?.classList.add('d-none');
                document.getElementById('mosque-error')?.classList.remove('d-none');

                // Update error messages
                const prayerErrorElement = document.getElementById('prayer-error');
                if (prayerErrorElement) {
                    prayerErrorElement.innerHTML = `
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Location Error</h5>
                        <p class="mb-0">${message}</p>
                    `;
                }

                const mosqueErrorElement = document.getElementById('mosque-error');
                if (mosqueErrorElement) {
                    mosqueErrorElement.innerHTML = `
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Location Required</h5>
                        <p class="mb-0">${message}</p>
                    `;
                }
            }

            async loadPrayerTimes() {
                if (!this.userLocation) return;

                try {
                    const response = await fetch(
                        `https://api.aladhan.com/v1/timings/date-string?latitude=${this.userLocation.lat}&longitude=${this.userLocation.lng}&method=${this.calculationMethod}`
                    );
                    const data = await response.json();

                    if (data.code === 200) {
                        this.prayerTimes = data.data.timings;
                        this.displayPrayerTimes();
                        this.startNextPrayerCountdown();
                    } else {
                        throw new Error('Failed to load prayer times');
                    }
                } catch (error) {
                    console.error('Error loading prayer times:', error);
                    this.showPrayerTimesError();
                }
            }

            displayPrayerTimes() {
                if (!this.prayerTimes) return;

                // Hide loading, show content
                document.getElementById('prayer-loading')?.classList.add('d-none');
                document.getElementById('prayer-location-card')?.classList.remove('d-none');
                document.getElementById('prayer-format-toggle')?.classList.remove('d-none');
                document.getElementById('prayer-times-grid')?.classList.remove('d-none');
                document.getElementById('calculation-method')?.classList.remove('d-none');
                document.getElementById('prayer-notifications')?.classList.remove('d-none');

                // Update prayer times
                const prayers = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
                prayers.forEach(prayer => {
                    const timeElement = document.getElementById(`${prayer}-time`);
                    if (timeElement && this.prayerTimes[prayer.charAt(0).toUpperCase() + prayer.slice(1)]) {
                        const time = this.prayerTimes[prayer.charAt(0).toUpperCase() + prayer.slice(1)];
                        timeElement.textContent = this.formatTime(time);
                    }
                });

                // Update sunrise
                const sunriseElement = document.getElementById('sunrise-time');
                if (sunriseElement && this.prayerTimes.Sunrise) {
                    sunriseElement.textContent = this.formatTime(this.prayerTimes.Sunrise);
                }

                this.highlightCurrentPrayer();
            }

            formatTime(timeString) {
                const [hours, minutes] = timeString.split(':');
                const date = new Date();
                date.setHours(parseInt(hours), parseInt(minutes));

                if (this.is24HourFormat) {
                    return `${hours}:${minutes}`;
                } else {
                    return date.toLocaleTimeString('en-US', {
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    });
                }
            }

            highlightCurrentPrayer() {
                if (!this.prayerTimes) return;

                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();

                const prayers = [
                    { name: 'fajr', time: this.prayerTimes.Fajr },
                    { name: 'dhuhr', time: this.prayerTimes.Dhuhr },
                    { name: 'asr', time: this.prayerTimes.Asr },
                    { name: 'maghrib', time: this.prayerTimes.Maghrib },
                    { name: 'isha', time: this.prayerTimes.Isha }
                ];

                // Remove current prayer highlighting
                prayers.forEach(prayer => {
                    document.getElementById(`${prayer.name}-card`)?.classList.remove('current-prayer');
                });

                // Find current prayer period
                for (let i = 0; i < prayers.length; i++) {
                    const [hours, minutes] = prayers[i].time.split(':');
                    const prayerTime = parseInt(hours) * 60 + parseInt(minutes);

                    const nextIndex = (i + 1) % prayers.length;
                    const [nextHours, nextMinutes] = prayers[nextIndex].time.split(':');
                    let nextPrayerTime = parseInt(nextHours) * 60 + parseInt(nextMinutes);

                    // Handle day transition
                    if (nextPrayerTime < prayerTime) {
                        nextPrayerTime += 24 * 60;
                    }

                    if (currentTime >= prayerTime && currentTime < nextPrayerTime) {
                        document.getElementById(`${prayers[i].name}-card`)?.classList.add('current-prayer');
                        break;
                    }
                }
            }

            startNextPrayerCountdown() {
                if (!this.prayerTimes) return;

                // Clear existing timer
                if (this.nextPrayerTimer) {
                    clearInterval(this.nextPrayerTimer);
                }

                this.updateCountdown();
                this.nextPrayerTimer = setInterval(() => this.updateCountdown(), 1000);
            }

            updateCountdown() {
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();

                const prayers = [
                    { name: 'Fajr', time: this.prayerTimes.Fajr },
                    { name: 'Dhuhr', time: this.prayerTimes.Dhuhr },
                    { name: 'Asr', time: this.prayerTimes.Asr },
                    { name: 'Maghrib', time: this.prayerTimes.Maghrib },
                    { name: 'Isha', time: this.prayerTimes.Isha }
                ];

                let nextPrayer = null;
                let timeToNext = Infinity;

                prayers.forEach(prayer => {
                    const [hours, minutes] = prayer.time.split(':');
                    let prayerTime = parseInt(hours) * 60 + parseInt(minutes);

                    if (prayerTime <= currentTime) {
                        prayerTime += 24 * 60; // Next day
                    }

                    const timeDiff = prayerTime - currentTime;
                    if (timeDiff < timeToNext) {
                        timeToNext = timeDiff;
                        nextPrayer = prayer;
                    }
                });

                if (nextPrayer) {
                    const hours = Math.floor(timeToNext / 60);
                    const minutes = timeToNext % 60;
                    const seconds = 60 - now.getSeconds();

                    document.getElementById('next-prayer-name').textContent = nextPrayer.name;
                    document.getElementById('countdown-timer').textContent =
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    document.getElementById('next-prayer-section')?.classList.remove('d-none');
                }
            }

            async loadMosques() {
                if (!this.userLocation) return;

                try {
                    // Hide loading, show results
                    document.getElementById('mosque-loading')?.classList.add('d-none');
                    document.getElementById('filter-controls')?.classList.remove('d-none');
                    document.getElementById('mosque-results')?.classList.remove('d-none');

                    // Initialize map
                    this.initializeMap();

                    // Use a more comprehensive search for mosques
                    const radius = document.getElementById('radiusSelect')?.value || 5000;
                    const queries = ['mosque', 'masjid', 'islamic center', 'جامع'];

                    let allMosques = [];

                    for (const query of queries) {
                        try {
                            // Using Overpass API for OpenStreetMap data
                            const overpassUrl = `https://overpass-api.de/api/interpreter?data=[out:json];(node["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${this.userLocation.lat},${this.userLocation.lng});way["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${this.userLocation.lat},${this.userLocation.lng}););out center;`;

                            const response = await fetch(overpassUrl);
                            const data = await response.json();

                            if (data.elements) {
                                data.elements.forEach(element => {
                                    const lat = element.lat || element.center?.lat;
                                    const lng = element.lon || element.center?.lon;

                                    if (lat && lng) {
                                        const mosque = {
                                            id: element.id,
                                            name: element.tags?.name || 'Mosque',
                                            lat: lat,
                                            lng: lng,
                                            address: element.tags?.['addr:full'] || element.tags?.['addr:street'] || 'Address not available',
                                            distance: this.calculateDistance(this.userLocation.lat, this.userLocation.lng, lat, lng)
                                        };

                                        // Avoid duplicates
                                        if (!allMosques.some(m => Math.abs(m.lat - lat) < 0.001 && Math.abs(m.lng - lng) < 0.001)) {
                                            allMosques.push(mosque);
                                        }
                                    }
                                });
                            }
                        } catch (error) {
                            console.error(`Error searching for ${query}:`, error);
                        }
                    }

                    // If no results from Overpass, try a fallback with mock data
                    if (allMosques.length === 0) {
                        allMosques = this.getMockMosques();
                    }

                    this.mosqueData = allMosques.sort((a, b) => a.distance - b.distance);
                    this.displayMosques();
                    this.addMosquesToMap();

                } catch (error) {
                    console.error('Error loading mosques:', error);
                    this.showMosqueError('Unable to load mosques. Please try again.');
                }
            }

            getMockMosques() {
                // Fallback mock data for demonstration
                return [
                    {
                        id: 'mock1',
                        name: 'Central Mosque',
                        lat: this.userLocation.lat + 0.01,
                        lng: this.userLocation.lng + 0.01,
                        address: '123 Main Street, City Center',
                        distance: 1.2
                    },
                    {
                        id: 'mock2',
                        name: 'Islamic Center',
                        lat: this.userLocation.lat - 0.015,
                        lng: this.userLocation.lng + 0.02,
                        address: '456 Oak Avenue, Downtown',
                        distance: 2.1
                    },
                    {
                        id: 'mock3',
                        name: 'Community Mosque',
                        lat: this.userLocation.lat + 0.02,
                        lng: this.userLocation.lng - 0.01,
                        address: '789 Pine Road, Suburb',
                        distance: 2.8
                    }
                ];
            }

            calculateDistance(lat1, lng1, lat2, lng2) {
                const R = 6371; // Radius of the Earth in km
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLng = (lng2 - lng1) * Math.PI / 180;
                const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng / 2) * Math.sin(dLng / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            }

            initializeMap() {
                if (!this.map) {
                    this.map = L.map('mosque-map').setView([this.userLocation.lat, this.userLocation.lng], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }).addTo(this.map);

                    // Add user location marker
                    L.marker([this.userLocation.lat, this.userLocation.lng])
                        .addTo(this.map)
                        .bindPopup('Your Location')
                        .openPopup();
                }
            }

            displayMosques() {
                const mosqueList = document.getElementById('mosque-list');
                const mosqueCount = document.getElementById('mosque-count');

                if (!mosqueList) return;

                mosqueList.innerHTML = '';

                if (this.mosqueData.length === 0) {
                    mosqueList.innerHTML = '<p class="text-center text-muted">No mosques found in your area.</p>';
                    return;
                }

                mosqueCount.textContent = this.mosqueData.length;

                this.mosqueData.forEach(mosque => {
                    this.displayMosque(mosque);
                });
            }

            // UPDATED: Display mosque with direction buttons
            displayMosque(mosque) {
                const mosqueList = document.getElementById('mosque-list');
                if (!mosqueList) return;

                const mosqueElement = document.createElement('div');
                mosqueElement.className = 'mosque-item';
                const distanceText = typeof mosque.distance === 'number' ? `${mosque.distance.toFixed(1)} km` : mosque.distance;

                mosqueElement.innerHTML = `
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <div class="mosque-name">${mosque.name}</div>
                            <div class="mosque-address mb-2">${mosque.address}</div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="distance-badge">${distanceText}</span>
                                <div class="mosque-actions">
                                    <button class="btn btn-sm btn-primary me-2" onclick="app.getDirections(${mosque.lat}, ${mosque.lng}, '${mosque.name.replace(/'/g, "\\'")}')">
                                        <i class="fas fa-directions me-1"></i>Directions
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="app.focusOnMap(${mosque.lat}, ${mosque.lng})">
                                        <i class="fas fa-map-marker-alt me-1"></i>Show on Map
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                mosqueList.appendChild(mosqueElement);
            }

            addMosquesToMap() {
                if (!this.map) return;

                // Clear existing markers
                this.mosqueMarkers.forEach(marker => this.map.removeLayer(marker));
                this.mosqueMarkers = [];

                // Add mosque markers
                this.mosqueData.forEach(mosque => {
                    const marker = L.marker([mosque.lat, mosque.lng])
                        .addTo(this.map)
                        .bindPopup(`
                            <strong>${mosque.name}</strong><br>
                            ${mosque.address}<br>
                            <small>${typeof mosque.distance === 'number' ? mosque.distance.toFixed(1) + ' km away' : mosque.distance}</small>
                        `);

                    this.mosqueMarkers.push(marker);
                });
            }

            filterMosques() {
                // Implementation for filtering mosques
                this.displayMosques();
                this.addMosquesToMap();
            }

            sortAndDisplayMosques() {
                const sortBy = document.getElementById('sortSelect')?.value || 'distance';

                if (sortBy === 'distance') {
                    this.mosqueData.sort((a, b) => a.distance - b.distance);
                } else if (sortBy === 'name') {
                    this.mosqueData.sort((a, b) => a.name.localeCompare(b.name));
                }

                this.displayMosques();
            }

            calculateQibla() {
                if (!this.userLocation) return;

                // Mecca coordinates
                const meccaLat = 21.4225;
                const meccaLng = 39.8262;

                // Calculate bearing to Mecca
                const lat1 = this.userLocation.lat * Math.PI / 180;
                const lat2 = meccaLat * Math.PI / 180;
                const deltaLng = (meccaLng - this.userLocation.lng) * Math.PI / 180;

                const x = Math.sin(deltaLng) * Math.cos(lat2);
                const y = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(deltaLng);

                let bearing = Math.atan2(x, y) * 180 / Math.PI;
                bearing = (bearing + 360) % 360;

                this.qiblaDirection = bearing;

                // Update UI
                const arrow = document.getElementById('qibla-arrow');
                const degree = document.getElementById('qibla-degree');

                if (arrow) {
                    arrow.style.transform = `rotate(${bearing}deg)`;
                }
                if (degree) {
                    degree.textContent = `${bearing.toFixed(1)}°`;
                }
            }

            initDhikrCounter() {
                // Update display
                this.updateDhikrDisplay();

                // Add click event to button
                const dhikrButton = document.getElementById('dhikr-button');
                if (dhikrButton) {
                    dhikrButton.addEventListener('click', () => {
                        this.incrementDhikr();
                    });
                }
            }

            incrementDhikr() {
                this.dhikrCount++;
                localStorage.setItem('dhikrCount', this.dhikrCount);
                this.updateDhikrDisplay();

                // Add visual feedback
                const button = document.getElementById('dhikr-button');
                if (button) {
                    button.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        button.style.transform = 'scale(1)';
                    }, 100);
                }

                // Check if goal is reached
                if (this.dhikrCount >= this.dhikrGoal && this.dhikrCount - 1 < this.dhikrGoal) {
                    this.showDhikrCongratulations();
                }
            }

            updateDhikrDisplay() {
                document.getElementById('dhikr-count').textContent = this.dhikrCount;
                document.getElementById('dhikr-goal').textContent = this.dhikrGoal;

                const progress = Math.min((this.dhikrCount / this.dhikrGoal) * 100, 100);
                document.getElementById('dhikr-progress').style.width = progress + '%';
            }

            resetDhikr() {
                this.dhikrCount = 0;
                localStorage.setItem('dhikrCount', this.dhikrCount);
                this.updateDhikrDisplay();
            }

            setDhikrGoal() {
                const newGoal = prompt('Enter your dhikr goal:', this.dhikrGoal);
                if (newGoal && !isNaN(newGoal) && parseInt(newGoal) > 0) {
                    this.dhikrGoal = parseInt(newGoal);
                    localStorage.setItem('dhikrGoal', this.dhikrGoal);
                    this.updateDhikrDisplay();
                }
            }

            showDhikrCongratulations() {
                // Simple congratulations (you can enhance this)
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification('Dhikr Goal Reached!', {
                        body: `Congratulations! You've completed ${this.dhikrGoal} dhikr.`,
                        icon: '/favicon.ico'
                    });
                } else {
                    alert(`Congratulations! You've completed ${this.dhikrGoal} dhikr.`);
                }
            }

            requestNotificationPermission() {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }

            async loadIslamicDate() {
                try {
                    const response = await fetch('https://api.aladhan.com/v1/gToH');
                    const data = await response.json();

                    if (data.code === 200) {
                        const hijriDate = data.data.hijri;
                        const dateString = `${hijriDate.day} ${hijriDate.month.en} ${hijriDate.year}`;
                        document.getElementById('hijri-date').textContent = dateString;
                        document.getElementById('islamic-date')?.classList.remove('d-none');
                    }
                } catch (error) {
                    console.error('Error loading Islamic date:', error);
                    document.getElementById('hijri-date').textContent = 'Date not available';
                }
            }

            showMosqueError(message) {
                document.getElementById('mosque-loading')?.classList.add('d-none');
                document.getElementById('mosque-error')?.classList.remove('d-none');

                const errorElement = document.getElementById('mosque-error');
                if (errorElement) {
                    errorElement.innerHTML = `
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Error</h5>
                        <p class="mb-0">${message}</p>
                    `;
                }
            }

            showPrayerTimesError() {
                document.getElementById('prayer-loading')?.classList.add('d-none');
                document.getElementById('prayer-error')?.classList.remove('d-none');

                const errorElement = document.getElementById('prayer-error');
                if (errorElement) {
                    errorElement.innerHTML = `
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Error</h5>
                        <p class="mb-0">Unable to load prayer times. Please try again.</p>
                    `;
                }
            }
        }

        // Initialize the app when DOM is loaded
        let app;
        document.addEventListener('DOMContentLoaded', function () {
            app = new IslamicApp();
        });
    </script>
</body>

</html>
