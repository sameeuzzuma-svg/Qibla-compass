<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Prayer Times - Find Namaz Timings & Nearby Mosques</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts - Islamic Style -->
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* Islamic Prayer Times App - Custom Styles */
        :root {
            --islamic-green: #2d5a3d;
            --islamic-green-light: #4a8061;
            --islamic-gold: #d4af37;
            --islamic-gold-light: #f4d03f;
            --text-dark: #2c3e50;
            --text-light: #ecf0f1;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --gradient-green: linear-gradient(135deg, var(--islamic-green), var(--islamic-green-light));
            --gradient-gold: linear-gradient(135deg, var(--islamic-gold), var(--islamic-gold-light));
        }

        /* Base Styles */
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding-top: 120px;
        }

        .arabic-font {
            font-family: 'Amiri', serif;
            font-weight: 700;
        }

        /* Navigation */
        .bg-islamic-green {
            background: var(--gradient-green) !important;
            box-shadow: 0 2px 20px var(--shadow-medium);
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .navbar-nav .nav-link {
            font-weight: 500;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
            border-radius: 25px;
            padding: 0.5rem 1rem !important;
        }

        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            margin-top: 44px;
        }

        .section {
            display: none;
            padding: 3rem 0;
            min-height: 70vh;
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            margin-bottom: 3rem;
        }

        .section-header h2 {
            color: var(--islamic-green);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        /* Islamic Welcome */
        .islamic-welcome {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px var(--shadow-light);
            margin-bottom: 2rem;
        }

        .islamic-welcome h1 {
            color: var(--islamic-green);
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .islamic-welcome h2 {
            color: var(--islamic-green);
            font-weight: 700;
        }

        /* Location Card */
        .location-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .location-card:hover {
            transform: translateY(-5px);
        }

        .location-card .card-header {
            background: var(--gradient-green);
            color: white;
            font-weight: 600;
            padding: 1rem 1.5rem;
            border: none;
        }

        .location-card .card-body {
            padding: 1.5rem;
        }

        /* Prayer Time Cards */
        .prayer-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .prayer-card:hover {
            transform: translateY(-5px);
            border-color: var(--islamic-gold);
            box-shadow: 0 15px 35px var(--shadow-medium);
        }

        .prayer-card .prayer-icon {
            font-size: 2.5rem;
            color: var(--islamic-green);
            margin-bottom: 1rem;
        }

        .prayer-card .prayer-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .prayer-card .prayer-time {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--islamic-gold);
            font-family: 'Roboto', monospace;
        }

        .prayer-card.current-prayer {
            background: var(--gradient-green);
            color: white;
        }

        .prayer-card.current-prayer .prayer-icon,
        .prayer-card.current-prayer .prayer-name {
            color: white;
        }

        .prayer-card.current-prayer .prayer-time {
            color: var(--islamic-gold-light);
        }

        /* Next Prayer Countdown */
        .next-prayer-countdown {
            background: var(--gradient-gold);
            padding: 1.5rem;
            border-radius: 20px;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .countdown-time {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Roboto', monospace;
            margin: 1rem 0;
        }

        /* Qibla Compass */
        .qibla-compass {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .compass-circle {
            width: 200px;
            height: 200px;
            border: 3px solid var(--islamic-green);
            border-radius: 50%;
            margin: 1rem auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .qibla-arrow {
            font-size: 3rem;
            color: var(--islamic-gold);
            transition: transform 0.3s ease;
        }

        /* Dhikr Counter */
        .dhikr-counter {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow-light);
        }

        .dhikr-count {
            font-size: 4rem;
            font-weight: 700;
            color: var(--islamic-gold);
            margin: 1rem 0;
        }

        .dhikr-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: var(--gradient-green);
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem auto;
        }

        .dhikr-button:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px var(--shadow-medium);
        }

        /* Map Container */
        .map-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-light);
            height: 500px;
            position: relative;
        }

        #mosque-map {
            height: 100%;
            width: 100%;
        }

        /* Mosque List Items */
        .mosque-item {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .mosque-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }

        .mosque-name {
            font-weight: 600;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .mosque-address {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .mosque-distance {
            color: var(--islamic-gold);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .distance-badge {
            background: var(--islamic-gold);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: var(--gradient-green);
            color: white;
            border: none;
            font-weight: 600;
        }

        /* Alerts */
        .alert {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        /* Loading Spinners */
        .spinner-border {
            color: var(--islamic-green) !important;
        }

        /* Buttons */
        .btn-primary {
            background: var(--gradient-green);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--gradient-gold);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }

        .btn-gold {
            background: var(--gradient-gold);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-gold:hover {
            background: var(--gradient-green);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
            color: white;
        }

        /* Tool Cards */
        .tool-card {
            background: white;
            border-radius: 20px;
            padding: 2rem 1.5rem;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow-light);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .tool-card:hover {
            transform: translateY(-10px);
            border-color: var(--islamic-gold);
            box-shadow: 0 20px 40px var(--shadow-medium);
        }

        .tool-icon {
            font-size: 3rem;
            color: var(--islamic-green);
            margin-bottom: 1.5rem;
        }

        .tool-title {
            color: var(--islamic-green);
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .tool-description {
            color: #6c757d;
            margin-bottom: 2rem;
            flex-grow: 1;
        }

        .tool-button {
            color: var(--islamic-gold);
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .tool-card:hover .tool-button {
            transform: translateX(5px);
        }

        /* Islamic Calendar */
        .islamic-date {
            background: var(--gradient-green);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 1rem;
        }

        /* Filter Controls */
        .filter-controls {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px var(--shadow-light);
        }

        /* Footer */
        footer {
            background: var(--gradient-green) !important;
            margin-top: 3rem;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
            margin: 0 10px;
            font-size: 0.9rem;
        }

        .footer-links a:hover {
            color: white;
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 140px;
            }

            .main-content {
                margin-top: 20px;
            }

            .islamic-welcome {
                padding: 2rem;
            }

            .islamic-welcome h1 {
                font-size: 1.5rem;
            }

            .prayer-card {
                margin-bottom: 1rem;
            }

            .section {
                padding: 2rem 0;
            }

            .map-container {
                height: 400px;
            }

            .footer-links {
                text-align: center;
                margin-top: 1rem;
            }

            .footer-links a {
                display: inline-block;
                margin: 5px;
            }

            .countdown-time {
                font-size: 2rem;
            }

            .compass-circle {
                width: 150px;
                height: 150px;
            }

            .qibla-arrow {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .islamic-welcome h1 {
                font-size: 1.2rem;
            }

            .islamic-welcome h2 {
                font-size: 1.3rem;
            }

            .prayer-card .prayer-icon {
                font-size: 2rem;
            }

            .prayer-card .prayer-name {
                font-size: 1rem;
            }

            .prayer-card .prayer-time {
                font-size: 1.2rem;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-islamic-green fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#home">
                <i class="fas fa-mosque me-2"></i>
                Islamic Prayer Times
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#landing" data-section="landing">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#prayer-times" data-section="prayer-times">Prayer Times</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#mosque-finder" data-section="mosque-finder">Mosque Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#qibla" data-section="qibla">Qibla Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#dhikr" data-section="dhikr">Dhikr Counter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#about" data-section="about">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Main Content -->
    <main class="main-content">
        <!-- Landing Page Section -->
        <section id="landing" class="section active">
            <div class="container">
                <div class="row justify-content-center text-center mb-5">
                    <div class="col-lg-10">
                        <div class="islamic-welcome">
                            <h1 class="arabic-font mb-3">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيم</h1>
                            <h2 class="mb-4">Islamic Prayer Times & Mosque Finder</h2>
                            <p class="lead">Your complete Islamic companion for prayer times, mosque locations, Qibla
                                direction, and spiritual tools. Stay connected with your faith wherever you are.</p>
                        </div>
                    </div>
                </div>
                <!-- Next Prayer Countdown -->
                <div id="next-prayer-section" class="next-prayer-countdown d-none">
                    <h4><i class="fas fa-clock me-2"></i>Next Prayer</h4>
                    <div id="next-prayer-name">Maghrib</div>
                    <div class="countdown-time" id="countdown-timer">02:34:15</div>
                    <p class="mb-0">Time remaining</p>
                </div>
                <!-- Islamic Date -->
                <div class="islamic-date d-none" id="islamic-date">
                    <h6 class="mb-1">Today's Islamic Date</h6>
                    <div id="hijri-date">Loading...</div>
                </div>
                <!-- Tools Grid -->
                <div class="row g-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="prayer-times">
                            <div class="tool-icon">
                                <i class="fas fa-pray"></i>
                            </div>
                            <h4 class="tool-title">Prayer Times</h4>
                            <p class="tool-description">Get accurate Namaz timings with countdown and notifications</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="mosque-finder">
                            <div class="tool-icon">
                                <i class="fas fa-mosque"></i>
                            </div>
                            <h4 class="tool-title">Mosque Finder</h4>
                            <p class="tool-description">Find nearby mosques sorted by distance with directions</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="qibla">
                            <div class="tool-icon">
                                <i class="fas fa-compass"></i>
                            </div>
                            <h4 class="tool-title">Qibla Finder</h4>
                            <p class="tool-description">Find accurate direction to Mecca with compass</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="tool-card" data-section="dhikr">
                            <div class="tool-icon">
                                <i class="fas fa-hands"></i>
                            </div>
                            <h4 class="tool-title">Dhikr Counter</h4>
                            <p class="tool-description">Digital Tasbih counter for your daily dhikr</p>
                            <div class="tool-button">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Prayer Times Section -->
        <section id="prayer-times" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h2><i class="fas fa-pray me-3"></i>Prayer Times</h2>
                    <p class="lead">Accurate Namaz timings with advanced features</p>
                </div>
                <!-- Location Loading -->
                <div id="prayer-loading" class="text-center mb-4">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading prayer times...</span>
                    </div>
                    <p class="mt-2">Loading prayer times for your location...</p>
                </div>
                <!-- Location Error -->
                <div id="prayer-error" class="alert alert-warning text-center d-none" role="alert">
                    <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Unable to get your
                        location</h5>
                    <p class="mb-0">Please allow location access to view accurate prayer times for your area.</p>
                </div>
                <!-- Prayer Calculation Method -->
                <div id="calculation-method" class="card mb-4 d-none">
                    <div class="card-header">
                        <i class="fas fa-calculator me-2"></i>Calculation Method
                    </div>
                    <div class="card-body">
                        <select class="form-select" id="methodSelect">
                            <option value="2">Islamic Society of North America (ISNA)</option>
                            <option value="1">University of Islamic Sciences, Karachi</option>
                            <option value="3">Muslim World League</option>
                            <option value="4">Umm Al-Qura University, Makkah</option>
                            <option value="5">Egyptian General Authority of Survey</option>
                        </select>
                    </div>
                </div>
                <!-- Location Card -->
                <div id="prayer-location-card" class="location-card mb-4 d-none">
                    <div class="card-header">
                        <i class="fas fa-map-marker-alt me-2"></i>Current Location
                    </div>
                    <div class="card-body">
                        <p class="mb-0">
                            <strong id="prayer-city">Loading...</strong>,
                            <span id="prayer-country">Loading...</span>
                        </p>
                        <small class="text-muted">
                            Coordinates: <span id="prayer-coordinates">---, ---</span>
                        </small>
                    </div>
                </div>
                <!-- Time Format Toggle -->
                <div id="prayer-format-toggle" class="text-center mb-4 d-none">
                    <div class="form-check form-switch d-inline-block">
                        <input class="form-check-input" type="checkbox" id="timeFormatSwitch" checked>
                        <label class="form-check-label" for="timeFormatSwitch">
                            <span id="timeFormatLabel">24-hour format</span>
                        </label>
                    </div>
                </div>
                <!-- Prayer Times Grid -->
                <div id="prayer-times-grid" class="row g-4 d-none">
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="fajr-card">
                            <div class="prayer-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="prayer-name">Fajr</div>
                            <div class="prayer-time" id="fajr-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="dhuhr-card">
                            <div class="prayer-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="prayer-name">Dhuhr</div>
                            <div class="prayer-time" id="dhuhr-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="asr-card">
                            <div class="prayer-icon">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="prayer-name">Asr</div>
                            <div class="prayer-time" id="asr-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="maghrib-card">
                            <div class="prayer-icon">
                                <i class="fas fa-moon"></i>
                            </div>
                            <div class="prayer-name">Maghrib</div>
                            <div class="prayer-time" id="maghrib-time">--:--</div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6">
                        <div class="prayer-card" id="isha-card">
                            <div class="prayer-icon">
                                <i class="fas fa-moon"></i>
                            </div>
                            <div class="prayer-name">Isha</div>
                            <div class="prayer-time" id="isha-time">--:--</div>
                        </div>
                    </div>
                </div>
                <!-- Prayer Notifications -->
                <div id="prayer-notifications" class="card mt-4 d-none">
                    <div class="card-header">
                        <i class="fas fa-bell me-2"></i>Prayer Notifications
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="notificationSwitch">
                            <label class="form-check-label" for="notificationSwitch">
                                Enable prayer time notifications
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Mosque Finder Section -->
        <section id="mosque-finder" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h2><i class="fas fa-mosque me-3"></i>Find Nearby Mosques</h2>
                    <p class="lead">Discover mosques sorted by distance with advanced filtering</p>
                </div>
                <!-- Filter Controls -->
                <div class="filter-controls">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Search Radius</label>
                            <select class="form-select" id="radiusSelect">
                                <option value="1000">1 km</option>
                                <option value="2000">2 km</option>
                                <option value="5000" selected>5 km</option>
                                <option value="10000">10 km</option>
                                <option value="20000">20 km</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Sort By</label>
                            <select class="form-select" id="sortSelect">
                                <option value="distance">Distance (Nearest First)</option>
                                <option value="name">Name (A-Z)</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Show Only</label>
                            <select class="form-select" id="filterSelect">
                                <option value="all">All Mosques</option>
                                <option value="named">Named Mosques Only</option>
                                <option value="nearby">Within 2km</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Map Container -->
                <div class="map-container mb-4">
                    <div id="mosque-map" class="position-relative">
                        <div class="position-absolute top-50 start-50 translate-middle text-center"
                            style="z-index: 1000;">
                            <div class="spinner-border text-islamic-green" role="status">
                                <span class="visually-hidden">Loading map...</span>
                            </div>
                            <p class="mt-2">Loading map...</p>
                        </div>
                    </div>
                </div>
                <!-- Mosque Count -->
                <div id="mosque-count" class="text-center mb-3 d-none">
                    <span class="badge bg-primary fs-6">Found <span id="mosque-total">0</span> mosques nearby</span>
                </div>
                <!-- Mosque List -->
                <div id="mosque-list" class="row g-3">
                    <!-- Mosque items will be populated here -->
                </div>
            </div>
        </section>
        <!-- Qibla Finder Section -->
        <section id="qibla" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h2><i class="fas fa-compass me-3"></i>Qibla Finder</h2>
                    <p class="lead">Find the accurate direction to Mecca (Qibla) from your location</p>
                </div>
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="qibla-compass">
                            <h4 class="mb-4">Qibla Direction</h4>
                            <div class="compass-circle">
                                <div class="qibla-arrow" id="qibla-arrow">
                                    <i class="fas fa-location-arrow"></i>
                                </div>
                            </div>
                            <div id="qibla-info" class="mt-4">
                                <p id="qibla-degree" class="h5 text-islamic-gold">Calculating...</p>
                                <p id="qibla-distance" class="text-muted">Distance to Mecca: Calculating...</p>
                            </div>
                            <button class="btn btn-gold mt-3" onclick="islamicApp.calibrateCompass()">
                                <i class="fas fa-sync me-2"></i>Recalibrate
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Dhikr Counter Section -->
        <section id="dhikr" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h2><i class="fas fa-hands me-3"></i>Digital Tasbih</h2>
                    <p class="lead">Keep track of your dhikr with this digital counter</p>
                </div>
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="dhikr-counter">
                            <h4 class="mb-4">Dhikr Counter</h4>
                            <div class="dhikr-count" id="dhikr-count">0</div>
                            <button class="dhikr-button" id="dhikr-btn">
                                <i class="fas fa-plus"></i>
                            </button>
                            <div class="mt-3">
                                <button class="btn btn-primary me-2" onclick="islamicApp.resetDhikr()">
                                    <i class="fas fa-redo me-2"></i>Reset
                                </button>
                                <button class="btn btn-gold" onclick="islamicApp.setDhikrGoal()">
                                    <i class="fas fa-target me-2"></i>Set Goal
                                </button>
                            </div>
                            <div id="dhikr-goal" class="mt-3 d-none">
                                <p class="text-muted">Goal: <span id="goal-target">100</span></p>
                                <div class="progress">
                                    <div class="progress-bar" id="dhikr-progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- About Section -->
        <section id="about" class="section">
            <div class="container">
                <div class="section-header text-center">
                    <h2><i class="fas fa-info-circle me-3"></i>About This App</h2>
                    <p class="lead">Your comprehensive Islamic companion with advanced features</p>
                </div>
                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-heart me-2"></i>Enhanced Features & Mission
                            </div>
                            <div class="card-body">
                                <p>This advanced Islamic Prayer Times app provides comprehensive tools for Muslims
                                    worldwide, featuring accurate prayer times, intelligent mosque finder, Qibla
                                    direction, and spiritual counters.</p>

                                <h5 class="mt-4">Advanced Features:</h5>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Real-time prayer countdown
                                        with notifications</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Intelligent mosque finder
                                        sorted by distance</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Accurate Qibla direction
                                        with compass</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Digital Tasbih counter with
                                        goals</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Multiple prayer calculation
                                        methods</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Islamic calendar
                                        integration</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Advanced filtering and
                                        sorting options</li>
                                    <li><i class="fas fa-check-circle text-success me-2"></i>Responsive design for all
                                        devices</li>
                                </ul>
                                <h5 class="mt-4">Prayer Calculation Methods:</h5>
                                <p>Choose from 5 internationally recognized calculation methods including ISNA, Muslim
                                    World League, and Umm Al-Qura University standards for maximum accuracy in your
                                    region.</p>
                                <h5 class="mt-4">Data Sources:</h5>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-external-link-alt text-primary me-2"></i>Prayer times:
                                        Aladhan.com API</li>
                                    <li><i class="fas fa-external-link-alt text-primary me-2"></i>Location data:
                                        BigDataCloud API</li>
                                    <li><i class="fas fa-external-link-alt text-primary me-2"></i>Mosque locations:
                                        OpenStreetMap Overpass API</li>
                                    <li><i class="fas fa-external-link-alt text-primary me-2"></i>Qibla calculations:
                                        Astronomical formulas</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-bar me-2"></i>App Statistics
                            </div>
                            <div class="card-body text-center">
                                <div class="row">
                                    <div class="col-6 mb-3">
                                        <div class="h4 text-islamic-gold">5</div>
                                        <small class="text-muted">Daily Prayers</small>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <div class="h4 text-islamic-gold">5</div>
                                        <small class="text-muted">Calculation Methods</small>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <div class="h4 text-islamic-gold">360°</div>
                                        <small class="text-muted">Qibla Accuracy</small>
                                    </div>
                                    <div class="col-6 mb-3">
                                        <div class="h4 text-islamic-gold">∞</div>
                                        <small class="text-muted">Dhikr Count</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Islamic Quote -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <i class="fas fa-quote-right me-2"></i>Islamic Wisdom
                            </div>
                            <div class="card-body text-center">
                                <p class="arabic-font h6 text-islamic-green">"وَأَقِيمُوا الصَّلَاةَ وَآتُوا الزَّكَاةَ"
                                </p>
                                <small class="text-muted">"And establish prayer and give zakah" - Quran 2:110</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <!-- Footer -->
    <footer class="bg-islamic-green text-white py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 arabic-font">"وَاذْكُرُوا اللَّهَ كَثِيرًا لَعَلَّكُمْ تُفْلِحُونَ"</p>
                    <small class="text-light">"And remember Allah often that you may succeed." - Quran 62:10</small>
                </div>
                <div class="col-md-6 text-md-end footer-links">
                    <small>&copy; 2025 Enhanced Islamic Prayer Times App</small>
                </div>
            </div>
        </div>
    </footer>
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet JS for Maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Enhanced Islamic Prayer Times App - JavaScript
        class IslamicApp {
            constructor() {
                this.userLocation = null;
                this.map = null;
                this.mosqueMarkers = [];
                this.mosqueData = [];
                this.prayerTimes = null;
                this.is24HourFormat = true;
                this.calculationMethod = 2;
                this.dhikrCount = parseInt(localStorage.getItem('dhikrCount')) || 0;
                this.dhikrGoal = parseInt(localStorage.getItem('dhikrGoal')) || 100;
                this.qiblaDirection = 0;
                this.nextPrayerTimer = null;

                this.init();
            }
            init() {
                this.setupEventListeners();
                this.detectLocation();
                this.initDhikrCounter();
                this.requestNotificationPermission();
                this.loadIslamicDate();
            }

            // setupEventListeners() {
            //     // Navigation
            //     document.querySelectorAll('[data-section]').forEach(link => {
            //         link.addEventListener('click', (e) => {
            //             e.preventDefault();
            //             const sectionId = e.target.getAttribute('data-section') || e.target.closest('[data-section]').getAttribute('data-section');
            //             this.showSection(sectionId);

            //             if (e.target.classList.contains('nav-link')) {
            //                 this.updateActiveNav(e.target);
            //             } else {
            //                 const navLink = document.querySelector(`[data-section="${sectionId}"].nav-link`);
            //                 if (navLink) {
            //                     this.updateActiveNav(navLink);
            //                 }
            //             }
            //         });
            //     });
            //     // Time format toggle
            //     const timeFormatSwitch = document.getElementById('timeFormatSwitch');
            //     if (timeFormatSwitch) {
            //         const savedFormat = localStorage.getItem('timeFormat');
            //         this.is24HourFormat = savedFormat ? savedFormat === '24' : true;
            //         timeFormatSwitch.checked = this.is24HourFormat;
            //         this.updateTimeFormatLabel();
            //         timeFormatSwitch.addEventListener('change', (e) => {
            //             this.is24HourFormat = e.target.checked;
            //             localStorage.setItem('timeFormat', this.is24HourFormat ? '24' : '12');
            //             this.updateTimeFormatLabel();
            //             if (this.prayerTimes) {
            //                 this.displayPrayerTimes();
            //             }
            //         });
            //     }
            //     // Calculation method selector
            //     const methodSelect = document.getElementById('methodSelect');
            //     if (methodSelect) {
            //         methodSelect.value = this.calculationMethod;
            //         methodSelect.addEventListener('change', (e) => {
            //             this.calculationMethod = parseInt(e.target.value);
            //             if (this.userLocation) {
            //                 this.loadPrayerTimes();
            //             }
            //         });
            //     }
            //     // Filter controls for mosques
            //     document.getElementById('radiusSelect')?.addEventListener('change', () => this.filterMosques());
            //     document.getElementById('sortSelect')?.addEventListener('change', () => this.sortAndDisplayMosques());
            //     document.getElementById('filterSelect')?.addEventListener('change', () => this.filterMosques());
            //     // Notification toggle
            //     const notificationSwitch = document.getElementById('notificationSwitch');
            //     if (notificationSwitch) {
            //         notificationSwitch.checked = localStorage.getItem('notificationsEnabled') === 'true';
            //         notificationSwitch.addEventListener('change', (e) => {
            //             localStorage.setItem('notificationsEnabled', e.target.checked);
            //         });
            //     }
            //     // Handle initial hash
            //     if (window.location.hash) {
            //         const sectionId = window.location.hash.substring(1);
            //         this.showSection(sectionId);
            //     } else {
            //         this.showSection('landing');
            //     }
            // }

            // showSection(sectionId) {
            //     document.querySelectorAll('.section').forEach(section => {
            //         section.classList.remove('active');
            //     });
            //     const targetSection = document.getElementById(sectionId);
            //     if (targetSection) {
            //         targetSection.classList.add('active');

            //         if (sectionId === 'prayer-times' && this.userLocation && !this.prayerTimes) {
            //             this.loadPrayerTimes();
            //         } else if (sectionId === 'mosque-finder' && this.userLocation) {
            //             this.loadMosques();
            //         } else if (sectionId === 'qibla' && this.userLocation) {
            //             this.calculateQibla();
            //         }
            //     }
            //     window.location.hash = sectionId;
            // }
            // updateActiveNav(activeLink) {
            //     document.querySelectorAll('.nav-link').forEach(link => {
            //         link.classList.remove('active');
            //     });
            //     activeLink.classList.add('active');
            // }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('[data-section]').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const sectionId = e.target.getAttribute('data-section') ||
                            e.target.closest('[data-section]').getAttribute('data-section');
                        this.showSection(sectionId);

                        if (e.target.classList.contains('nav-link')) {
                            this.updateActiveNav(e.target);
                        } else {
                            const navLink = document.querySelector(`[data-section="${sectionId}"].nav-link`);
                            if (navLink) {
                                this.updateActiveNav(navLink);
                            }
                        }
                    });
                });

                // Time format toggle
                const timeFormatSwitch = document.getElementById('timeFormatSwitch');
                if (timeFormatSwitch) {
                    const savedFormat = localStorage.getItem('timeFormat');
                    this.is24HourFormat = savedFormat ? savedFormat === '24' : true;
                    timeFormatSwitch.checked = this.is24HourFormat;
                    this.updateTimeFormatLabel();
                    timeFormatSwitch.addEventListener('change', (e) => {
                        this.is24HourFormat = e.target.checked;
                        localStorage.setItem('timeFormat', this.is24HourFormat ? '24' : '12');
                        this.updateTimeFormatLabel();
                        if (this.prayerTimes) {
                            this.displayPrayerTimes();
                        }
                    });
                }

                // Calculation method selector
                const methodSelect = document.getElementById('methodSelect');
                if (methodSelect) {
                    methodSelect.value = this.calculationMethod;
                    methodSelect.addEventListener('change', (e) => {
                        this.calculationMethod = parseInt(e.target.value);
                        if (this.userLocation) {
                            this.loadPrayerTimes();
                        }
                    });
                }

                // Filter controls for mosques
                document.getElementById('radiusSelect')?.addEventListener('change', () => this.filterMosques());
                document.getElementById('sortSelect')?.addEventListener('change', () => this.sortAndDisplayMosques());
                document.getElementById('filterSelect')?.addEventListener('change', () => this.filterMosques());

                // Notification toggle
                const notificationSwitch = document.getElementById('notificationSwitch');
                if (notificationSwitch) {
                    notificationSwitch.checked = localStorage.getItem('notificationsEnabled') === 'true';
                    notificationSwitch.addEventListener('change', (e) => {
                        localStorage.setItem('notificationsEnabled', e.target.checked);
                    });
                }

                // Handle hash changes (when user navigates using browser back/forward)
                window.addEventListener('hashchange', () => {
                    const sectionId = window.location.hash.substring(1);
                    if (sectionId) {
                        this.showSection(sectionId);
                    }
                });

                // Handle initial page load - check hash first, then load appropriate section
                if (window.location.hash) {
                    const sectionId = window.location.hash.substring(1);
                    // Wait a bit for the DOM to be fully ready before showing the section
                    setTimeout(() => {
                        this.showSection(sectionId);
                    }, 100);
                } else {
                    this.showSection('landing');
                }
            }

            // Update your showSection method to handle the navigation highlighting properly:
            showSection(sectionId) {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });

                // Show the target section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');

                    // Update the URL hash without triggering the hashchange event
                    const currentHash = window.location.hash.substring(1);
                    if (currentHash !== sectionId) {
                        window.location.hash = sectionId;
                    }

                    // Update navigation highlighting
                    const navLink = document.querySelector(`[data-section="${sectionId}"].nav-link`);
                    if (navLink) {
                        this.updateActiveNav(navLink);
                    }

                    // Load section-specific content if needed
                    if (sectionId === 'prayer-times' && this.userLocation && !this.prayerTimes) {
                        this.loadPrayerTimes();
                    } else if (sectionId === 'mosque-finder' && this.userLocation) {
                        // Initialize map if not already done
                        if (!this.map) {
                            this.initializeMap();
                        }
                        this.loadMosques();
                    } else if (sectionId === 'qibla' && this.userLocation) {
                        this.calculateQibla();
                    }
                }
            }

            // Update your updateActiveNav method:
            updateActiveNav(activeLink) {
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                activeLink.classList.add('active');
            }

            updateTimeFormatLabel() {
                const label = document.getElementById('timeFormatLabel');
                if (label) {
                    label.textContent = this.is24HourFormat ? '24-hour format' : '12-hour format';
                }
            }

            async detectLocation() {
                if (!navigator.geolocation) {
                    this.showLocationError('Geolocation is not supported by this browser.');
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        this.userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        this.getReverseGeocoding().then(() => {
                            // After getting location, check if we need to load section-specific content
                            const currentSection = window.location.hash.substring(1);
                            if (currentSection === 'prayer-times') {
                                this.loadPrayerTimes();
                            } else if (currentSection === 'mosque-finder') {
                                this.loadMosques();
                            } else if (currentSection === 'qibla') {
                                this.calculateQibla();
                            }
                        });
                    },
                    (error) => {
                        let errorMessage = 'Unable to get your location.';

                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = 'Location access denied. Please enable location services.';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = 'Location information is unavailable.';
                                break;
                            case error.TIMEOUT:
                                errorMessage = 'Location request timed out.';
                                break;
                        }

                        this.showLocationError(errorMessage);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            }

            // detectLocation() {
            //     if (!navigator.geolocation) {
            //         this.showLocationError('Geolocation is not supported by this browser.');
            //         return;
            //     }
            //     navigator.geolocation.getCurrentPosition(
            //         (position) => {
            //             this.userLocation = {
            //                 lat: position.coords.latitude,
            //                 lng: position.coords.longitude
            //             };
            //             this.getReverseGeocoding();
            //         },
            //         (error) => {
            //             let errorMessage = 'Unable to get your location.';

            //             switch (error.code) {
            //                 case error.PERMISSION_DENIED:
            //                     errorMessage = 'Location access denied. Please enable location services.';
            //                     break;
            //                 case error.POSITION_UNAVAILABLE:
            //                     errorMessage = 'Location information is unavailable.';
            //                     break;
            //                 case error.TIMEOUT:
            //                     errorMessage = 'Location request timed out.';
            //                     break;
            //             }

            //             this.showLocationError(errorMessage);
            //         },
            //         {
            //             enableHighAccuracy: true,
            //             timeout: 10000,
            //             maximumAge: 60000
            //         }
            //     );
            // }

            async getReverseGeocoding() {
                try {
                    const response = await fetch(
                        `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${this.userLocation.lat}&longitude=${this.userLocation.lng}&localityLanguage=en`
                    );
                    const data = await response.json();

                    this.userLocation.city = data.city || data.locality || 'Unknown';
                    this.userLocation.country = data.countryName || 'Unknown';

                    this.displayLocationInfo();
                    this.calculateQibla();
                } catch (error) {
                    console.error('Error getting location details:', error);
                    this.userLocation.city = 'Unknown';
                    this.userLocation.country = 'Unknown';
                    this.displayLocationInfo();
                }
            }
            displayLocationInfo() {
                // Update location info elements
                this.updateElementText('prayer-city', this.userLocation.city);
                this.updateElementText('prayer-country', this.userLocation.country);
                this.updateElementText('prayer-coordinates',
                    `${this.userLocation.lat.toFixed(4)}, ${this.userLocation.lng.toFixed(4)}`);
            }
            updateElementText(elementId, text) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = text;
                }
            }
            showLocationError(message) {
                document.getElementById('prayer-loading')?.classList.add('d-none');
                document.getElementById('prayer-error')?.classList.remove('d-none');

                const errorElement = document.getElementById('prayer-error');
                if (errorElement) {
                    errorElement.innerHTML = `
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Location Error</h5>
                        <p class="mb-0">${message}</p>
                    `;
                }
            }
            async loadPrayerTimes() {
                if (!this.userLocation) return;
                try {
                    const response = await fetch(
                        `https://api.aladhan.com/v1/timings/date-string?latitude=${this.userLocation.lat}&longitude=${this.userLocation.lng}&method=${this.calculationMethod}`
                    );
                    const data = await response.json();

                    if (data.code === 200) {
                        this.prayerTimes = data.data.timings;
                        this.displayPrayerTimes();
                        this.startNextPrayerCountdown();
                    } else {
                        throw new Error('Failed to load prayer times');
                    }
                } catch (error) {
                    console.error('Error loading prayer times:', error);
                    this.showPrayerTimesError();
                }
            }
            displayPrayerTimes() {
                if (!this.prayerTimes) return;
                // Hide loading, show content
                document.getElementById('prayer-loading')?.classList.add('d-none');
                document.getElementById('prayer-location-card')?.classList.remove('d-none');
                document.getElementById('prayer-format-toggle')?.classList.remove('d-none');
                document.getElementById('prayer-times-grid')?.classList.remove('d-none');
                document.getElementById('calculation-method')?.classList.remove('d-none');
                document.getElementById('prayer-notifications')?.classList.remove('d-none');
                // Update prayer times
                const prayers = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
                prayers.forEach(prayer => {
                    const timeElement = document.getElementById(`${prayer}-time`);
                    if (timeElement && this.prayerTimes[prayer.charAt(0).toUpperCase() + prayer.slice(1)]) {
                        const time = this.prayerTimes[prayer.charAt(0).toUpperCase() + prayer.slice(1)];
                        timeElement.textContent = this.formatTime(time);
                    }
                });
                this.highlightCurrentPrayer();
            }
            formatTime(timeString) {
                const [hours, minutes] = timeString.split(':');
                const date = new Date();
                date.setHours(parseInt(hours), parseInt(minutes));
                if (this.is24HourFormat) {
                    return timeString;
                } else {
                    return date.toLocaleTimeString('en-US', {
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    });
                }
            }
            highlightCurrentPrayer() {
                if (!this.prayerTimes) return;
                const now = new Date();
                const currentTime = now.getHours() * 60 + now.getMinutes();

                const prayers = [
                    { name: 'fajr', time: this.prayerTimes.Fajr },
                    { name: 'dhuhr', time: this.prayerTimes.Dhuhr },
                    { name: 'asr', time: this.prayerTimes.Asr },
                    { name: 'maghrib', time: this.prayerTimes.Maghrib },
                    { name: 'isha', time: this.prayerTimes.Isha }
                ];
                prayers.forEach(prayer => {
                    const [hours, minutes] = prayer.time.split(':');
                    const prayerTime = parseInt(hours) * 60 + parseInt(minutes);
                    const card = document.getElementById(`${prayer.name}-card`);

                    if (card) {
                        card.classList.remove('current-prayer');
                    }
                });
                // Find next prayer
                let nextPrayer = null;
                for (let i = 0; i < prayers.length; i++) {
                    const [hours, minutes] = prayers[i].time.split(':');
                    const prayerTime = parseInt(hours) * 60 + parseInt(minutes);

                    if (prayerTime > currentTime) {
                        nextPrayer = prayers[i];
                        break;
                    }
                }
                if (!nextPrayer) {
                    nextPrayer = prayers[0]; // Next day's Fajr
                }
                const nextCard = document.getElementById(`${nextPrayer.name}-card`);
                if (nextCard) {
                    nextCard.classList.add('current-prayer');
                }
            }
            startNextPrayerCountdown() {
                if (this.nextPrayerTimer) {
                    clearInterval(this.nextPrayerTimer);
                }
                this.nextPrayerTimer = setInterval(() => {
                    this.updateNextPrayerCountdown();
                }, 1000);
                this.updateNextPrayerCountdown();
            }
            updateNextPrayerCountdown() {
                if (!this.prayerTimes) return;
                const now = new Date();
                const prayers = [
                    { name: 'Fajr', time: this.prayerTimes.Fajr },
                    { name: 'Dhuhr', time: this.prayerTimes.Dhuhr },
                    { name: 'Asr', time: this.prayerTimes.Asr },
                    { name: 'Maghrib', time: this.prayerTimes.Maghrib },
                    { name: 'Isha', time: this.prayerTimes.Isha }
                ];
                let nextPrayer = null;
                let nextPrayerTime = null;
                for (let prayer of prayers) {
                    const [hours, minutes] = prayer.time.split(':');
                    const prayerDateTime = new Date(now);
                    prayerDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                    if (prayerDateTime > now) {
                        nextPrayer = prayer.name;
                        nextPrayerTime = prayerDateTime;
                        break;
                    }
                }
                if (!nextPrayer) {
                    // Next day's Fajr
                    nextPrayer = 'Fajr';
                    const [hours, minutes] = this.prayerTimes.Fajr.split(':');
                    nextPrayerTime = new Date(now);
                    nextPrayerTime.setDate(now.getDate() + 1);
                    nextPrayerTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                }
                const timeDiff = nextPrayerTime - now;
                if (timeDiff > 0) {
                    const hours = Math.floor(timeDiff / (1000 * 60 * 60));
                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                    const countdownElement = document.getElementById('countdown-timer');
                    const nextPrayerNameElement = document.getElementById('next-prayer-name');
                    const nextPrayerSection = document.getElementById('next-prayer-section');
                    if (countdownElement && nextPrayerNameElement && nextPrayerSection) {
                        countdownElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        nextPrayerNameElement.textContent = nextPrayer;
                        nextPrayerSection.classList.remove('d-none');
                    }
                    // Check for prayer time notification
                    if (timeDiff <= 60000 && localStorage.getItem('notificationsEnabled') === 'true') { // 1 minute before
                        this.showPrayerNotification(nextPrayer);
                    }
                }
            }
            async loadMosques() {
                if (!this.userLocation) return;
                this.initializeMap();

                const radius = document.getElementById('radiusSelect')?.value || 5000;

                try {
                    const overpassQuery = `
                        [out:json][timeout:25];
                        (
                          node["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${this.userLocation.lat},${this.userLocation.lng});
                          way["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${this.userLocation.lat},${this.userLocation.lng});
                          relation["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${this.userLocation.lat},${this.userLocation.lng});
                        );
                        out center;
                    `;
                    const response = await fetch('https://overpass-api.de/api/interpreter', {
                        method: 'POST',
                        body: overpassQuery,
                        headers: {
                            'Content-Type': 'text/plain',
                        }
                    });
                    const data = await response.json();
                    this.processMosqueData(data.elements);
                } catch (error) {
                    console.error('Error loading mosques:', error);
                    this.showMosqueError();
                }
            }
            processMosqueData(mosques) {
                this.mosqueData = [];

                mosques.forEach((mosque) => {
                    const lat = mosque.lat || (mosque.center ? mosque.center.lat : null);
                    const lng = mosque.lon || (mosque.center ? mosque.center.lon : null);

                    if (!lat || !lng) return;
                    const name = mosque.tags?.name || 'Unnamed Mosque';
                    const address = this.formatAddress(mosque.tags);
                    const distance = this.calculateDistance(this.userLocation.lat, this.userLocation.lng, lat, lng);
                    this.mosqueData.push({
                        id: mosque.id,
                        name,
                        address,
                        lat,
                        lng,
                        distance,
                        tags: mosque.tags || {}
                    });
                });
                this.sortAndDisplayMosques();
            }
            formatAddress(tags) {
                if (!tags) return 'Address not available';

                const addressParts = [];
                if (tags['addr:street']) addressParts.push(tags['addr:street']);
                if (tags['addr:city']) addressParts.push(tags['addr:city']);
                if (tags.address) addressParts.push(tags.address);

                return addressParts.length > 0 ? addressParts.join(', ') : 'Address not available';
            }
            sortAndDisplayMosques() {
                if (!this.mosqueData.length) return;
                const sortBy = document.getElementById('sortSelect')?.value || 'distance';

                // Sort mosques
                if (sortBy === 'distance') {
                    this.mosqueData.sort((a, b) => a.distance - b.distance);
                } else if (sortBy === 'name') {
                    this.mosqueData.sort((a, b) => a.name.localeCompare(b.name));
                }
                this.filterMosques();
            }
            filterMosques() {
                const filterBy = document.getElementById('filterSelect')?.value || 'all';
                let filteredMosques = [...this.mosqueData];
                if (filterBy === 'named') {
                    filteredMosques = filteredMosques.filter(mosque => !mosque.name.includes('Unnamed'));
                } else if (filterBy === 'nearby') {
                    filteredMosques = filteredMosques.filter(mosque => mosque.distance <= 2);
                }
                this.displayMosques(filteredMosques);
            }
            displayMosques(mosques) {
                const mosqueList = document.getElementById('mosque-list');
                const mosqueCount = document.getElementById('mosque-count');
                const mosqueTotal = document.getElementById('mosque-total');
                if (!mosqueList) return;
                // Clear previous results
                mosqueList.innerHTML = '';
                this.clearMapMarkers();
                if (mosqueCount && mosqueTotal) {
                    mosqueTotal.textContent = mosques.length;
                    mosqueCount.classList.remove('d-none');
                }
                if (mosques.length === 0) {
                    mosqueList.innerHTML = '<div class="col-12 text-center"><p>No mosques found matching your criteria.</p></div>';
                    return;
                }
                mosques.forEach((mosque, index) => {
                    // Add marker to map
                    this.addMosqueMarker(mosque, index);
                    // Add to list
                    const mosqueElement = document.createElement('div');
                    mosqueElement.className = 'col-12';
                    mosqueElement.innerHTML = `
                        <div class="mosque-item" onclick="islamicApp.focusOnMosque(${index})">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <div class="mosque-name">${mosque.name}</div>
                                    <div class="mosque-address">${mosque.address}</div>
                                    <div class="mosque-distance mt-2">
                                        <span class="distance-badge">${mosque.distance.toFixed(1)} km away</span>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <a href="https://www.google.com/maps/dir/?api=1&destination=${mosque.lat},${mosque.lng}" 
                                       target="_blank" class="btn btn-sm btn-primary">
                                        <i class="fas fa-directions me-1"></i>Directions
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                    mosqueList.appendChild(mosqueElement);
                });
            }
            addMosqueMarker(mosque, index) {
                if (!this.map) return;
                const marker = L.marker([mosque.lat, mosque.lng], {
                    icon: L.divIcon({
                        html: `<i class="fas fa-mosque" style="color: #2d5a3d; font-size: 20px;"></i>`,
                        iconSize: [25, 25],
                        className: 'custom-div-icon'
                    })
                }).addTo(this.map);
                marker.bindPopup(`
                    <div class="mosque-popup-title">${mosque.name}</div>
                    <div class="mosque-popup-address">${mosque.address}</div>
                    <div class="mosque-popup-distance">${mosque.distance.toFixed(1)} km away</div>
                    <div class="mt-2">
                        <a href="https://www.google.com/maps/dir/?api=1&destination=${mosque.lat},${mosque.lng}" 
                           target="_blank" class="btn btn-sm btn-primary">
                            <i class="fas fa-directions me-1"></i>Get Directions
                        </a>
                    </div>
                `);
                this.mosqueMarkers.push(marker);
            }
            clearMapMarkers() {
                this.mosqueMarkers.forEach(marker => {
                    if (this.map) {
                        this.map.removeLayer(marker);
                    }
                });
                this.mosqueMarkers = [];
            }
            initializeMap() {
                const mapContainer = document.getElementById('mosque-map');
                if (!mapContainer || this.map || !this.userLocation) return;
                // Clear loading indicator
                mapContainer.innerHTML = '';
                this.map = L.map('mosque-map').setView([this.userLocation.lat, this.userLocation.lng], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(this.map);
                // Add user location marker
                L.marker([this.userLocation.lat, this.userLocation.lng], {
                    icon: L.divIcon({
                        html: '<i class="fas fa-user-circle" style="color: #d4af37; font-size: 24px;"></i>',
                        iconSize: [30, 30],
                        className: 'custom-div-icon'
                    })
                }).addTo(this.map).bindPopup('Your Location');
            }
            focusOnMosque(index) {
                if (this.mosqueMarkers[index] && this.map) {
                    this.map.setView(this.mosqueMarkers[index].getLatLng(), 16);
                    this.mosqueMarkers[index].openPopup();
                }
            }
            calculateDistance(lat1, lng1, lat2, lng2) {
                const R = 6371; // Earth's radius in km
                const dLat = this.deg2rad(lat2 - lat1);
                const dLng = this.deg2rad(lng2 - lng1);
                const a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(this.deg2rad(lat1)) * Math.cos(this.deg2rad(lat2)) *
                    Math.sin(dLng / 2) * Math.sin(dLng / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            }
            deg2rad(deg) {
                return deg * (Math.PI / 180);
            }
            calculateQibla() {
                if (!this.userLocation) return;
                // Kaaba coordinates
                const meccaLat = 21.4225;
                const meccaLng = 39.8262;
                // Calculate bearing to Mecca
                const lat1 = this.deg2rad(this.userLocation.lat);
                const lat2 = this.deg2rad(meccaLat);
                const dLng = this.deg2rad(meccaLng - this.userLocation.lng);
                const y = Math.sin(dLng) * Math.cos(lat2);
                const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLng);
                let bearing = Math.atan2(y, x);
                bearing = (bearing * 180 / Math.PI + 360) % 360; // Convert to degrees and normalize
                this.qiblaDirection = bearing;
                this.displayQiblaDirection();
            }
            displayQiblaDirection() {
                const arrowElement = document.getElementById('qibla-arrow');
                const degreeElement = document.getElementById('qibla-degree');
                const distanceElement = document.getElementById('qibla-distance');
                if (arrowElement) {
                    arrowElement.style.transform = `rotate(${this.qiblaDirection}deg)`;
                }
                if (degreeElement) {
                    degreeElement.textContent = `${Math.round(this.qiblaDirection)}° from North`;
                }
                if (distanceElement && this.userLocation) {
                    const distance = this.calculateDistance(this.userLocation.lat, this.userLocation.lng, 21.4225, 39.8262);
                    distanceElement.textContent = `Distance to Mecca: ${distance.toFixed(0)} km`;
                }
            }
            calibrateCompass() {
                if (this.userLocation) {
                    this.calculateQibla();
                    // Add visual feedback
                    const arrowElement = document.getElementById('qibla-arrow');
                    if (arrowElement) {
                        arrowElement.style.animation = 'pulse 0.5s';
                        setTimeout(() => {
                            arrowElement.style.animation = '';
                        }, 500);
                    }
                }
            }
            initDhikrCounter() {
                const dhikrBtn = document.getElementById('dhikr-btn');
                const dhikrCountElement = document.getElementById('dhikr-count');
                if (dhikrCountElement) {
                    dhikrCountElement.textContent = this.dhikrCount;
                }
                if (dhikrBtn) {
                    dhikrBtn.addEventListener('click', () => {
                        this.incrementDhikr();
                    });
                }
                this.updateDhikrProgress();
            }
            incrementDhikr() {
                this.dhikrCount++;
                localStorage.setItem('dhikrCount', this.dhikrCount);

                const dhikrCountElement = document.getElementById('dhikr-count');
                if (dhikrCountElement) {
                    dhikrCountElement.textContent = this.dhikrCount;
                    dhikrCountElement.style.animation = 'pulse 0.3s';
                    setTimeout(() => {
                        dhikrCountElement.style.animation = '';
                    }, 300);
                }
                this.updateDhikrProgress();
                // Check if goal reached
                if (this.dhikrCount === this.dhikrGoal) {
                    this.showDhikrGoalReached();
                }
            }
            resetDhikr() {
                this.dhikrCount = 0;
                localStorage.setItem('dhikrCount', this.dhikrCount);

                const dhikrCountElement = document.getElementById('dhikr-count');
                if (dhikrCountElement) {
                    dhikrCountElement.textContent = this.dhikrCount;
                }
                this.updateDhikrProgress();
            }
            setDhikrGoal() {
                const goal = prompt('Set your dhikr goal:', this.dhikrGoal);
                if (goal && !isNaN(goal) && parseInt(goal) > 0) {
                    this.dhikrGoal = parseInt(goal);
                    localStorage.setItem('dhikrGoal', this.dhikrGoal);

                    const goalElement = document.getElementById('goal-target');
                    const goalSection = document.getElementById('dhikr-goal');

                    if (goalElement) {
                        goalElement.textContent = this.dhikrGoal;
                    }

                    if (goalSection) {
                        goalSection.classList.remove('d-none');
                    }
                    this.updateDhikrProgress();
                }
            }
            updateDhikrProgress() {
                const progressBar = document.getElementById('dhikr-progress');
                const goalElement = document.getElementById('goal-target');

                if (progressBar && goalElement) {
                    const progress = Math.min((this.dhikrCount / this.dhikrGoal) * 100, 100);
                    progressBar.style.width = `${progress}%`;
                    goalElement.textContent = this.dhikrGoal;

                    if (this.dhikrGoal > 0) {
                        document.getElementById('dhikr-goal')?.classList.remove('d-none');
                    }
                }
            }
            showDhikrGoalReached() {
                alert(`Congratulations! You've reached your dhikr goal of ${this.dhikrGoal}!`);
            }
            requestNotificationPermission() {
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }
            showPrayerNotification(prayerName) {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification(`${prayerName} Prayer Time`, {
                        body: `It's time for ${prayerName} prayer.`,
                        icon: 'https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@6.4.0/svgs/solid/mosque.svg'
                    });
                }
            }
            async loadIslamicDate() {
                try {
                    const response = await fetch(
                        `https://api.aladhan.com/v1/gToH/${new Date().getDate()}-${new Date().getMonth() + 1}-${new Date().getFullYear()}`
                    );
                    const data = await response.json();

                    if (data.code === 200) {
                        const hijriDate = data.data.hijri;
                        const islamicDateElement = document.getElementById('hijri-date');
                        const islamicDateSection = document.getElementById('islamic-date');

                        if (islamicDateElement && islamicDateSection) {
                            islamicDateElement.textContent = `${hijriDate.day} ${hijriDate.month.en} ${hijriDate.year} AH`;
                            islamicDateSection.classList.remove('d-none');
                        }
                    }
                } catch (error) {
                    console.error('Error loading Islamic date:', error);
                }
            }
            showPrayerTimesError() {
                document.getElementById('prayer-loading')?.classList.add('d-none');
                document.getElementById('prayer-error')?.classList.remove('d-none');
            }
            showMosqueError() {
                const mosqueList = document.getElementById('mosque-list');
                if (mosqueList) {
                    mosqueList.innerHTML = '<div class="col-12 text-center text-danger"><p>Error loading mosques. Please try again.</p></div>';
                }
            }
        }
        // Initialize the enhanced app
        const islamicApp = new IslamicApp();
    </script>
</body>

</html>
