<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Enhanced SEO Meta Tags -->
    <title>Islamic Prayer Times Today | Accurate Salah Schedule & Qibla Direction - SunnahWise</title>
    <meta name="description"
        content="Get precise Islamic prayer times (Fajr, Dhuhr, Asr, Maghrib, Isha) for your location. Features prayer countdown, Islamic calendar, Qibla direction, and notification reminders. Trusted by Muslims worldwide.">
    <meta name="keywords"
        content="prayer times, salah times, daily prayer, today's prayer times, Islamic prayer schedule, namaz times, Muslim prayer, Fajr time, Dhuhr time, Asr time, Maghrib time, Isha time, prayer countdown, Islamic calendar, Hijri date, prayer tracker, prayer analytics, prayer notifications, Qibla direction, mosque finder">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2d5a3d">

    <!-- Enhanced Open Graph tags -->
    <meta property="og:title" content="Islamic Prayer Times Today | Accurate Salah Schedule - SunnahWise">
    <meta property="og:description"
        content="Get precise Islamic prayer times for your location with countdown timers, Islamic calendar, and prayer tracking. Never miss your daily prayers.">
    <meta property="og:image" content="https://sunnahwise.com/images/prayer-times-og.jpg">
    <meta property="og:url" content="https://sunnahwise.com/prayer-times">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="SunnahWise">

    <!-- Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Islamic Prayer Times Today | SunnahWise">
    <meta name="twitter:description"
        content="Accurate Islamic prayer times with countdown timers and Islamic calendar integration.">
    <meta name="twitter:image" content="https://sunnahwise.com/images/prayer-times-twitter.jpg">

    <!-- Additional SEO tags -->
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="author" content="SunnahWise">
    <link rel="canonical" href="https://sunnahwise.com/prayer-times" />

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "SunnahWise Prayer Times",
        "description": "Accurate Islamic prayer times calculator with countdown timers and Islamic calendar",
        "url": "https://sunnahwise.com/prayer-times",
        "applicationCategory": "ReligiousApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "Accurate prayer times calculation",
            "Prayer countdown timers",
            "Islamic calendar integration",
            "Next prayer countdown",
            "Multiple calculation methods",
            "Prayer notifications",
            "Qibla direction finder"
        ]
    }
    </script>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts - Islamic Style -->
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TN0HH3WV8R"></script>
    <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-TN0HH3WV8R'); </script>

    <style>
        /* Islamic Prayer Times App - Enhanced Custom Styles */
        :root {
            --islamic-green: #2d5a3d;
            --islamic-green-light: #4a8061;
            --islamic-gold: #d4af37;
            --islamic-gold-light: #f4d03f;
            --text-dark: #2c3e50;
            --text-light: #ecf0f1;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --gradient-green: linear-gradient(135deg, var(--islamic-green), var(--islamic-green-light));
            --gradient-gold: linear-gradient(135deg, var(--islamic-gold), var(--islamic-gold-light));
            --countdown-bg: #f8f9fa;
            --progress-bg: #e9ecef;
        }

        /* Base Styles */
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding-top: 76px;
        }

        .arabic-font {
            font-family: 'Amiri', serif;
            font-weight: 700;
        }

        /* Navigation */
        .bg-islamic-green {
            background: var(--gradient-green) !important;
            box-shadow: 0 2px 20px var(--shadow-medium);
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .navbar-nav .nav-link {
            font-weight: 500;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
            border-radius: 25px;
            padding: 0.5rem 1rem !important;
        }

        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Section Header */
        .section-header {
            margin-bottom: 3rem;
        }

        .section-header h1 {
            color: var(--islamic-green);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        /* Enhanced Location Card */
        .location-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .location-card:hover {
            transform: translateY(-5px);
        }

        .location-card .card-header {
            background: var(--gradient-green);
            color: white;
            font-weight: 600;
            padding: 1rem 1.5rem;
            border: none;
        }

        .location-card .card-body {
            padding: 1.5rem;
        }

        /* Enhanced Prayer Time Cards with Countdown */
        .prayer-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .prayer-card:hover {
            transform: translateY(-5px);
            border-color: var(--islamic-gold);
            box-shadow: 0 15px 35px var(--shadow-medium);
        }

        .prayer-card .prayer-icon {
            font-size: 2.5rem;
            color: var(--islamic-green);
            margin-bottom: 1rem;
        }

        .prayer-card .prayer-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .prayer-card .prayer-arabic {
            font-size: 0.9rem;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
            font-family: 'Amiri', serif;
        }

        .prayer-card .prayer-time {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--islamic-gold);
            font-family: 'Roboto', monospace;
            margin-bottom: 0.5rem;
        }

        .prayer-card .countdown-timer {
            font-size: 0.9rem;
            color: var(--islamic-green);
            margin-top: 0.5rem;
        }

        .prayer-card.current-prayer {
            background: var(--gradient-green);
            color: white;
            animation: pulse 2s infinite;
        }

        .prayer-card.current-prayer .prayer-icon,
        .prayer-card.current-prayer .prayer-name,
        .prayer-card.current-prayer .prayer-arabic,
        .prayer-card.current-prayer .countdown-timer {
            color: white;
        }

        .prayer-card.current-prayer .prayer-time {
            color: var(--islamic-gold-light);
        }

        .prayer-card.next-prayer {
            border-color: var(--islamic-gold);
            background: linear-gradient(135deg, #fff 0%, #fef7e0 100%);
        }

        /* Custom Notification Styles */
        .custom-notification {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 9999;
            max-width: 300px;
            animation: slideIn 0.5s ease;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Islamic Calendar Widget */
        .islamic-calendar {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Islamic Calendar */
        .islamic-date {
            background: var(--gradient-green);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 1rem;
        }

        .hijri-date {
            text-align: center;
            padding: 1rem;
            background: var(--gradient-green);
            color: white;
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        /* Next Prayer Countdown Banner */
        .next-prayer-banner {
            background: linear-gradient(135deg, var(--islamic-green), var(--islamic-green-light));
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px var(--shadow-light);
            text-align: center;
        }

        .next-prayer-banner h3 {
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .next-prayer-countdown {
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Roboto', monospace;
            margin: 1rem 0;
        }

        .next-prayer-info {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Monthly Prayer Calendar */
        .monthly-calendar {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 1rem;
        }

        .calendar-day {
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calendar-day:hover {
            background: var(--islamic-green-light);
            color: white;
        }

        .calendar-day.current {
            background: var(--islamic-green);
            color: white;
        }

        .calendar-day-header {
            font-weight: 600;
            background: #f8f9fa;
            padding: 10px;
            text-align: center;
        }

        /* Prayer Notifications Settings */
        .notification-settings {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* SEO Content Sections */
        .seo-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            padding: 2rem;
            margin: 2rem 0;
        }

        .seo-content h2 {
            color: var(--islamic-green);
            margin-bottom: 1rem;
        }

        .prayer-guide {
            border-left: 4px solid var(--islamic-gold);
            padding-left: 1rem;
            margin: 1rem 0;
        }

        /* Enhanced Cards */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: var(--gradient-green);
            color: white;
            border: none;
            font-weight: 600;
        }

        /* Enhanced Alerts */
        .alert {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        /* Loading Spinners */
        .spinner-border {
            color: var(--islamic-green) !important;
        }

        /* Enhanced Buttons */
        .btn-primary {
            background: var(--gradient-green);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--gradient-gold);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }

        .btn-outline-primary {
            border: 2px solid var(--islamic-green);
            color: var(--islamic-green);
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: var(--islamic-green);
            border-color: var(--islamic-green);
            transform: translateY(-2px);
        }

        /* Animations */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes countdownPulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Feature Highlights */
        .feature-box {
            text-align: center;
            padding: 2rem;
            border-radius: 15px;
            background: white;
            box-shadow: 0 8px 25px var(--shadow-light);
            margin: 1rem 0;
            transition: transform 0.3s ease;
        }

        .feature-box:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 3rem;
            color: var(--islamic-green);
            margin-bottom: 1rem;
        }

        /* Footer Enhanced */
        footer {
            background: linear-gradient(135deg, #14532d, #166534);
            margin-top: 3rem;
            padding: 3rem 0;
            color: #f8f9fa;
            font-family: 'Poppins', sans-serif;
        }

        footer .container {
            max-width: 1200px;
        }

        .footer-section {
            margin-bottom: 2rem;
        }

        footer .footer-heading {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #fff;
        }

        footer .quran-quote {
            font-size: 1.05rem;
            font-style: italic;
            line-height: 1.6;
            margin-bottom: 0.5rem;
        }

        footer .quran-translation {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.75);
        }

        .footer-links {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
            padding-bottom: 2px;
        }

        .footer-links a:hover {
            color: #fff;
        }

        .footer-links a::after {
            content: "";
            position: absolute;
            width: 0%;
            height: 2px;
            background: #fff;
            left: 0;
            bottom: 0;
            transition: width 0.3s ease;
        }

        .footer-links a:hover::after {
            width: 100%;
        }

        footer .footer-divider {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            margin: 2rem 0;
        }

        footer .footer-bottom {
            text-align: center;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 76px;
            }

            .prayer-card {
                margin-bottom: 1rem;
            }

            .next-prayer-countdown {
                font-size: 2rem;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 3px;
            }

            .calendar-day {
                padding: 5px;
                font-size: 0.8rem;
            }

            .custom-notification {
                top: 80px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            footer {
                text-align: center;
            }

            .footer-links {
                justify-content: center;
            }

            .footer-section {
                margin-bottom: 2rem;
                padding-bottom: 1.5rem;
                border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            }

            .footer-section:last-child {
                border-bottom: none;
            }

            footer .footer-heading {
                margin-bottom: 0.8rem;
                font-size: 1rem;
            }

            footer .quran-quote {
                font-size: 0.95rem;
            }

            footer .quran-translation {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .prayer-card .prayer-icon {
                font-size: 2rem;
            }

            .prayer-card .prayer-name {
                font-size: 1rem;
            }

            .prayer-card .prayer-time {
                font-size: 1.2rem;
            }

            .next-prayer-countdown {
                font-size: 1.8rem;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-islamic-green fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-mosque me-2"></i>
                SunnahWise
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="prayer-times.html">Prayer Times</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="mosque-finder.html">Mosque Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="qibla.html">Qibla Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="dhikr.html">Dhikr Counter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="zakat.html">Zakat Calculator</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container py-5">
            <!-- Enhanced Header Section -->
            <div class="section-header text-center">
                <h1><i class="fas fa-pray me-3"></i>Islamic Prayer Times Today</h1>
                <p class="lead">Accurate Namaz timings with countdown, Islamic calendar, and prayer tracking</p>
                <div class="d-flex justify-content-center gap-3 mt-3">
                    <span class="badge bg-success"><i class="fas fa-clock me-1"></i>Real-time Countdown</span>
                    <span class="badge bg-info"><i class="fas fa-calendar-islamic me-1"></i>Hijri Calendar</span>
                    <span class="badge bg-warning"><i class="fas fa-bell me-1"></i>Smart Notifications</span>
                </div>
            </div>

            <!-- Location Loading -->
            <div id="prayer-loading" class="text-center mb-4">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading prayer times...</span>
                </div>
                <p class="mt-2">Loading prayer times for your location...</p>
            </div>

            <!-- Location Error -->
            <div id="prayer-error" class="alert alert-warning text-center d-none" role="alert">
                <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Unable to get your location
                </h5>
                <p class="mb-0">Please allow location access to view accurate prayer times for your area.</p>
            </div>

            <!-- Next Prayer Countdown Banner -->
            <div id="next-prayer-banner" class="next-prayer-banner d-none">
                <h3><i class="fas fa-clock me-2"></i>Next Prayer</h3>
                <div class="next-prayer-countdown" id="next-prayer-timer">--:--:--</div>
                <div class="next-prayer-info" id="next-prayer-info">Loading next prayer information...</div>
            </div>

            <!-- Islamic Calendar Widget -->
            <div id="islamic-calendar" class="islamic-calendar d-none">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="islamic-date" id="islamic-date">
                            <h6 class="mb-1">Today's Islamic Date</h6>
                            <div id="hijri-date">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Prayer Calendar -->
            <div id="monthly-calendar" class="monthly-calendar d-none">
                <h4><i class="fas fa-calendar-alt me-2"></i>Monthly Prayer Calendar</h4>
                <div class="calendar-nav">
                    <button class="btn btn-sm btn-outline-primary" id="prev-month"><i
                            class="fas fa-chevron-left"></i></button>
                    <h5 id="current-month">Loading...</h5>
                    <button class="btn btn-sm btn-outline-primary" id="next-month"><i
                            class="fas fa-chevron-right"></i></button>
                </div>
                <div class="calendar-grid" id="calendar-days">
                    <!-- Calendar will be populated by JavaScript -->
                </div>
            </div>

            <!-- Prayer Calculation Method -->
            <div id="calculation-method" class="card mb-4 d-none">
                <div class="card-header">
                    <i class="fas fa-calculator me-2"></i>Prayer Calculation Method
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <select class="form-select" id="methodSelect">
                                <option value="2">Islamic Society of North America (ISNA)</option>
                                <option value="1">University of Islamic Sciences, Karachi</option>
                                <option value="3">Muslim World League</option>
                                <option value="4">Umm Al-Qura University, Makkah</option>
                                <option value="5">Egyptian General Authority of Survey</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-outline-primary" id="method-info-btn" data-bs-toggle="modal"
                                data-bs-target="#methodInfoModal">
                                <i class="fas fa-info-circle me-1"></i>Learn More
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Location Card -->
            <div id="prayer-location-card" class="location-card mb-4 d-none">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <span><i class="fas fa-map-marker-alt me-2"></i>Current Location</span>
                        <span class="badge bg-light text-dark" id="current-time">--:--</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <p class="mb-1">
                                <strong id="prayer-city">Loading...</strong>,
                                <span id="prayer-country">Loading...</span>
                            </p>
                            <small class="text-muted">
                                Coordinates: <span id="prayer-coordinates">---, ---</span>
                            </small>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-sm btn-outline-primary" onclick="getCurrentLocation()">
                                <i class="fas fa-sync-alt me-1"></i>Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notification Settings -->
            <div id="notification-settings" class="notification-settings d-none">
                <h4><i class="fas fa-bell me-2"></i>Prayer Notification Settings</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="notificationSwitch">
                            <label class="form-check-label" for="notificationSwitch">
                                Enable Prayer Notifications
                            </label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="advanceNotificationSwitch" checked>
                            <label class="form-check-label" for="advanceNotificationSwitch">
                                15-minute advance notification
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="soundNotificationSwitch">
                            <label class="form-check-label" for="soundNotificationSwitch">
                                Enable notification sound
                            </label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="vibrationSwitch">
                            <label class="form-check-label" for="vibrationSwitch">
                                Enable vibration (mobile)
                            </label>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <button class="btn btn-sm btn-outline-primary" id="test-notification-btn">
                        <i class="fas fa-bell me-1"></i>Test Notification
                    </button>
                    <small class="text-muted ms-2">Check if notifications are working</small>
                </div>
            </div>

            <!-- Time Format Toggle -->
            <div id="prayer-format-toggle" class="text-center mb-4 d-none">
                <div class="form-check form-switch d-inline-block me-3">
                    <input class="form-check-input" type="checkbox" id="timeFormatSwitch" checked>
                    <label class="form-check-label" for="timeFormatSwitch">
                        <span id="timeFormatLabel">24-hour format</span>
                    </label>
                </div>
                <div class="form-check form-switch d-inline-block">
                    <input class="form-check-input" type="checkbox" id="autoRefreshSwitch" checked>
                    <label class="form-check-label" for="autoRefreshSwitch">
                        <i class="fas fa-sync-alt me-1"></i>Auto-refresh (5 min)
                    </label>
                </div>
            </div>

            <!-- Enhanced Prayer Times Grid -->
            <div id="prayer-times-grid" class="row g-4 d-none">
                <!-- Prayer cards will be populated by JavaScript -->
            </div>

            <!-- SEO Content Sections -->
            <div class="seo-content">
                <h2>Complete Guide to Islamic Prayer Times</h2>
                <p>Understanding and observing the five daily prayers (Salah) is one of the fundamental pillars of
                    Islam. Our accurate prayer time calculator helps Muslims worldwide stay connected with their faith
                    by providing precise prayer schedules based on your geographical location.</p>

                <div class="row">
                    <div class="col-md-6">
                        <div class="prayer-guide">
                            <h4><i class="fas fa-sun text-warning me-2"></i>Fajr Prayer (Dawn)</h4>
                            <p><strong>Arabic:</strong> صلاة الفجر</p>
                            <p><strong>Time:</strong> From dawn until sunrise</p>
                            <p>The Fajr prayer is performed in the early morning before sunrise. It consists of 2
                                Rak'ahs (units) and is one of the most spiritually rewarding prayers, as mentioned in
                                the Quran: "And recite the Qur'an at dawn. Indeed, the recitation of dawn is ever
                                witnessed."</p>
                        </div>

                        <div class="prayer-guide">
                            <h4><i class="fas fa-sun text-info me-2"></i>Dhuhr Prayer (Midday)</h4>
                            <p><strong>Arabic:</strong> صلاة الظهر</p>
                            <p><strong>Time:</strong> After the sun crosses the meridian until Asr</p>
                            <p>Dhuhr is the midday prayer performed after the sun crosses the meridian. It consists of 4
                                Rak'ahs and serves as a spiritual break during the busy day, reminding Muslims to pause
                                and remember Allah.</p>
                        </div>

                        <div class="prayer-guide">
                            <h4><i class="fas fa-cloud-sun text-primary me-2"></i>Asr Prayer (Afternoon)</h4>
                            <p><strong>Arabic:</strong> صلاة العصر</p>
                            <p><strong>Time:</strong> Late afternoon until sunset</p>
                            <p>The Asr prayer is performed in the late afternoon and consists of 4 Rak'ahs. The Prophet
                                Muhammad (peace be upon him) emphasized its importance, stating that whoever abandons
                                the Asr prayer will have their deeds nullified.</p>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="prayer-guide">
                            <h4><i class="fas fa-moon text-danger me-2"></i>Maghrib Prayer (Sunset)</h4>
                            <p><strong>Arabic:</strong> صلاة المغرب</p>
                            <p><strong>Time:</strong> Just after sunset until twilight disappears</p>
                            <p>Maghrib is performed immediately after sunset and consists of 3 Rak'ahs. It's
                                traditionally the time when Muslim families gather to break their fast during Ramadan
                                and share the evening meal.</p>
                        </div>

                        <div class="prayer-guide">
                            <h4><i class="fas fa-star text-dark me-2"></i>Isha Prayer (Night)</h4>
                            <p><strong>Arabic:</strong> صلاة العشاء</p>
                            <p><strong>Time:</strong> After twilight until dawn</p>
                            <p>The Isha prayer is the final prayer of the day, consisting of 4 Rak'ahs. It's performed
                                after the twilight has completely disappeared and serves as a spiritual conclusion to
                                the day.</p>
                        </div>

                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle me-2"></i>Did You Know?</h5>
                            <p class="mb-0">The timing of Islamic prayers is based on the position of the sun, making
                                them naturally aligned with the Earth's rotation. This ensures that Muslims around the
                                world are constantly in prayer throughout the 24-hour cycle.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEO Content: Calculation Methods -->
            <div class="seo-content">
                <h2>Prayer Time Calculation Methods Explained</h2>
                <p>Different Islamic organizations have developed various methods for calculating prayer times based on
                    astronomical observations and scholarly consensus. Our calculator supports multiple methods to
                    ensure accuracy across different regions.</p>

                <div class="row">
                    <div class="col-md-6">
                        <h4>Popular Calculation Methods:</h4>
                        <ul>
                            <li><strong>Islamic Society of North America (ISNA):</strong> Widely used in North America
                                (Fajr: 15°, Isha: 15°)</li>
                            <li><strong>Muslim World League:</strong> Global standard method (Fajr: 18°, Isha: 17°)</li>
                            <li><strong>University of Islamic Sciences, Karachi:</strong> Common in South Asia (Fajr:
                                18°, Isha: 18°)</li>
                            <li><strong>Umm Al-Qura University, Makkah:</strong> Used in Saudi Arabia (Fajr: 18.5°,
                                Isha: 90 min after Maghrib)</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h4>Why Different Methods?</h4>
                        <p>The variation in calculation methods stems from different interpretations of when true dawn
                            (for Fajr) and when true night (for Isha) begins. These differences are based on:</p>
                        <ul>
                            <li>Geographical location and latitude</li>
                            <li>Local astronomical observations</li>
                            <li>Historical Islamic scholarly consensus</li>
                            <li>Regional traditional practices</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- SEO Content: Features -->
            <div class="seo-content">
                <h2>Advanced Prayer Time Features</h2>
                <div class="row">
                    <div class="col-md-4">
                        <div class="feature-box">
                            <div class="feature-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h4>Real-time Countdown</h4>
                            <p>Never miss a prayer with our real-time countdown timers that show exactly how much time
                                remains until the next prayer.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-box">
                            <div class="feature-icon">
                                <i class="fas fa-calendar-islamic"></i>
                            </div>
                            <h4>Islamic Calendar</h4>
                            <p>Stay connected with Islamic dates, including Hijri calendar integration and notifications
                                for important Islamic events.</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="feature-box">
                            <div class="feature-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <h4>Smart Notifications</h4>
                            <p>Customizable prayer notifications with advance alerts, sound options, and vibration
                                features for mobile devices.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SEO Content: FAQ -->
            <div class="seo-content">
                <h2>Frequently Asked Questions About Prayer Times</h2>
                <div class="accordion" id="prayerFAQ">
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#faq1">
                                How accurate are the prayer times calculated on this website?
                            </button>
                        </h3>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#prayerFAQ">
                            <div class="accordion-body">
                                Our prayer times are calculated using internationally recognized astronomical algorithms
                                and are accurate to within minutes. We use your precise geographical coordinates and
                                multiple calculation methods approved by Islamic authorities worldwide.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#faq2">
                                Can I use these prayer times when traveling?
                            </button>
                        </h3>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#prayerFAQ">
                            <div class="accordion-body">
                                Yes! Our prayer time calculator automatically detects your current location, making it
                                perfect for travelers. The times will update based on your new geographical position and
                                time zone.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#faq3">
                                Which calculation method should I choose?
                            </button>
                        </h3>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#prayerFAQ">
                            <div class="accordion-body">
                                The choice depends on your location and local Islamic community preferences. ISNA method
                                is popular in North America, Muslim World League is widely accepted globally, and
                                regional methods like Karachi University are preferred in specific areas. Consult your
                                local mosque for guidance.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h3 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#faq4">
                                Do prayer times change every day?
                            </button>
                        </h3>
                        <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#prayerFAQ">
                            <div class="accordion-body">
                                Yes, prayer times change daily based on the sun's position relative to your location.
                                The changes are more noticeable during season transitions and are minimal near the
                                equator. Our calculator automatically updates daily to provide accurate times.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Calculation Method Info Modal -->
    <div class="modal fade" id="methodInfoModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-islamic-green text-white">
                    <h5 class="modal-title">Prayer Time Calculation Methods</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Method</th>
                                    <th>Fajr Angle</th>
                                    <th>Isha Angle</th>
                                    <th>Region</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Islamic Society of North America</td>
                                    <td>15°</td>
                                    <td>15°</td>
                                    <td>North America</td>
                                </tr>
                                <tr>
                                    <td>University of Islamic Sciences, Karachi</td>
                                    <td>18°</td>
                                    <td>18°</td>
                                    <td>South Asia, Pakistan</td>
                                </tr>
                                <tr>
                                    <td>Muslim World League</td>
                                    <td>18°</td>
                                    <td>17°</td>
                                    <td>Global</td>
                                </tr>
                                <tr>
                                    <td>Umm Al-Qura University, Makkah</td>
                                    <td>18.5°</td>
                                    <td>90 min after Maghrib</td>
                                    <td>Saudi Arabia</td>
                                </tr>
                                <tr>
                                    <td>Egyptian General Authority of Survey</td>
                                    <td>19.5°</td>
                                    <td>17.5°</td>
                                    <td>Egypt, Middle East</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="alert alert-info">
                        <strong>Note:</strong> Different calculation methods may result in variations of a few minutes.
                        Choose the method that's most commonly used in your area or recommended by your local Islamic
                        center.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <!-- Quran Quote -->
                <div class="col-md-4 col-12 footer-section">
                    <h5 class="footer-heading">Quran</h5>
                    <p class="quran-quote">
                        "Indeed, prayer has been decreed upon the believers a decree of specified times."
                    </p>
                    <p class="quran-translation">— Surah An-Nisa 4:103</p>
                </div>

                <!-- Quick Links -->
                <div class="col-md-4 col-12 footer-section">
                    <h5 class="footer-heading">Quick Links</h5>
                    <div class="footer-links">
                        <a href="index.html">Home</a>
                        <a href="prayer-times.html">Prayer Times</a>
                        <a href="mosque-finder.html">Mosque Finder</a>
                        <a href="qibla.html">Qibla Finder</a>
                        <a href="dhikr.html">Dhikr Counter</a>
                        <a href="zakat.html">Zakat Calculator</a>
                        <a href="about.html">About</a>
                    </div>
                </div>

                <!-- Privacy & Legal -->
                <div class="col-md-4 col-12 footer-section">
                    <h5 class="footer-heading">Legal</h5>
                    <div class="footer-links">
                        <a href="privacy.html">Privacy Policy</a>
                        <a href="terms.html">Terms of Service</a>
                        <a href="disclaimer.html">Disclaimer</a>
                        <a href="cookies.html">Cookie Policy</a>
                        <a href="contact.html">Contact Us</a>
                    </div>
                </div>
            </div>

            <!-- Bottom -->
            <div class="footer-bottom">
                <p>© 2025 SunnahWise. All rights reserved.</p>
                <p class="small">Made with ❤️ for the Ummah</p>
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Enhanced Location Manager and Prayer Times Script -->
    <script>
        // Enhanced Location Manager
        class LocationManager {
            constructor() {
                this.userLocation = null;
                this.STORAGE_KEY = 'userLocationData';
                this.MAX_AGE = 30 * 60 * 1000; // 30 minutes
                this.isInitialized = false;
            }

            async initialize() {
                if (this.isInitialized) return;

                try {
                    // 1. Check sessionStorage for recent location
                    const stored = this.getStoredLocation();
                    if (stored) {
                        this.userLocation = stored;
                        this.isInitialized = true;

                        // If we don't have city/country info, try to get it
                        if (!this.userLocation.city || !this.userLocation.country) {
                            await this.getReverseGeocoding();
                        }

                        return this.userLocation;
                    }

                    // 2. Get fresh location
                    return await this.detectFreshLocation();
                } catch (error) {
                    console.error('Location manager initialization failed:', error);
                    throw error;
                }
            }

            async getLocation(forceRefresh = false) {
                if (forceRefresh) {
                    this.clearLocation();
                    this.isInitialized = false;
                }

                if (!this.isInitialized) {
                    return await this.initialize();
                }

                return this.userLocation;
            }

            async detectFreshLocation() {
                return new Promise((resolve, reject) => {
                    if (!navigator.geolocation) {
                        reject(new Error('Geolocation not supported by browser'));
                        return;
                    }

                    navigator.geolocation.getCurrentPosition(
                        async (position) => {
                            try {
                                this.userLocation = {
                                    latitude: position.coords.latitude,
                                    longitude: position.coords.longitude,
                                    timestamp: Date.now(),
                                    city: null,
                                    country: null
                                };

                                // Get city/country information
                                await this.getReverseGeocoding();

                                this.saveLocation();
                                this.isInitialized = true;
                                resolve(this.userLocation);
                            } catch (error) {
                                reject(error);
                            }
                        },
                        (error) => {
                            const errorMessage = this.getGeolocationError(error);
                            reject(new Error(errorMessage));
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 15000,
                            maximumAge: this.MAX_AGE
                        }
                    );
                });
            }

            getGeolocationError(error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        return "Location access denied. Please enable location permissions in your browser settings.";
                    case error.POSITION_UNAVAILABLE:
                        return "Location information is unavailable.";
                    case error.TIMEOUT:
                        return "Location request timed out. Please try again.";
                    default:
                        return "An unknown error occurred while getting your location.";
                }
            }

            async getReverseGeocoding() {
                if (!this.userLocation) return;

                try {
                    const response = await fetch(
                        `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${this.userLocation.latitude}&longitude=${this.userLocation.longitude}&localityLanguage=en`
                    );

                    if (!response.ok) {
                        throw new Error(`Geocoding API error: ${response.status}`);
                    }

                    const data = await response.json();

                    this.userLocation.city = data.city || data.locality || 'Unknown City';
                    this.userLocation.country = data.countryName || 'Unknown Country';

                    this.saveLocation();
                } catch (error) {
                    console.warn('Reverse geocoding failed:', error);
                    this.userLocation.city = this.userLocation.city || 'Unknown City';
                    this.userLocation.country = this.userLocation.country || 'Unknown Country';
                }
            }

            getStoredLocation() {
                try {
                    const stored = sessionStorage.getItem(this.STORAGE_KEY);
                    if (!stored) return null;

                    const data = JSON.parse(stored);
                    const isFresh = Date.now() - data.timestamp < this.MAX_AGE;

                    return isFresh ? data : null;
                } catch (error) {
                    console.warn('Error reading stored location:', error);
                    return null;
                }
            }

            saveLocation() {
                if (this.userLocation) {
                    try {
                        sessionStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.userLocation));
                    } catch (error) {
                        console.warn('Error saving location to storage:', error);
                    }
                }
            }

            clearLocation() {
                try {
                    sessionStorage.removeItem(this.STORAGE_KEY);
                } catch (error) {
                    console.warn('Error clearing location storage:', error);
                }
                this.userLocation = null;
                this.isInitialized = false;
            }

            hasLocation() {
                return this.isInitialized && this.userLocation !== null;
            }

            getLocationData() {
                return this.userLocation ? { ...this.userLocation } : null;
            }
        }

        // Initialize global instance
        window.locationManager = new LocationManager();

        // Enhanced Prayer Times functionality
        document.addEventListener('DOMContentLoaded', function () {
            let currentPrayerTimes = {};
            let nextPrayer = null;
            let currentPrayer = null;
            let calendarCurrentDate = new Date();
            let autoRefreshInterval = null;
            let notificationSent = {};

            // Register Service Worker for PWA functionality
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('Service Worker registered'))
                    .catch(error => console.log('Service Worker registration failed: ', error));
            }

            // Initialize Islamic calendar
            updateIslamicCalendar();

            // Initialize current time display
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);

            // Initialize location and load prayer times
            const initializeApp = async () => {
                try {
                    document.getElementById('prayer-loading').classList.remove('d-none');

                    const location = await window.locationManager.getLocation();

                    // Safe property access with fallbacks
                    if (location) {
                        document.getElementById('prayer-city').textContent = location.city || 'Unknown';
                        document.getElementById('prayer-country').textContent = location.country || 'Unknown';

                        if (location.latitude && location.longitude) {
                            document.getElementById('prayer-coordinates').textContent =
                                `${location.latitude.toFixed(4)}, ${location.longitude.toFixed(4)}`;
                        } else {
                            document.getElementById('prayer-coordinates').textContent = 'Unknown coordinates';
                        }
                    }

                    loadPrayerTimes();
                    showAllElements();
                    initializeMonthlyCalendar();
                    setupAutoRefresh();
                    setupNotifications();

                } catch (error) {
                    console.error('Failed to get location:', error);
                    document.getElementById('prayer-loading').classList.add('d-none');
                    document.getElementById('prayer-error').classList.remove('d-none');

                    const errorElement = document.getElementById('prayer-error');
                    errorElement.innerHTML = `
                        <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Location Access Required</h5>
                        <p>${error.message || 'Please allow location access to view accurate prayer times for your area.'}</p>
                        <button class="btn btn-sm btn-warning mt-2" onclick="getCurrentLocation()">Try Again</button>
                    `;
                }
            };

            // Start the app
            initializeApp();

            // Setup enhanced event listeners
            setupEnhancedEventListeners();

            function updateCurrentTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', {
                    hour12: !document.getElementById('timeFormatSwitch')?.checked,
                    hour: '2-digit',
                    minute: '2-digit'
                });
                const currentTimeElement = document.getElementById('current-time');
                if (currentTimeElement) {
                    currentTimeElement.textContent = timeString;
                }
            }

            async function updateIslamicCalendar() {
                try {
                    const response = await fetch('https://api.aladhan.com/v1/gToH');
                    const data = await response.json();

                    if (data.code === 200) {
                        const hijriDate = data.data.hijri;
                        const dateString = `${hijriDate.day} ${hijriDate.month.en} ${hijriDate.year}`;
                        document.getElementById('hijri-date').textContent = dateString;
                        document.getElementById('islamic-date').classList.remove('d-none');
                    }
                } catch (error) {
                    console.error('Error loading Islamic date:', error);
                }
            }

            function showAllElements() {
                const elements = [
                    'next-prayer-banner', 'calculation-method', 'prayer-location-card',
                    'notification-settings', 'prayer-format-toggle', 'prayer-times-grid',
                    'islamic-calendar', 'monthly-calendar'
                ];

                elements.forEach((id, index) => {
                    setTimeout(() => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.classList.remove('d-none');
                            element.classList.add('fade-in');
                        }
                    }, index * 200);
                });
            }

            // Auto-refresh functionality
            function setupAutoRefresh() {
                const autoRefreshSwitch = document.getElementById('autoRefreshSwitch');
                
                if (autoRefreshSwitch) {
                    // Load saved preference
                    autoRefreshSwitch.checked = localStorage.getItem('autoRefresh') !== 'false';
                    
                    autoRefreshSwitch.addEventListener('change', function() {
                        localStorage.setItem('autoRefresh', this.checked);
                        
                        if (this.checked) {
                            startAutoRefresh();
                        } else {
                            stopAutoRefresh();
                        }
                    });
                    
                    // Start auto-refresh if enabled
                    if (autoRefreshSwitch.checked) {
                        startAutoRefresh();
                    }
                }
                
                function startAutoRefresh() {
                    // Clear existing interval
                    if (autoRefreshInterval) {
                        clearInterval(autoRefreshInterval);
                    }
                    
                    // Refresh every 5 minutes (300000 ms)
                    autoRefreshInterval = setInterval(() => {
                        console.log('Auto-refreshing prayer times...');
                        loadPrayerTimes();
                    }, 300000); // 5 minutes
                }
                
                function stopAutoRefresh() {
                    if (autoRefreshInterval) {
                        clearInterval(autoRefreshInterval);
                        autoRefreshInterval = null;
                    }
                }
            }

            // Notification functionality
            function setupNotifications() {
                const notificationSwitch = document.getElementById('notificationSwitch');
                const advanceSwitch = document.getElementById('advanceNotificationSwitch');
                const soundSwitch = document.getElementById('soundNotificationSwitch');
                const vibrationSwitch = document.getElementById('vibrationSwitch');
                const testButton = document.getElementById('test-notification-btn');
                
                // Load saved preferences
                notificationSwitch.checked = localStorage.getItem('notificationsEnabled') === 'true';
                advanceSwitch.checked = localStorage.getItem('advanceNotifications') !== 'false';
                soundSwitch.checked = localStorage.getItem('notificationSound') === 'true';
                vibrationSwitch.checked = localStorage.getItem('notificationVibration') === 'true';
                
                // Add event listeners
                notificationSwitch.addEventListener('change', function() {
                    localStorage.setItem('notificationsEnabled', this.checked);
                    if (this.checked) {
                        requestNotificationPermission();
                    }
                });
                
                advanceSwitch.addEventListener('change', function() {
                    localStorage.setItem('advanceNotifications', this.checked);
                });
                
                soundSwitch.addEventListener('change', function() {
                    localStorage.setItem('notificationSound', this.checked);
                });
                
                vibrationSwitch.addEventListener('change', function() {
                    localStorage.setItem('notificationVibration', this.checked);
                });
                
                // Test notification button
                if (testButton) {
                    testButton.addEventListener('click', function() {
                        showPrayerNotification('Test', '12:00 PM', false, true);
                    });
                }
                
                // Request permission if notifications are enabled
                if (notificationSwitch.checked) {
                    requestNotificationPermission();
                }
            }

            function requestNotificationPermission() {
                if (!("Notification" in window)) {
                    console.log("This browser does not support notifications");
                    return;
                }
                
                if (Notification.permission === "default") {
                    Notification.requestPermission().then(permission => {
                        if (permission === "granted") {
                            console.log("Notification permission granted");
                        }
                    });
                }
            }

            function showPrayerNotification(prayerName, time, isAdvance = false, isTest = false) {
                const notificationSwitch = document.getElementById('notificationSwitch');
                if (!notificationSwitch || !notificationSwitch.checked) return;
                
                // Create a unique key for this notification to avoid duplicates
                const notificationKey = `${prayerName}-${isAdvance ? 'advance' : 'time'}-${new Date().toDateString()}`;
                
                if (notificationSent[notificationKey] && !isTest) {
                    return; // Already sent this notification today
                }
                
                notificationSent[notificationKey] = true;
                
                if (Notification.permission === "granted") {
                    const title = isTest ? '🕌 Test Notification' : 
                                (isAdvance ? `🕌 ${prayerName} in 15 minutes` : `🕌 ${prayerName} Time`);
                    const body = isTest ? 'This is a test notification from SunnahWise' :
                                (isAdvance ? `Get ready for ${prayerName} prayer at ${time}` : `It's time for ${prayerName} prayer`);
                    
                    const notification = new Notification(title, {
                        body: body,
                        icon: '/images/mosque-icon.png',
                        tag: 'prayer-notification',
                        requireInteraction: true
                    });
                    
                    // Add click handler to focus the tab
                    notification.onclick = () => {
                        window.focus();
                        notification.close();
                    };
                    
                    // Auto-close after 10 seconds (except for tests)
                    if (!isTest) {
                        setTimeout(() => {
                            notification.close();
                        }, 10000);
                    }
                    
                    // Add sound if enabled
                    const soundSwitch = document.getElementById('soundNotificationSwitch');
                    if (soundSwitch && soundSwitch.checked) {
                        playNotificationSound();
                    }
                    
                } else if (Notification.permission === "default" && !isTest) {
                    // Fallback to custom notification if permission not granted
                    showFallbackNotification(prayerName, time, isAdvance);
                } else if (Notification.permission === "denied" || isTest) {
                    // Always show fallback for tests or when permission is denied
                    showFallbackNotification(prayerName, time, isAdvance, isTest);
                }
            }

            function showFallbackNotification(prayerName, time, isAdvance = false, isTest = false) {
                // Create a custom notification element on the page
                const notificationEl = document.createElement('div');
                notificationEl.className = `custom-notification alert ${isTest ? 'alert-warning' : 'alert-info'}`;
                notificationEl.innerHTML = `
                    <strong>🕌 ${isTest ? 'Test Notification' : (prayerName + ' ' + (isAdvance ? 'in 15 minutes' : 'Time'))}</strong>
                    <br>${isTest ? 'This is a test notification from SunnahWise' : (isAdvance ? `Get ready for ${prayerName} at ${time}` : `It's time for ${prayerName} prayer`)}
                    <button class="btn-close float-end" onclick="this.parentElement.remove()"></button>
                `;
                
                document.body.appendChild(notificationEl);
                
                // Auto-remove after 10 seconds
                setTimeout(() => {
                    if (notificationEl.parentElement) {
                        notificationEl.remove();
                    }
                }, 10000);
            }

            function playNotificationSound() {
                // Simple notification sound using Web Audio API
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 1);
                } catch (error) {
                    console.log('Audio context not supported');
                }
            }

            function setupEnhancedEventListeners() {
                // Calculation method selector
                const methodSelect = document.getElementById('methodSelect');
                if (methodSelect) {
                    methodSelect.value = localStorage.getItem('calculationMethod') || '2';
                    methodSelect.addEventListener('change', function () {
                        localStorage.setItem('calculationMethod', this.value);
                        loadPrayerTimes();
                    });
                }

                // Time format toggle
                const timeFormatSwitch = document.getElementById('timeFormatSwitch');
                if (timeFormatSwitch) {
                    timeFormatSwitch.checked = localStorage.getItem('timeFormat') === '24h';
                    timeFormatSwitch.addEventListener('change', function () {
                        localStorage.setItem('timeFormat', this.checked ? '24h' : '12h');
                        const label = document.getElementById('timeFormatLabel');
                        if (label) {
                            label.textContent = this.checked ? '24-hour format' : '12-hour format';
                        }
                        loadPrayerTimes();
                    });
                }

                // Calendar navigation
                const prevMonthBtn = document.getElementById('prev-month');
                const nextMonthBtn = document.getElementById('next-month');

                if (prevMonthBtn) {
                    prevMonthBtn.addEventListener('click', () => {
                        calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() - 1);
                        initializeMonthlyCalendar();
                    });
                }

                if (nextMonthBtn) {
                    nextMonthBtn.addEventListener('click', () => {
                        calendarCurrentDate.setMonth(calendarCurrentDate.getMonth() + 1);
                        initializeMonthlyCalendar();
                    });
                }
            }

            function initializeMonthlyCalendar() {
                const monthNames = ["January", "February", "March", "April", "May", "June",
                    "July", "August", "September", "October", "November", "December"];

                const currentMonth = calendarCurrentDate.getMonth();
                const currentYear = calendarCurrentDate.getFullYear();

                const currentMonthElement = document.getElementById('current-month');
                if (currentMonthElement) {
                    currentMonthElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;
                }

                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);
                const daysInMonth = lastDay.getDate();

                const calendarGrid = document.getElementById('calendar-days');
                if (!calendarGrid) return;

                calendarGrid.innerHTML = '';

                // Add day headers
                const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayHeaders.forEach(day => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day-header';
                    dayElement.textContent = day;
                    calendarGrid.appendChild(dayElement);
                });

                // Add empty cells for days before the first day of the month
                for (let i = 0; i < firstDay.getDay(); i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day';
                    calendarGrid.appendChild(emptyDay);
                }

                // Add days of the month
                const today = new Date();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = day;

                    // Highlight current day
                    if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                        dayElement.classList.add('current');
                    }

                    calendarGrid.appendChild(dayElement);
                }
            }

            async function loadPrayerTimes() {
                if (!window.locationManager.hasLocation()) {
                    console.log('No location available for prayer times');
                    return;
                }

                const methodSelect = document.getElementById('methodSelect');
                const timeFormatSwitch = document.getElementById('timeFormatSwitch');

                if (!methodSelect || !timeFormatSwitch) return;

                const method = methodSelect.value || '2';
                const is24Hour = timeFormatSwitch.checked;

                try {
                    const date = new Date();
                    const dateString = `${date.getDate().toString().padStart(2, '0')}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getFullYear()}`;

                    const location = window.locationManager.getLocationData();
                    if (!location || !location.latitude || !location.longitude) {
                        console.error('Invalid location data');
                        return;
                    }

                    const url = `https://api.aladhan.com/v1/timings/${dateString}?latitude=${location.latitude}&longitude=${location.longitude}&method=${method}`;

                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.code === 200) {
                        currentPrayerTimes = data.data.timings;
                        displayEnhancedPrayerTimes(currentPrayerTimes, is24Hour);
                        startNextPrayerCountdown();
                        updateCurrentPrayerStatus(currentPrayerTimes);
                    }
                } catch (error) {
                    console.error('Error loading prayer times:', error);
                }
            }

            function displayEnhancedPrayerTimes(timings, is24Hour) {
                const prayers = [
                    { key: 'Fajr', name: 'Fajr', arabic: 'صلاة الفجر', icon: 'sun' },
                    { key: 'Sunrise', name: 'Sunrise', arabic: 'الشروق', icon: 'sun' },
                    { key: 'Dhuhr', name: 'Dhuhr', arabic: 'صلاة الظهر', icon: 'sun' },
                    { key: 'Asr', name: 'Asr', arabic: 'صلاة العصر', icon: 'cloud-sun' },
                    { key: 'Maghrib', name: 'Maghrib', arabic: 'صلاة المغرب', icon: 'moon' },
                    { key: 'Isha', name: 'Isha', arabic: 'صلاة العشاء', icon: 'star' }
                ];

                const grid = document.getElementById('prayer-times-grid');
                if (!grid) return;

                grid.innerHTML = '';

                prayers.forEach(prayer => {
                    const time = timings[prayer.key];
                    if (!time) return;

                    const formattedTime = is24Hour ? time : convertTo12Hour(time);

                    const col = document.createElement('div');
                    col.className = 'col-lg-4 col-md-6';
                    col.innerHTML = `
                        <div class="prayer-card" id="${prayer.name.toLowerCase()}-card">
                            
                            <div class="prayer-icon">
                                <i class="fas fa-${prayer.icon}"></i>
                            </div>
                            <div class="prayer-name">${prayer.name}</div>
                            <div class="prayer-arabic">${prayer.arabic}</div>
                            <div class="prayer-time" id="${prayer.name.toLowerCase()}-time">${formattedTime}</div>
                            <div class="countdown-timer" id="${prayer.name.toLowerCase()}-countdown"></div>
                        </div>
                    `;
                    grid.appendChild(col);
                });

                document.getElementById('prayer-loading').classList.add('d-none');
            }

            function startNextPrayerCountdown() {
                // Clear existing interval
                if (window.nextPrayerInterval) {
                    clearInterval(window.nextPrayerInterval);
                }

                window.nextPrayerInterval = setInterval(() => {
                    updateNextPrayerCountdown();
                }, 1000);
            }

            function updateNextPrayerCountdown() {
                if (!currentPrayerTimes || Object.keys(currentPrayerTimes).length === 0) return;

                const now = new Date();
                const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];

                let nextPrayerTime = null;
                let nextPrayerName = null;
                let nextPrayerFormattedTime = null;

                // Find the next prayer
                for (const prayer of prayers) {
                    if (!currentPrayerTimes[prayer]) continue;

                    const [hours, minutes] = currentPrayerTimes[prayer].split(':').map(Number);
                    const prayerTime = new Date();
                    prayerTime.setHours(hours, minutes, 0, 0);

                    // If prayer time is today and in future
                    if (prayerTime > now) {
                        nextPrayerTime = prayerTime;
                        nextPrayerName = prayer;
                        nextPrayerFormattedTime = convertTo12Hour(currentPrayerTimes[prayer]);
                        break;
                    }
                }

                // If no prayer found for today, use tomorrow's Fajr
                if (!nextPrayerTime && currentPrayerTimes['Fajr']) {
                    const [hours, minutes] = currentPrayerTimes['Fajr'].split(':').map(Number);
                    nextPrayerTime = new Date();
                    nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
                    nextPrayerTime.setHours(hours, minutes, 0, 0);
                    nextPrayerName = 'Fajr';
                    nextPrayerFormattedTime = convertTo12Hour(currentPrayerTimes['Fajr']);
                }

                if (!nextPrayerTime) return;

                const diff = nextPrayerTime.getTime() - now.getTime();

                if (diff > 0) {
                    const hoursLeft = Math.floor(diff / (1000 * 60 * 60));
                    const minutesLeft = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const secondsLeft = Math.floor((diff % (1000 * 60)) / 1000);

                    const countdownElement = document.getElementById('next-prayer-timer');
                    const infoElement = document.getElementById('next-prayer-info');

                    if (countdownElement) {
                        countdownElement.textContent =
                            `${hoursLeft.toString().padStart(2, '0')}:${minutesLeft.toString().padStart(2, '0')}:${secondsLeft.toString().padStart(2, '0')}`;

                        // Add pulsing animation when under 10 minutes
                        if (diff < 600000) {
                            countdownElement.style.animation = 'countdownPulse 1s infinite';
                        } else {
                            countdownElement.style.animation = 'none';
                        }
                    }

                    if (infoElement && nextPrayerName && nextPrayerFormattedTime) {
                        infoElement.textContent = `Next: ${nextPrayerName} at ${nextPrayerFormattedTime}`;
                    }

                    // Trigger notifications
                    const advanceSwitch = document.getElementById('advanceNotificationSwitch');
                    if (advanceSwitch && advanceSwitch.checked && diff <= 900000 && diff > 899000) { // 15 minutes
                        showPrayerNotification(nextPrayerName, nextPrayerFormattedTime, true);
                    }
                    
                    if (diff <= 1000 && diff > 0) {
                        showPrayerNotification(nextPrayerName, nextPrayerFormattedTime, false);
                    }
                }
            }

            function updateCurrentPrayerStatus(timings) {
                if (!timings) return;

                const prayers = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
                const now = new Date();

                // Remove all current/next classes
                prayers.forEach(prayer => {
                    const card = document.getElementById(`${prayer.toLowerCase()}-card`);
                    if (card) {
                        card.classList.remove('current-prayer', 'next-prayer');
                    }
                });

                // Find current and next prayer
                for (let i = 0; i < prayers.length; i++) {
                    const prayer = prayers[i];
                    if (!timings[prayer]) continue;

                    const [hours, minutes] = timings[prayer].split(':').map(Number);

                    const prayerTime = new Date();
                    prayerTime.setHours(hours, minutes, 0, 0);

                    const nextPrayerTime = new Date();
                    if (i < prayers.length - 1 && timings[prayers[i + 1]]) {
                        const nextPrayerKey = prayers[i + 1];
                        const [nextHours, nextMinutes] = timings[nextPrayerKey].split(':').map(Number);
                        nextPrayerTime.setHours(nextHours, nextMinutes, 0, 0);
                    } else {
                        // Next day's Fajr
                        if (!timings.Fajr) continue;
                        const [fajrHours, fajrMinutes] = timings.Fajr.split(':').map(Number);
                        nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
                        nextPrayerTime.setHours(fajrHours, fajrMinutes, 0, 0);
                    }

                    if (now >= prayerTime && now < nextPrayerTime) {
                        currentPrayer = prayer;
                        nextPrayer = i < prayers.length - 1 ? prayers[i + 1] : 'Fajr';
                        break;
                    }
                }

                // Apply classes
                if (currentPrayer) {
                    const currentCard = document.getElementById(`${currentPrayer.toLowerCase()}-card`);
                    if (currentCard) currentCard.classList.add('current-prayer');
                }
                if (nextPrayer) {
                    const nextCard = document.getElementById(`${nextPrayer.toLowerCase()}-card`);
                    if (nextCard) nextCard.classList.add('next-prayer');
                }
            }

            function convertTo12Hour(time24) {
                if (!time24) return '--:--';
                const [hours, minutes] = time24.split(':');
                const hour12 = ((parseInt(hours) + 11) % 12) + 1;
                const ampm = parseInt(hours) >= 12 ? 'PM' : 'AM';
                return `${hour12}:${minutes} ${ampm}`;
            }

            // Global function for location refresh
            window.getCurrentLocation = function () {
                const loadingElement = document.getElementById('prayer-loading');
                const errorElement = document.getElementById('prayer-error');

                if (loadingElement) loadingElement.classList.remove('d-none');
                if (errorElement) errorElement.classList.add('d-none');

                window.locationManager.getLocation(true).then((location) => {
                    // Safe property access with fallbacks
                    if (location) {
                        const cityElement = document.getElementById('prayer-city');
                        const countryElement = document.getElementById('prayer-country');
                        const coordinatesElement = document.getElementById('prayer-coordinates');

                        if (cityElement) cityElement.textContent = location.city || 'Unknown';
                        if (countryElement) countryElement.textContent = location.country || 'Unknown';

                        if (coordinatesElement) {
                            if (location.latitude && location.longitude) {
                                coordinatesElement.textContent =
                                    `${location.latitude.toFixed(4)}, ${location.longitude.toFixed(4)}`;
                            } else {
                                coordinatesElement.textContent = 'Unknown coordinates';
                            }
                        }
                    }

                    loadPrayerTimes();
                }).catch((error) => {
                    if (loadingElement) loadingElement.classList.add('d-none');
                    if (errorElement) {
                        errorElement.classList.remove('d-none');
                        errorElement.innerHTML = `
                            <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Location Access Required</h5>
                            <p>${error.message || 'Please allow location access to view accurate prayer times for your area.'}</p>
                            <button class="btn btn-sm btn-warning mt-2" onclick="getCurrentLocation()">Try Again</button>
                        `;
                    }
                });
            };
        });
    </script>
</body>

</html>
