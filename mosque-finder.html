<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mosque Finder - Islamic Prayer Times</title>
    <meta name="description" content="Find nearby mosques with directions and contact information.">
       <meta name="keywords" content="mosque finder, find mosque, nearby mosque, masjid near me, Islamic center, prayer location">
    

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts - Islamic Style -->
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Roboto:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /> -->
    <!-- <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script> -->

    <style>
        /* Islamic Prayer Times App - Custom Styles */
        :root {
            --islamic-green: #2d5a3d;
            --islamic-green-light: #4a8061;
            --islamic-gold: #d4af37;
            --islamic-gold-light: #f4d03f;
            --text-dark: #2c3e50;
            --text-light: #ecf0f1;
            --shadow-light: rgba(0, 0, 0, 0.1);
            --shadow-medium: rgba(0, 0, 0, 0.15);
            --gradient-green: linear-gradient(135deg, var(--islamic-green), var(--islamic-green-light));
            --gradient-gold: linear-gradient(135deg, var(--islamic-gold), var(--islamic-gold-light));
        }

        /* Base Styles */
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding-top: 76px;
        }

        .arabic-font {
            font-family: 'Amiri', serif;
            font-weight: 700;
        }

        /* Navigation */
        .bg-islamic-green {
            background: var(--gradient-green) !important;
            box-shadow: 0 2px 20px var(--shadow-medium);
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .navbar-nav .nav-link {
            font-weight: 500;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
            border-radius: 25px;
            padding: 0.5rem 1rem !important;
        }

        .navbar-nav .nav-link:hover,
        .navbar-nav .nav-link.active {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Section Header */
        .section-header {
            margin-bottom: 3rem;
        }

        .section-header h1 {
            color: var(--islamic-green);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        /* Map Container */
        .map-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow-light);
            height: 500px;
            position: relative;
        }

        #mosque-map {
            height: 100%;
            width: 100%;
        }

        /* Mosque List Items */
        .mosque-item {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 4px 15px var(--shadow-light);
            transition: transform 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .mosque-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }

        .mosque-name {
            font-weight: 600;
            color: var(--islamic-green);
            margin-bottom: 0.5rem;
        }

        .mosque-address {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .mosque-distance {
            color: var(--islamic-gold);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .distance-badge {
            background: var(--islamic-gold);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Mosque Actions */
        .mosque-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .mosque-actions .btn-sm {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px var(--shadow-light);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: var(--gradient-green);
            color: white;
            border: none;
            font-weight: 600;
        }

        /* Alerts */
        .alert {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 15px var(--shadow-light);
        }

        /* Loading Spinners */
        .spinner-border {
            color: var(--islamic-green) !important;
        }

        /* Buttons */
        .btn-primary {
            background: var(--gradient-green);
            border: none;
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--gradient-gold);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow-medium);
        }

        /* Filter Controls */
        .filter-controls {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 25px var(--shadow-light);
        }

        /* Footer */
        footer {
            background: var(--gradient-green) !important;
            margin-top: 3rem;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
            margin: 0 10px;
            font-size: 0.9rem;
        }

        .footer-links a:hover {
            color: white;
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding-top: 76px;
            }

            .map-container {
                height: 400px;
            }

            .mosque-actions {
                flex-direction: column;
                gap: 0.25rem;
            }

            .mosque-actions .btn-sm {
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-islamic-green fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-mosque me-2"></i>
                Islamic Prayer Times
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="prayer-times.html" onclick="return addLocationToLink(this)">Prayer
                            Times</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="mosque-finder.html">Mosque Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="qibla.html" onclick="return addLocationToLink(this)">Qibla Finder</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="dhikr.html">Dhikr Counter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">About</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container py-5">
            <div class="section-header text-center">
                <h1><i class="fas fa-mosque me-3"></i>Mosque Finder</h1>
                <p class="lead">Find nearby mosques with directions and details</p>
            </div>

            <!-- Location Loading -->
            <div id="mosque-loading" class="text-center mb-4">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Searching for mosques...</span>
                </div>
                <p class="mt-2">Searching for mosques in your area...</p>
            </div>

            <!-- Location Error -->
            <div id="mosque-error" class="alert alert-warning text-center d-none" role="alert">
                <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Location Required</h5>
                <p class="mb-0">Please allow location access to find nearby mosques.</p>
            </div>

            <!-- Filter Controls -->
            <div id="filter-controls" class="filter-controls d-none">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="radiusSelect" class="form-label">Search Radius</label>
                        <select class="form-select" id="radiusSelect">
                            <option value="1000">1 km</option>
                            <option value="2000">2 km</option>
                            <option value="5000" selected>5 km</option>
                            <option value="10000">10 km</option>
                            <option value="20000">20 km</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="sortSelect" class="form-label">Sort By</label>
                        <select class="form-select" id="sortSelect">
                            <option value="distance" selected>Distance</option>
                            <option value="rating">Rating</option>
                            <option value="name">Name</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="filterSelect" class="form-label">Filter</label>
                        <select class="form-select" id="filterSelect">
                            <option value="all" selected>All Mosques</option>
                            <option value="open">Open Now</option>
                            <option value="rated">Highly Rated</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Results -->
            <div id="mosque-results" class="row d-none">
                <!-- Map Column -->
                <div class="col-lg-6 mb-4">
                    <div class="map-container">
                        <div id="mosque-map"></div>
                    </div>
                </div>

                <!-- List Column -->
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-list me-2"></i>Nearby Mosques
                                <span class="badge bg-secondary ms-2" id="mosque-count">0</span>
                            </h5>
                        </div>
                        <div class="card-body" style="max-height: 500px; overflow-y: auto;">
                            <div id="mosque-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
     <footer class="bg-islamic-green text-white py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0 arabic-font">"وَأَقِيمُوا الصَّلَاةَ وَآتُوا الزَّكَاةَ وَارْكَعُوا مَعَ
                        الرَّاكِعِينَ"</p>
                    <small class="text-light">"And establish prayer and give zakah and bow with those who bow." - Quran
                        2:43</small>
                </div>
                <div class="col-md-6 text-md-end footer-links">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms of Service</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#disclaimerModal">Disclaimer</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#cookiesModal">Cookie Policy</a>
                    <a href="#" data-bs-toggle="modal" data-bs-target="#contactModal">Contact Us</a>
                    <small>&copy; 2025 Islamic Prayer Times App</small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Legal Modals -->
    <!-- Privacy Policy Modal -->
    <div class="modal fade legal-modal" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel"><i class="fas fa-shield-alt me-2"></i>Privacy Policy
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>1. Information We Collect</h5>
                    <p>Our Islamic Prayer Times app collects limited information to provide you with accurate prayer
                        times and mosque locations:</p>
                    <ul>
                        <li><strong>Location Data:</strong> We collect your device's geographical coordinates to
                            calculate accurate prayer times and find nearby mosques.</li>
                        <li><strong>Usage Data:</strong> We may collect information about how you interact with our app
                            to improve user experience.</li>
                        <li><strong>Device Information:</strong> We collect device type and browser information for
                            compatibility purposes.</li>
                    </ul>

                    <h5>2. How We Use Your Information</h5>
                    <p>We use the collected information solely for the purpose of providing and improving our services:
                    </p>
                    <ul>
                        <li>To calculate accurate prayer times based on your location</li>
                        <li>To locate mosques near your current position</li>
                        <li>To improve app functionality and user experience</li>
                        <li>To provide customer support</li>
                    </ul>

                    <h5>3. Data Storage and Security</h5>
                    <p>We prioritize the security of your information:</p>
                    <ul>
                        <li>Location data is processed in real-time and not stored on our servers</li>
                        <li>We implement appropriate security measures to protect your information</li>
                        <li>We do not sell or share your personal information with third parties</li>
                    </ul>

                    <h5>4. Your Rights</h5>
                    <p>You have the right to:</p>
                    <ul>
                        <li>Access the personal information we hold about you</li>
                        <li>Request correction of inaccurate information</li>
                        <li>Request deletion of your personal data</li>
                        <li>Opt-out of data collection (though this may limit app functionality)</li>
                    </ul>

                    <h5>5. Changes to This Policy</h5>
                    <p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting
                        the new Privacy Policy on this page and updating the "Last Updated" date.</p>

                    <p class="mt-4"><strong>Last Updated:</strong> January 1, 2025</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Terms of Service Modal -->
    <div class="modal fade legal-modal" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="termsModalLabel"><i class="fas fa-file-contract me-2"></i>Terms of
                        Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>1. Acceptance of Terms</h5>
                    <p>By accessing and using the Islamic Prayer Times app, you accept and agree to be bound by the
                        terms and provision of this agreement.</p>

                    <h5>2. Use License</h5>
                    <p>Permission is granted to temporarily use the Islamic Prayer Times app for personal,
                        non-commercial transitory viewing only.</p>

                    <h5>3. Disclaimer</h5>
                    <p>The prayer times and mosque locations are provided for informational purposes only. While we
                        strive to provide accurate information, we cannot guarantee the absolute accuracy of prayer
                        times or mosque locations.</p>

                    <h5>4. Limitations</h5>
                    <p>In no event shall Islamic Prayer Times or its suppliers be liable for any damages arising out of
                        the use or inability to use the services provided by the app.</p>

                    <h5>5. Accuracy of Materials</h5>
                    <p>The materials appearing in the Islamic Prayer Times app could include technical, typographical,
                        or photographic errors. We do not warrant that any of the materials on its app are accurate,
                        complete or current.</p>

                    <h5>6. Modifications</h5>
                    <p>Islamic Prayer Times may revise these terms of service for its app at any time without notice. By
                        using this app you are agreeing to be bound by the then current version of these terms of
                        service.</p>

                    <h5>7. Governing Law</h5>
                    <p>These terms and conditions are governed by and construed in accordance with the laws and any
                        disputes relating to these terms and conditions will be subject to the exclusive jurisdiction of
                        the courts.</p>

                    <p class="mt-4"><strong>Last Updated:</strong> January 1, 2025</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Disclaimer Modal -->
    <div class="modal fade legal-modal" id="disclaimerModal" tabindex="-1" aria-labelledby="disclaimerModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="disclaimerModalLabel"><i
                            class="fas fa-exclamation-circle me-2"></i>Disclaimer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>1. Prayer Times Accuracy</h5>
                    <p>The prayer times provided by this app are calculated using established mathematical formulas and
                        are based on your geographical location. While we strive to provide accurate prayer times,
                        actual prayer times may vary slightly based on local customs, mosque announcements, and other
                        factors. Users are advised to confirm prayer times with their local mosque for religious
                        obligations.</p>

                    <h5>2. Mosque Locations</h5>
                    <p>The mosque locations are sourced from OpenStreetMap and may not be comprehensive or completely
                        accurate. The inclusion or exclusion of any mosque does not represent an endorsement or
                        criticism of that institution. We recommend verifying mosque information before visiting.</p>

                    <h5>3. Religious Considerations</h5>
                    <p>This app is intended as a helpful tool for Muslims but should not replace religious knowledge or
                        guidance from qualified scholars. Users are responsible for ensuring their prayers and religious
                        practices comply with their understanding of Islamic requirements.</p>

                    <h5>4. Technical Limitations</h5>
                    <p>The accuracy of location-based services depends on your device's capabilities and connectivity.
                        Results may vary based on GPS accuracy, network availability, and other technical factors beyond
                        our control.</p>

                    <h5>5. No Warranty</h5>
                    <p>The Islamic Prayer Times app is provided "as is" without any warranties, expressed or implied. We
                        make no guarantees regarding the availability, accuracy, or reliability of the services.</p>

                    <h5>6. Limitation of Liability</h5>
                    <p>In no event shall the creators of this app be liable for any missed prayers, religious
                        obligations, or any direct, indirect, incidental, special, or consequential damages arising from
                        the use of or inability to use the app.</p>

                    <p class="mt-4"><strong>Last Updated:</strong> January 1, 2025</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Cookie Policy Modal -->
    <div class="modal fade legal-modal" id="cookiesModal" tabindex="-1" aria-labelledby="cookiesModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cookiesModalLabel"><i class="fas fa-cookie-bite me-2"></i>Cookie Policy
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h5>1. What Are Cookies</h5>
                    <p>Cookies are small text files that are stored on your device when you visit websites or use web
                        applications. They are widely used to make websites work efficiently and provide information to
                        the owners of the site.</p>

                    <h5>2. How We Use Cookies</h5>
                    <p>Our Islamic Prayer Times app uses cookies for the following purposes:</p>
                    <ul>
                        <li><strong>Essential Cookies:</strong> These are necessary for the app to function properly.
                            They enable core functionality such as location services and prayer time calculations.</li>
                        <li><strong>Preference Cookies:</strong> These remember your choices such as time format
                            preferences (12-hour or 24-hour format).</li>
                        <li><strong>Analytical Cookies:</strong> These help us understand how users interact with our
                            app, allowing us to improve its functionality and user experience.</li>
                    </ul>

                    <h5>3. Third-Party Cookies</h5>
                    <p>We may use services from third parties that place cookies on your device:</p>
                    <ul>
                        <li><strong>Mapping Services:</strong> Our mosque finder feature uses OpenStreetMap which may
                            place cookies for functionality.</li>
                        <li><strong>Analytics Services:</strong> We use analytics services to understand how our app is
                            being used and to make improvements.</li>
                    </ul>

                    <h5>4. Managing Cookies</h5>
                    <p>You can control and manage cookies in various ways:</p>
                    <ul>
                        <li>Most browsers allow you to refuse cookies or delete them. You can usually find these
                            settings in your browser's "options" or "preferences" menu.</li>
                        <li>Please note that disabling cookies may affect the functionality of our app and many other
                            websites that you visit.</li>
                    </ul>

                    <h5>5. Consent</h5>
                    <p>By using our app, you consent to the use of cookies in accordance with this Cookie Policy. If you
                        do not agree to our use of cookies, you should adjust your browser settings appropriately or
                        discontinue use of our app.</p>

                    <h5>6. Changes to This Policy</h5>
                    <p>We may update our Cookie Policy from time to time. We will notify you of any changes by posting
                        the new Cookie Policy on this page.</p>

                    <p class="mt-4"><strong>Last Updated:</strong> January 1, 2025</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- In your contact page -->
    <div class="modal fade legal-modal" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel"><i class="fas fa-envelope me-2"></i>Contact Us</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <h5>Get In Touch</h5>
                    <p>We're here to assist you with any questions about prayer times, mosque locations, or technical
                        support for our app.</p>

                    <div class="row justify-content-center mt-4">
                        <div class="col-md-8"> <!-- Increased width for better centering -->
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <div class="contact-icon mb-3">
                                        <i class="fas fa-envelope fa-2x text-primary"></i>
                                    </div>
                                    <h5>Email Support</h5>
                                    <p>Send us an email for assistance with the app or prayer time calculations</p>
                                    <a href="mailto:kindnesspath1@gmail.com" class="btn btn-primary mt-2">
                                        <i class="fas fa-paper-plane me-2"></i>Send Email
                                    </a>
                                    <p class="small text-muted mt-2">
                                        <!-- <em>Once we launch, this will be a dedicated support email</em> -->
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet JS for Maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Location Manager -->
    <script src="location-manager.js"></script>

    <script>
        // Mosque Finder page functionality
        let map = null;
        let mosqueMarkers = [];
        let mosqueData = [];

        document.addEventListener('DOMContentLoaded', function () {
            // Update navigation active state
            const currentPage = window.location.pathname.split('/').pop() || 'mosque-finder.html';
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });

            // Initialize location and load mosques
            window.locationManager.getLocation().then(() => {
                loadMosques();
            }).catch((error) => {
                document.getElementById('mosque-loading').classList.add('d-none');
                document.getElementById('mosque-error').classList.remove('d-none');
            });

            // Setup event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Filter controls
            document.getElementById('radiusSelect')?.addEventListener('change', () => filterMosques());
            document.getElementById('sortSelect')?.addEventListener('change', () => sortAndDisplayMosques());
            document.getElementById('filterSelect')?.addEventListener('change', () => filterMosques());
        }

        async function loadMosques() {
            const location = window.locationManager.userLocation;
            if (!location) return;

            try {
                // Show loading, hide error
                document.getElementById('mosque-loading').classList.remove('d-none');
                document.getElementById('mosque-error').classList.add('d-none');

                // Initialize map
                initializeMap(location);

                // Use a more comprehensive search for mosques
                const radius = document.getElementById('radiusSelect')?.value || 5000;
                const queries = ['mosque', 'masjid', 'islamic center', 'جامع'];

                let allMosques = [];

                for (const query of queries) {
                    try {
                        // Using Overpass API for OpenStreetMap data
                        const overpassUrl = `https://overpass-api.de/api/interpreter?data=[out:json];(node["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${location.lat},${location.lng});way["amenity"="place_of_worship"]["religion"="muslim"](around:${radius},${location.lat},${location.lng}););out center;`;

                        const response = await fetch(overpassUrl);
                        const data = await response.json();

                        if (data.elements) {
                            data.elements.forEach(element => {
                                const lat = element.lat || element.center?.lat;
                                const lng = element.lon || element.center?.lon;

                                if (lat && lng) {
                                    const mosque = {
                                        id: element.id,
                                        name: element.tags?.name || 'Mosque',
                                        lat: lat,
                                        lng: lng,
                                        address: element.tags?.['addr:full'] || element.tags?.['addr:street'] || 'Address not available',
                                        distance: calculateDistance(location.lat, location.lng, lat, lng)
                                    };

                                    // Avoid duplicates
                                    if (!allMosques.some(m => Math.abs(m.lat - lat) < 0.001 && Math.abs(m.lng - lng) < 0.001)) {
                                        allMosques.push(mosque);
                                    }
                                }
                            });
                        }
                    } catch (error) {
                        console.error(`Error searching for ${query}:`, error);
                    }
                }

                // If no results from Overpass, try a fallback with mock data
                if (allMosques.length === 0) {
                    // allMosques = getMockMosques(location);
                }

                mosqueData = allMosques.sort((a, b) => a.distance - b.distance);
                displayMosques();
                addMosquesToMap();

                // Show results, hide loading
                document.getElementById('mosque-loading').classList.add('d-none');
                document.getElementById('filter-controls').classList.remove('d-none');
                document.getElementById('mosque-results').classList.remove('d-none');

            } catch (error) {
                console.error('Error loading mosques:', error);
                document.getElementById('mosque-loading').classList.add('d-none');
                document.getElementById('mosque-error').classList.remove('d-none');
            }
        }

        function getMockMosques(location) {
            // Fallback mock data for demonstration
            return [
                {
                    id: 'mock1',
                    name: 'Central Mosque',
                    lat: location.lat + 0.01,
                    lng: location.lng + 0.01,
                    address: '123 Main Street, City Center',
                    distance: 1.2
                },
                {
                    id: 'mock2',
                    name: 'Islamic Center',
                    lat: location.lat - 0.015,
                    lng: location.lng + 0.02,
                    address: '456 Oak Avenue, Downtown',
                    distance: 2.1
                },
                {
                    id: 'mock3',
                    name: 'Community Mosque',
                    lat: location.lat + 0.02,
                    lng: location.lng - 0.01,
                    address: '789 Pine Road, Suburb',
                    distance: 2.8
                }
            ];
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLng / 2) * Math.sin(dLng / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function initializeMap(location) {
            if (!map) {
                map = L.map('mosque-map').setView([location.lat, location.lng], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(map);

                // Add user location marker
                L.marker([location.lat, location.lng])
                    .addTo(map)
                    .bindPopup('Your Location')
                    .openPopup();
            }
        }

        function displayMosques() {
            const mosqueList = document.getElementById('mosque-list');
            const mosqueCount = document.getElementById('mosque-count');

            if (!mosqueList) return;

            mosqueList.innerHTML = '';

            if (mosqueData.length === 0) {
                mosqueList.innerHTML = '<p class="text-center text-muted">No mosques found in your area.</p>';
                return;
            }

            mosqueCount.textContent = mosqueData.length;

            mosqueData.forEach(mosque => {
                displayMosque(mosque);
            });
        }

        function displayMosque(mosque) {
            const mosqueList = document.getElementById('mosque-list');
            if (!mosqueList) return;

            const mosqueElement = document.createElement('div');
            mosqueElement.className = 'mosque-item';
            const distanceText = typeof mosque.distance === 'number' ? `${mosque.distance.toFixed(1)} km` : mosque.distance;

            mosqueElement.innerHTML = `
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <div class="mosque-name">${mosque.name}</div>
                        <div class="mosque-address mb-2">${mosque.address}</div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="distance-badge">${distanceText}</span>
                            <div class="mosque-actions">
                                <button class="btn btn-sm btn-primary me-2" onclick="getDirections(${mosque.lat}, ${mosque.lng}, '${mosque.name.replace(/'/g, "\\'")}')">
                                    <i class="fas fa-directions me-1"></i>Directions
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="focusOnMap(${mosque.lat}, ${mosque.lng})">
                                    <i class="fas fa-map-marker-alt me-1"></i>Show on Map
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            mosqueList.appendChild(mosqueElement);
        }

        function addMosquesToMap() {
            if (!map) return;

            // Clear existing markers
            mosqueMarkers.forEach(marker => map.removeLayer(marker));
            mosqueMarkers = [];

            // Add mosque markers
            mosqueData.forEach(mosque => {
                const marker = L.marker([mosque.lat, mosque.lng])
                    .addTo(map)
                    .bindPopup(`
                        <strong>${mosque.name}</strong><br>
                        ${mosque.address}<br>
                        <small>${typeof mosque.distance === 'number' ? mosque.distance.toFixed(1) + ' km away' : mosque.distance}</small>
                    `);

                mosqueMarkers.push(marker);
            });
        }

        function filterMosques() {
            // Implementation for filtering mosques
            displayMosques();
            addMosquesToMap();
        }

        function sortAndDisplayMosques() {
            const sortBy = document.getElementById('sortSelect')?.value || 'distance';

            if (sortBy === 'distance') {
                mosqueData.sort((a, b) => a.distance - b.distance);
            } else if (sortBy === 'name') {
                mosqueData.sort((a, b) => a.name.localeCompare(b.name));
            }

            displayMosques();
        }

        function getDirections(lat, lng, name) {
            const location = window.locationManager.userLocation;
            if (!location) {
                alert('Unable to get directions. Location not available.');
                return;
            }

            // Open Google Maps with directions
            const directionsUrl = `https://www.google.com/maps/dir/${location.lat},${location.lng}/${lat},${lng}`;
            window.open(directionsUrl, '_blank');
        }

        function focusOnMap(lat, lng) {
            if (map) {
                map.setView([lat, lng], 16);

                // Find and highlight the marker
                mosqueMarkers.forEach(marker => {
                    if (Math.abs(marker.getLatLng().lat - lat) < 0.0001 && Math.abs(marker.getLatLng().lng - lng) < 0.0001) {
                        marker.openPopup();
                    }
                });
            }
        }
    </script>
</body>

</html>
